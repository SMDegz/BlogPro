<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/BlogPro/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/BlogPro/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/BlogPro/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/BlogPro/images/logo.svg" color="#222">

<link rel="stylesheet" href="/BlogPro/css/main.css">


<link rel="stylesheet" href="/BlogPro/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/BlogPro/lib/pace/pace-theme-minimal.min.css">
  <script src="/BlogPro/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"smdegz.github.io","root":"/BlogPro/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
<meta property="og:type" content="website">
<meta property="og:title" content="何锦祥 博客">
<meta property="og:url" content="https://smdegz.github.io/BlogPro/page/3/index.html">
<meta property="og:site_name" content="何锦祥 博客">
<meta property="og:description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="生活, 思考, 感悟, 分享">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://smdegz.github.io/BlogPro/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>何锦祥 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/SMDegz" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/BlogPro/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">何锦祥 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">探索生活，分享思考</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/BlogPro/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/BlogPro/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/BlogPro/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/BlogPro/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/BlogPro/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/01/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/01/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">2、容器化-Docker基础-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-01 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-01T10:48:57+08:00">2024-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 14:49:01" itemprop="dateModified" datetime="2024-01-23T14:49:01+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/01/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/01/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>2、容器化-Docker基础-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n2' class='md-header-anchor '></a>笔记</h1><h2><a name='header-n3' class='md-header-anchor '></a>二、容器化-Docker基础</h2><p>1、Docker核心概念理解</p><p>2、Docker安装</p><p>3、Docker镜像</p><p>4、Docker容器</p><p>5、Docker部署.Net7项目</p><p>6、Docker 自定义镜像</p><p>&nbsp;</p><p>yum</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker安装</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1、安装docker仓库</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O/etc/yum.repos.d/docker-ce.repo</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2、安装docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">yum -y install docker-ce</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3、启动docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">systemctl start docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4、开机自启动docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">systemctl enable docker</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 295px;"></div><div class="CodeMirror-gutters" style="display: none; height: 295px;"></div></div></div></pre><p>要点：</p><p>1、docker有两种版本</p><p><span>	</span>ce  ee</p><p><span>	</span>社区版  企业版</p><p>docker部署项目<span>	</span></p><p>前提：</p><p>1、docker版本：Docker version 24.0.6, build ed223bc</p><p>2、认识如何使用docker命令</p><p>3、docker通信流程</p><p>客户端----服务端</p><p>客户端----项目---服务端（部署）</p><p>应用</p><p>docker部署.Net7项目</p><p>1、项目发布<span>	</span></p><p>2、发布项目上传</p><p>3、发布项目生成镜像</p><p><span>	</span>Dockerfile  :统一执行命令。</p><p>        Dockerfile配置</p><p><span>	</span>Dockerfile使用</p><p>       docker build -t docker_webapi .</p><p>4、镜像运行容器(发布项目)</p><p><span>	</span>docker run docker_webapi</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM mcr.microsoft.com/dotnet/aspnet:6.0</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WORKDIR /publish</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE 443</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">COPY publish/ /publish</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ENTRYPOINT ["dotnet", "ydt.microservice.productservice.dll"]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><p>docker项目访问</p><p>1、暴露端口</p><p>2、然后才能访问</p><p>3、端口指定</p><p>4、后台运行</p><p>docker部署.Net7项目</p><p>核心：</p><p>1、镜像：</p><p><span>	</span>.Net7项目在docker中标准。区分不同语言开发的项目</p><p><span>	</span>Net7项目 + Dockerfile构成的。类似于ISO文件</p><p><span>	</span>class ---&gt;对象<span>	</span></p><p>2、容器</p><p><span>	</span>.Net7项目运行地方。容器就是项目运行的平台。Linux操作系统运行项目</p><p>镜像 于 容器关系</p><p>1、一对多关系：</p><p><span>	</span>一个镜像可以运行成为多个容器 ：快速搭建集群</p><p>镜像：不能修改。</p><p>容器：是可以修改。</p><p>容器访问流程</p><p>客户端-----&gt;Linux------&gt;Docker----&gt;容器-----&gt;.Net7项目</p><p>docker  exec -it 14ea7a3db8ff /bin/bash</p><p>容器 : 小型的Linux操作系统</p><p>容器 ：运行一个项目，还是可以运行多个项目呢？</p><p>个人建议：一个容器只运行一个项目。横向和纵向扩展。</p><p>实践：一个项目----&gt;一个镜像----&gt;运行成多个容器</p><p>镜像使用：<span>	</span></p><p>容器使用：</p><p>docker运行默认镜像。docker已经生成的镜像。</p><p>docker 运行默认镜像不在本地。</p><p>镜像仓库(远程仓库)</p><p>dockerhub</p><p>nginx redis rabbitmq.......</p><p>本地镜像使用</p><p>docker run</p><p>远程镜像使用</p><p>1、下载镜像 nginx</p><p><span>	</span>docker pull nginx</p><p>2、运行镜像</p><p>&nbsp;</p><p>nginx 镜像是如何生成的？</p><p><span>	</span>1、docker自定义镜像</p><p>nginx 容器如何对.net7项目实现代理？</p><p><span>	</span>2、docker 网络通信</p><p>nginx镜像+.net7项目镜像批量运行？</p><p><span>	</span>3、docker 容器编排</p><p><span>	</span>4、docker 数据挂载。</p><p>docker进阶内容。</p><h2><a name='header-n83' class='md-header-anchor '></a>1、docker 是不是也是公用操作系统的内存和磁盘，只是把它分配给不同的容器</h2><p>答案：是的。共享同一个内存和磁盘</p><h2><a name='header-n85' class='md-header-anchor '></a>2、好像win10的高版本也支持了，但性能很差</h2><p>答案：windows系统不支持。本质上还是直接使用Linux</p><h2><a name='header-n87' class='md-header-anchor '></a>3、这是什么工具？一边是linux，一边是windows？</h2><p>答案：不同操作系统之间共享文件 winscp</p><h2><a name='header-n89' class='md-header-anchor '></a>4、是不是直接可以vs 里面 ，给项目增加docker 支持，增加docker 文件做这样的配置</h2><h2><a name='header-n90' class='md-header-anchor '></a>5、能每次发布项目都自动build Dockerfile吗？同一台linux能不能运行多个都是80端口的Docker？</h2><p>答案：容器是隔离的。如果遇到项目升级。每次项目升级都会重新生成新的镜像。</p><h2><a name='header-n92' class='md-header-anchor '></a>6、老师，课程开始时，你画的docker示意图中，为什么docker中有很多主机呢？难道说一个容器里，可以运行好几台主机？</h2><p>答案：docker -----&gt; 运行了多个容器 。一个容器就是一个主机。</p><h2><a name='header-n94' class='md-header-anchor '></a>7、https在如何设置证书</h2><p>答案：课后我把文档发给你。学数据挂载。</p><h2><a name='header-n96' class='md-header-anchor '></a>8、如果项目更新 重新发布，和第一次使用dokcer项目部署区别吗</h2><p>答案：有区别。两次镜像不一样。</p><h2><a name='header-n98' class='md-header-anchor '></a>9、构建容器时，-p5001:80这后面的80是什么端口呀？</h2><p>答案：容器内部暴露的端口。生成镜像指定的端口</p><p>客户端---&gt;Linux---&gt;Docker----&gt;容器----&gt;应用</p><p><span>		</span> 5001                        ---&gt;80 ------&gt;80</p><p><span>						</span>  - ---&gt;81  81<span>										</span></p><h2><a name='header-n103' class='md-header-anchor '></a>10、5001是服务的端口，80是docker的端口？</h2><p>答案：5001是Linux端口  80是容器的端口和应用的端口</p><h2><a name='header-n105' class='md-header-anchor '></a>11、容器相当于一个精简的Linux，那它有没有固定大小的内存和磁盘。不同的容器使用资源是一种竞争关系吗？会不会出现宕机的情况。</h2><p>答案：动态的：可以固定。设置内存大小和磁盘大小。</p><h2><a name='header-n107' class='md-header-anchor '></a>12、项目发布时，部署模式选择独立，在生成镜像的时候，还需要在Dockerfile配置.Net的运行环境吗？（FROM ....）</h2><p>答案：任何时候都需要指定。</p><p>前提：必须有基镜像。</p><h2><a name='header-n110' class='md-header-anchor '></a>13、如果一个容器中，真的有多个应用，那这个端口怎么分配处理呢？</h2><p>答案：暴露多个端口</p><p>docker run -e &quot;ACCEPT_EULA=Y&quot; -e &quot;SA_PASSWORD=User@123&quot; -p 1433:1433 --name sqlserver2019 -d mcr.microsoft.com/mssql/server:2019-latest 我用这个命令运行mssql2019 生成了容器但是立马就关闭了，无法连接。 查看日志错误：SQL Server 2019 will run as non-root by default.
This container is running as user mssql.
To learn more visit <a href='https://go.microsoft.com/fwlink/?linkid=2099216' target='_blank' class='url'>https://go.microsoft.com/fwlink/?linkid=2099216</a>.
2023-10-11 14:16:52.73 Server Setup step is copying system data file &#39;C:\templatedata\master.mdf&#39; to &#39;/var/opt/mssql/data/master.mdf&#39;.
2023-10-11 14:16:52.77 Server Did not find an existing master data file /var/opt/mssql/data/master.mdf, copying the missing default master and other system database files. If you have moved the database location, but not moved the database files, startup may fail. To repair: shutdown SQL Server, move the master database to configured location, and restart.</p><p>版本冲突：本身sqlserver。</p><h2><a name='header-n114' class='md-header-anchor '></a>14、题外：能不能在高级课中，开设一些 规范设计的课程，最近经常会和前端，有规范争议</h2><p>答案：扩展内容。</p><p>&nbsp;</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/01/4%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%E8%AF%BE%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/01/4%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%E8%AF%BE%E4%BB%B6/" class="post-title-link" itemprop="url">4、ABP vNext-核心项目-项目模块</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-01 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-01T10:48:57+08:00">2024-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 20:06:49" itemprop="dateModified" datetime="2024-01-23T20:06:49+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/01/4%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%E8%AF%BE%E4%BB%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/01/4%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%E8%AF%BE%E4%BB%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="引入-Volo-Abp。EntityFrameworkCore"><a href="#引入-Volo-Abp。EntityFrameworkCore" class="headerlink" title="引入 Volo.Abp。EntityFrameworkCore"></a>引入 Volo.Abp。EntityFrameworkCore</h3><ul>
<li>在module 类 添加  typeof(AbpEntityFrameworkCoreModule),</li>
<li>创建一个Context 数据库上下文</li>
</ul>
<p><img src="/BlogPro/image-45.png" alt="Alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[ConnectionStringName(&quot;Default&quot;)]</span><br><span class="line">public class ABPEbusinessContext : AbpDbContext&lt;ABPEbusinessContext&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public ABPEbusinessContext(DbContextOptions&lt;ABPEbusinessContext&gt; options) : base(options)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    public DbSet&lt;Product&gt; Products &#123; set; get; &#125;</span><br><span class="line">    public DbSet&lt;Order&gt; Orders &#123; set; get; &#125;</span><br><span class="line">    public DbSet&lt;Payment&gt; Payments &#123; set; get; &#125;</span><br><span class="line">    public DbSet&lt;User&gt; Users &#123; set; get; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>EbusinessContext加载到IOC容器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">context.Services.AddDbContext&lt;EbusinessContext&gt;(options =&gt; &#123;</span><br><span class="line">    options.UseMySql(Configuration.GetConnectionString(&quot;Default&quot;), MySqlServerVersion.LatestSupportedServerVersion);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>加载ABPEbusinessContext到IOC容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.ServicesAddAbpDbContext&lt;ABPEbusinessContext&gt;();</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载DbContext对应的MySQL数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Configure&lt;AbpDbContextOptions&gt;(options =&gt; &#123;</span><br><span class="line">    options.UseMySQL();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Context 数据库上下文中添加<br>   [ConnectionStringName(“Default”)]<br>  用于连接数据库</p>
</li>
<li><p>执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet ef migrations add ebusiness</span><br><span class="line"></span><br><span class="line">dotnet ef database update</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/BlogPro/images/image.png" alt="Alt text"></p>
<h2 id="重构项目为领域驱动项目"><a href="#重构项目为领域驱动项目" class="headerlink" title="重构项目为领域驱动项目"></a>重构项目为领域驱动项目</h2><ul>
<li><p>安装包 VVolo.Abp.Ddd.Domain</p>
</li>
<li><p>在Module类中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpDddDomainModule),</span><br></pre></td></tr></table></figure>


</li>
<li><p>创建一个ABP的仓储接口类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 商品仓储 用来实现abp提供的仓储</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line"></span><br><span class="line">public interface IProductABPRepository: IRepository&lt;Product,Guid&gt;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个ABP的仓储类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 商品仓储实现</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">[Dependency(ServiceLifetime.Singleton)]</span><br><span class="line">public class ProductABPRepository : EfCoreRepository&lt;ABPEbusinessContext, Product, Guid&gt;, IProductABPRepository</span><br><span class="line">&#123;</span><br><span class="line">    public ProductABPRepository(IDbContextProvider&lt;ABPEbusinessContext&gt; dbContextProvider) : base(dbContextProvider)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实体类要继承自 Entity<Guid></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 商品模型</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public class Product : Entity&lt;Guid&gt;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    //public Guid Id &#123; set; get; &#125; // 商品主键</span><br><span class="line">    public string ProductCode &#123; set; get; &#125;    //商品编码</span><br><span class="line">    public string ProductUrl &#123; set; get; &#125;        </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>创建一个ABP Service 接口类</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 商品服务</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public interface IProductABPService : ICrudAppService&lt;ProductDto,Guid&gt;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>创建一个ABP Service 类</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 商品服务实现</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">[Dependency(ServiceLifetime.Singleton)]</span><br><span class="line">public class ProductABPService : CrudAppService&lt;Product, ProductDto, Guid&gt;, IProductABPService</span><br><span class="line">&#123;</span><br><span class="line">   // public IProductABPRepository ProductABPRepository &#123; set; get; &#125;</span><br><span class="line"></span><br><span class="line">    public ProductABPService(IProductABPRepository ProductABPRepository) : base(ProductABPRepository)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>引入  Volo.Abp.Ddd.Application 包</li>
<li>在module类添加对应应用<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpDddApplicationModule),</span><br></pre></td></tr></table></figure></li>
</ul>
<p>只用引用了这个包之后，上面的Serveice 类才可以继承自 CrudAppService&lt;Product, ProductDto, Guid&gt; 类</p>
<ul>
<li><p>实体类的 DTO 需要继承自 : EntityDto<Guid></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 商品Dto,主要是页面数据---&gt;需要转接成为实体</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public class ProductDto: EntityDto&lt;Guid&gt;</span><br><span class="line">&#123;</span><br><span class="line">    //public Guid Id &#123; set; get; &#125; // 商品主键</span><br><span class="line">    public string ProductCode &#123; set; get; &#125;   </span><br><span class="line">     //商品编码</span><br><span class="line">    public string ProductUrl &#123; set; get; &#125;    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入 Volo.Abp.AutoMapper 包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpAutoMapperModule))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> // 5、加载AbpAutoMapper到IOC容器</span><br><span class="line"> context.Services.AddAutoMapperObjectMapper&lt;ABPEbusinessContext&gt;();</span><br><span class="line"></span><br><span class="line"> // 6、配置AutoMapper</span><br><span class="line"> Configure&lt;AbpAutoMapperOptions&gt;(options =&gt; &#123;</span><br><span class="line"></span><br><span class="line">     // 6.1、对整个项目进行映射</span><br><span class="line">     options.AddMaps&lt;EbusinessModule&gt;();</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/01/%E5%BE%AE%E6%9C%8D%E5%8A%A1/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/01/%E5%BE%AE%E6%9C%8D%E5%8A%A1/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">2、容器化-Docker基础-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-01 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-01T10:48:57+08:00">2024-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-24 14:18:30" itemprop="dateModified" datetime="2024-01-24T14:18:30+08:00">2024-01-24</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/01/%E5%BE%AE%E6%9C%8D%E5%8A%A1/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/01/%E5%BE%AE%E6%9C%8D%E5%8A%A1/2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>2、容器化-Docker基础-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n2' class='md-header-anchor '></a>笔记</h1><h2><a name='header-n3' class='md-header-anchor '></a>二、容器化-Docker基础</h2><p>1、Docker核心概念理解</p><p>2、Docker安装</p><p>3、Docker镜像</p><p>4、Docker容器</p><p>5、Docker部署.Net7项目</p><p>6、Docker 自定义镜像</p><p>&nbsp;</p><p>yum</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker安装</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1、安装docker仓库</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O/etc/yum.repos.d/docker-ce.repo</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2、安装docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">yum -y install docker-ce</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3、启动docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">systemctl start docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4、开机自启动docker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">systemctl enable docker</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 295px;"></div><div class="CodeMirror-gutters" style="display: none; height: 295px;"></div></div></div></pre><p>要点：</p><p>1、docker有两种版本</p><p><span>	</span>ce  ee</p><p><span>	</span>社区版  企业版</p><p>docker部署项目<span>	</span></p><p>前提：</p><p>1、docker版本：Docker version 24.0.6, build ed223bc</p><p>2、认识如何使用docker命令</p><p>3、docker通信流程</p><p>客户端----服务端</p><p>客户端----项目---服务端（部署）</p><p>应用</p><p>docker部署.Net7项目</p><p>1、项目发布<span>	</span></p><p>2、发布项目上传</p><p>3、发布项目生成镜像</p><p><span>	</span>Dockerfile  :统一执行命令。</p><p>        Dockerfile配置</p><p><span>	</span>Dockerfile使用</p><p>       docker build -t docker_webapi .</p><p>4、镜像运行容器(发布项目)</p><p><span>	</span>docker run docker_webapi</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM mcr.microsoft.com/dotnet/aspnet:6.0</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WORKDIR /publish</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE 443</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">COPY publish/ /publish</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ENTRYPOINT ["dotnet", "ydt.microservice.productservice.dll"]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><p>docker项目访问</p><p>1、暴露端口</p><p>2、然后才能访问</p><p>3、端口指定</p><p>4、后台运行</p><p>docker部署.Net7项目</p><p>核心：</p><p>1、镜像：</p><p><span>	</span>.Net7项目在docker中标准。区分不同语言开发的项目</p><p><span>	</span>Net7项目 + Dockerfile构成的。类似于ISO文件</p><p><span>	</span>class ---&gt;对象<span>	</span></p><p>2、容器</p><p><span>	</span>.Net7项目运行地方。容器就是项目运行的平台。Linux操作系统运行项目</p><p>镜像 于 容器关系</p><p>1、一对多关系：</p><p><span>	</span>一个镜像可以运行成为多个容器 ：快速搭建集群</p><p>镜像：不能修改。</p><p>容器：是可以修改。</p><p>容器访问流程</p><p>客户端-----&gt;Linux------&gt;Docker----&gt;容器-----&gt;.Net7项目</p><p>docker  exec -it 14ea7a3db8ff /bin/bash</p><p>容器 : 小型的Linux操作系统</p><p>容器 ：运行一个项目，还是可以运行多个项目呢？</p><p>个人建议：一个容器只运行一个项目。横向和纵向扩展。</p><p>实践：一个项目----&gt;一个镜像----&gt;运行成多个容器</p><p>镜像使用：<span>	</span></p><p>容器使用：</p><p>docker运行默认镜像。docker已经生成的镜像。</p><p>docker 运行默认镜像不在本地。</p><p>镜像仓库(远程仓库)</p><p>dockerhub</p><p>nginx redis rabbitmq.......</p><p>本地镜像使用</p><p>docker run</p><p>远程镜像使用</p><p>1、下载镜像 nginx</p><p><span>	</span>docker pull nginx</p><p>2、运行镜像</p><p>&nbsp;</p><p>nginx 镜像是如何生成的？</p><p><span>	</span>1、docker自定义镜像</p><p>nginx 容器如何对.net7项目实现代理？</p><p><span>	</span>2、docker 网络通信</p><p>nginx镜像+.net7项目镜像批量运行？</p><p><span>	</span>3、docker 容器编排</p><p><span>	</span>4、docker 数据挂载。</p><p>docker进阶内容。</p><h2><a name='header-n83' class='md-header-anchor '></a>1、docker 是不是也是公用操作系统的内存和磁盘，只是把它分配给不同的容器</h2><p>答案：是的。共享同一个内存和磁盘</p><h2><a name='header-n85' class='md-header-anchor '></a>2、好像win10的高版本也支持了，但性能很差</h2><p>答案：windows系统不支持。本质上还是直接使用Linux</p><h2><a name='header-n87' class='md-header-anchor '></a>3、这是什么工具？一边是linux，一边是windows？</h2><p>答案：不同操作系统之间共享文件 winscp</p><h2><a name='header-n89' class='md-header-anchor '></a>4、是不是直接可以vs 里面 ，给项目增加docker 支持，增加docker 文件做这样的配置</h2><h2><a name='header-n90' class='md-header-anchor '></a>5、能每次发布项目都自动build Dockerfile吗？同一台linux能不能运行多个都是80端口的Docker？</h2><p>答案：容器是隔离的。如果遇到项目升级。每次项目升级都会重新生成新的镜像。</p><h2><a name='header-n92' class='md-header-anchor '></a>6、老师，课程开始时，你画的docker示意图中，为什么docker中有很多主机呢？难道说一个容器里，可以运行好几台主机？</h2><p>答案：docker -----&gt; 运行了多个容器 。一个容器就是一个主机。</p><h2><a name='header-n94' class='md-header-anchor '></a>7、https在如何设置证书</h2><p>答案：课后我把文档发给你。学数据挂载。</p><h2><a name='header-n96' class='md-header-anchor '></a>8、如果项目更新 重新发布，和第一次使用dokcer项目部署区别吗</h2><p>答案：有区别。两次镜像不一样。</p><h2><a name='header-n98' class='md-header-anchor '></a>9、构建容器时，-p5001:80这后面的80是什么端口呀？</h2><p>答案：容器内部暴露的端口。生成镜像指定的端口</p><p>客户端---&gt;Linux---&gt;Docker----&gt;容器----&gt;应用</p><p><span>		</span> 5001                        ---&gt;80 ------&gt;80</p><p><span>						</span>  - ---&gt;81  81<span>										</span></p><h2><a name='header-n103' class='md-header-anchor '></a>10、5001是服务的端口，80是docker的端口？</h2><p>答案：5001是Linux端口  80是容器的端口和应用的端口</p><h2><a name='header-n105' class='md-header-anchor '></a>11、容器相当于一个精简的Linux，那它有没有固定大小的内存和磁盘。不同的容器使用资源是一种竞争关系吗？会不会出现宕机的情况。</h2><p>答案：动态的：可以固定。设置内存大小和磁盘大小。</p><h2><a name='header-n107' class='md-header-anchor '></a>12、项目发布时，部署模式选择独立，在生成镜像的时候，还需要在Dockerfile配置.Net的运行环境吗？（FROM ....）</h2><p>答案：任何时候都需要指定。</p><p>前提：必须有基镜像。</p><h2><a name='header-n110' class='md-header-anchor '></a>13、如果一个容器中，真的有多个应用，那这个端口怎么分配处理呢？</h2><p>答案：暴露多个端口</p><p>docker run -e &quot;ACCEPT_EULA=Y&quot; -e &quot;SA_PASSWORD=User@123&quot; -p 1433:1433 --name sqlserver2019 -d mcr.microsoft.com/mssql/server:2019-latest 我用这个命令运行mssql2019 生成了容器但是立马就关闭了，无法连接。 查看日志错误：SQL Server 2019 will run as non-root by default.
This container is running as user mssql.
To learn more visit <a href='https://go.microsoft.com/fwlink/?linkid=2099216' target='_blank' class='url'>https://go.microsoft.com/fwlink/?linkid=2099216</a>.
2023-10-11 14:16:52.73 Server Setup step is copying system data file &#39;C:\templatedata\master.mdf&#39; to &#39;/var/opt/mssql/data/master.mdf&#39;.
2023-10-11 14:16:52.77 Server Did not find an existing master data file /var/opt/mssql/data/master.mdf, copying the missing default master and other system database files. If you have moved the database location, but not moved the database files, startup may fail. To repair: shutdown SQL Server, move the master database to configured location, and restart.</p><p>版本冲突：本身sqlserver。</p><h2><a name='header-n114' class='md-header-anchor '></a>14、题外：能不能在高级课中，开设一些 规范设计的课程，最近经常会和前端，有规范争议</h2><p>答案：扩展内容。</p><p>&nbsp;</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/6%E3%80%81EFCore%E6%A1%86%E6%9E%B6%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/6%E3%80%81EFCore%E6%A1%86%E6%9E%B6%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">6、EFCore框架调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-06 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-06T10:48:57+08:00">2023-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-29 23:48:18" itemprop="dateModified" datetime="2024-01-29T23:48:18+08:00">2024-01-29</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/6%E3%80%81EFCore%E6%A1%86%E6%9E%B6%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/6%E3%80%81EFCore%E6%A1%86%E6%9E%B6%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="EFCore-自带缓存机制"><a href="#EFCore-自带缓存机制" class="headerlink" title="EFCore 自带缓存机制"></a>EFCore 自带缓存机制</h1><blockquote>
<p>EF Core 内部有实现缓存机制，每次查询SQL命令时，自动对结果数据进行缓存<br> Entity Framework Core (EF Core) 提供了一个内置的缓存机制，这个缓存机制主要用于在上下文中跟踪和管理实体对象的状态，以提高查询性能和减少数据库访问次数。以下是 EF Core 自带的缓存机制的一些基本原理：</p>
</blockquote>
<ul>
<li><ol>
<li><p>Identity Map（标识映射）<br>   唯一性： EF Core 的缓存是一个 Identity Map，它确保在上下文中的每个实体对象仅有一个实例，即同一个实体在内存中的表示是唯一的。</p>
<p>   跟踪变更： 通过 Identity Map，EF Core 能够追踪实体对象的变更，包括添加、修改和删除。这些变更在 SaveChanges 被调用时会被同步到数据库。</p>
</li>
</ol>
</li>
<li><ol start="2">
<li><p>Change Tracking（变更跟踪）<br>   对象状态： EF Core 使用 Change Tracking 来记录实体对象的状态，包括 Added（新增）、Modified（修改）、Deleted（删除）和 Unchanged（未修改）等状态。</p>
<p>   自动检测变更： 当你在代码中对实体属性进行更改时，EF Core 会自动检测并标记相应的实体状态为 Modified。</p>
</li>
</ol>
</li>
<li><ol start="3">
<li><p>Local Cache（本地缓存）<br>   一级缓存： EF Core 在上下文中维护一个一级缓存（Local Cache），用于存储当前上下文中加载的实体。这个缓存可以减少对数据库的重复查询。</p>
<p>   生命周期： 缓存的生命周期通常是在上下文的生命周期内，当上下文被销毁时，缓存中的实体对象也会被释放。</p>
</li>
</ol>
</li>
<li><ol start="4">
<li><p>Query Cache（查询缓存）<br>   查询缓存： EF Core 还提供了一个查询缓存，用于存储已执行查询的结果，以便在相同的查询被再次执行时，能够直接从缓存中获取结果，而无需重新执行查询。</p>
<p>   缓存策略： 缓存的生命周期通常是相对短暂的，而且可以通过配置来调整缓存策略，以满足具体应用的需求。</p>
</li>
</ol>
</li>
<li><ol start="5">
<li>AsNoTracking（关闭跟踪）<br>   禁用跟踪： 在某些场景下，你可能希望禁用 EF Core 的跟踪机制，以减轻上下文的内存压力，可以使用 AsNoTracking 方法来告诉 EF Core 不要追踪查询结果。<br>   csharp<br>   Copy code<br>   var entities &#x3D; dbContext.Entities.AsNoTracking().ToList();<br>   需要注意的是，EF Core 的缓存机制是针对上下文内部的数据状态管理，它并不是一个通用的查询结果缓存，如果需要更高级的缓存策略，你可能需要考虑使用其他缓存机制，如分布式缓存。</li>
</ol>
</li>
<li><p>不要使用Contains()方法进行模糊查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    //var result = SeckillContext.Seckills.ToList();</span><br><span class="line">    // 1、模糊查询商品列表。 1、全文索引</span><br><span class="line">    #region 1、根据条件模糊查询商品.通过商品名称</span><br><span class="line">    &#123;</span><br><span class="line">        // 匹配结束(会走索引) like</span><br><span class="line">        var Seckill2 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.EndsWith(&quot;P&quot;)).ToList();</span><br><span class="line"></span><br><span class="line">        // 匹配开始(会走索引) like</span><br><span class="line">        var Seckill1 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;)).ToList();</span><br><span class="line"></span><br><span class="line">        // 匹配开始(不会走索引) like</span><br><span class="line">        var Seckill3 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.Contains(&quot;P&quot;)).ToList();</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>只返回必要的字段，字段越多，越浪费资源，所需时间也越多</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    // 2、客户端要求查询商品。只返回商品价格</span><br><span class="line">    #region 2、指定列查询。</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、所有列查询</span><br><span class="line">        /*foreach (var seckill in SeckillContext.Seckills)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;Seckill: &quot; + seckill.SeckillPrice);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 2、指定列查询</span><br><span class="line">        foreach (var SeckillPrice in SeckillContext.Seckills.Select(b =&gt;new &#123; b.SeckillPrice, b.SeckillName &#125;))</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;Seckill: &quot; + SeckillPrice);</span><br><span class="line">        &#125;*/</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>限制结果集，减少请求数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    // 3、批量查询商品数据。</span><br><span class="line">    #region 3、限制结果集  Take limit</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、查询结果集</span><br><span class="line">        var seckills1 = SeckillContext.Seckills</span><br><span class="line">        .Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;))</span><br><span class="line">        .ToList();</span><br><span class="line"></span><br><span class="line">        // 2、限制结果集</span><br><span class="line">        var seckills2 = SeckillContext.Seckills</span><br><span class="line">        .Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;))</span><br><span class="line">        .Take(1) // 限制结果集数量。</span><br><span class="line">        .Skip(0) // 数据的偏移量</span><br><span class="line">        .ToList();</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询数据时，尽量使用缓存或者缓冲，提高查询性能</p>
</li>
<li><p>缓存，可以多次存储，缓冲，只能存储一次，使用后会清空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    #region 4、缓冲和流式处理</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、流式处理(遍历查询每次查询数据库）</span><br><span class="line">        var seckills = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;));</span><br><span class="line">        foreach (var seckill in seckills)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(seckill.SeckillName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 2、缓冲处理(分页查询。非常.ToList() ToArray())</span><br><span class="line">        var seckills1 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;)).ToList();</span><br><span class="line">        var seckills2 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;)).ToArray();</span><br><span class="line"></span><br><span class="line">        // 3、流式处理(内存资源)</span><br><span class="line">        var seckills3 = SeckillContext.Seckills</span><br><span class="line">        .Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;))</span><br><span class="line">        .AsEnumerable();</span><br><span class="line">     &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>尽量使用非跟踪查询，节约操作及时间（跟踪会记录操作，非跟踪不会记录操作）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">     #region 5、尽量使用非跟踪查询</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、跟踪查询</span><br><span class="line">        var seckills1 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;)).AsTracking().ToList();</span><br><span class="line">        seckills1[0].SeckillName = &quot;123123&quot;;</span><br><span class="line">        SeckillContext.SaveChanges();</span><br><span class="line"></span><br><span class="line">        // 2、非跟踪查询</span><br><span class="line">        var seckills2 = SeckillContext.Seckills.Where(p =&gt; p.SeckillName.StartsWith(&quot;P&quot;)).AsNoTracking().ToList();</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多使用异步查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">     #region 6、使用异步</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、同步处理</span><br><span class="line">        var sec = SeckillContext.Seckills.Where(b =&gt; b.SeckillName.StartsWith(&quot;P&quot;)).ToList();</span><br><span class="line"></span><br><span class="line">        // 2、异步处理。时间来获取先后顺序</span><br><span class="line">        var blogs = await SeckillContext.Seckills.Where(b =&gt; b.SeckillName.StartsWith(&quot;P&quot;)).ToListAsync();</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询的时候，使用懒加载，需要的时候使用，不需要的时候为空</p>
</li>
<li><p>在 Startup 类的 ConfigService 方法里面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 3、开启懒加载(导航属性需要就用，不需要就不用)</span><br><span class="line">options.UseLazyLoadingProxies();</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    // 4、关联查询。查询商品--商品浏览记录。懒加载----&gt; </span><br><span class="line">    #region 7、关联查询尽量预加载  查询商品--商品浏览记录</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、关联延迟加载。会出现 1+N问题。1+N 一次商品。N次商品记录查询。</span><br><span class="line">        var seckills = SeckillContext.Seckills.ToList();</span><br><span class="line">        foreach (var seckill in seckills)</span><br><span class="line">        &#123;</span><br><span class="line">            foreach (var seckillRecord in seckill.seckillRecords)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine($&quot;seckillRecord &#123;seckillRecord.RecordTotalprice&#125;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 2、关联预先加载。一次性所有加载。</span><br><span class="line">        var seckills1 = SeckillContext.Seckills.Include(seckill =&gt; seckill.seckillRecords).ToList();</span><br><span class="line">        foreach (var seckill in seckills1)</span><br><span class="line">        &#123;</span><br><span class="line">            foreach (var seckillRecord in seckill.seckillRecords)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine($&quot;seckillRecord &#123;seckillRecord.RecordTotalprice&#125;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return seckills;</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询的时候，使用 AsSplitQuery 分开查询，避免笛卡尔积的问题（笛卡尔积问题：关联查询时，副表没有数据，会把所有副表字段都查询出来，影响性能）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    #region 8、关联查询(避免笛卡尔积) // 1、查询商品----&gt;商品记录返回</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、关联查询(预先加载)</span><br><span class="line">        var seckills1 = SeckillContext.Seckills</span><br><span class="line">        .Include(seckill =&gt; seckill.seckillRecords)</span><br><span class="line">        .ToList();</span><br><span class="line"></span><br><span class="line">        // 2、关联拆分查询(预先加载笛卡尔积的问题)</span><br><span class="line">        var seckills2 = SeckillContext.Seckills</span><br><span class="line">        .Include(seckills =&gt; seckills.seckillRecords)</span><br><span class="line">        .AsSplitQuery() // efcore 5.0 .AsSingleQuery()//分开查询。</span><br><span class="line">        .ToList();</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>尽量使用原始SQL语句查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    #region 9、使用原始sql</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、sql查询</span><br><span class="line">        var seckills = SeckillContext.Seckills.FromSqlRaw(&quot;select * from seckills&quot;).ToList();</span><br><span class="line"></span><br><span class="line">        // 2、原始sql执行存储过程</span><br><span class="line">        var blogs = SeckillContext.Seckills</span><br><span class="line">        .FromSqlRaw(&quot;EXECUTE dbo.GetMostPopularBlogs&quot;)</span><br><span class="line">        .ToList();</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用批处理，不要一个个执行语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">     #region 10、批处理(默认执行42个。默认只会执行42个)</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、多个sql语句操作（默认用的是：跟踪）</span><br><span class="line">        var seckill1 = SeckillContext.Seckills.Single(b =&gt; b.SeckillName == &quot;P6&quot;); // 单个数据查询</span><br><span class="line">        seckill1.SeckillName = &quot;iPhone&quot;;</span><br><span class="line">        SeckillContext.SaveChanges();</span><br><span class="line"></span><br><span class="line">        SeckillContext.Seckills.Add(new Seckill &#123; SeckillName = &quot;phone3&quot; &#125;);</span><br><span class="line">        SeckillContext.SaveChanges();</span><br><span class="line"></span><br><span class="line">        SeckillContext.Seckills.Add(new Seckill &#123; SeckillName = &quot;phone4&quot; &#125;);</span><br><span class="line">        SeckillContext.SaveChanges();</span><br><span class="line"></span><br><span class="line">        // 2、批处理(跟踪更新)</span><br><span class="line">        var seckill2 = SeckillContext.Seckills.Single(b =&gt; b.SeckillName == &quot;iPhone&quot;);</span><br><span class="line">        seckill2.SeckillName = &quot;iPhone 13&quot;;</span><br><span class="line">        SeckillContext.Add(new Seckill &#123; SeckillName = &quot;phone2&quot; &#125;);</span><br><span class="line">        SeckillContext.Add(new Seckill &#123; SeckillName = &quot;phone3&quot; &#125;);</span><br><span class="line">        // 41条批量语句</span><br><span class="line">        // 100000万条。直接sql</span><br><span class="line">        SeckillContext.SaveChanges();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在Startup类的ConfigService方法配置批处理数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 1、添加数据库上下文到IOC容器</span><br><span class="line">services.AddDbContextPool&lt;SeckillContext&gt;(options =&gt; &#123;</span><br><span class="line">    options.UseMySql(Configuration.GetConnectionString(&quot;DefaultConnection&quot;),</span><br><span class="line">        new MySqlServerVersion(&quot;5.7.22&quot;), o =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            o.MinBatchSize(1); // 更新批处理操作最小个数</span><br><span class="line">            o.MaxBatchSize(100); //更新批处理操作最大个数</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>大容量更新</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">     #region 11、大容量更新</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、默认批处理10万条。</span><br><span class="line">        foreach (var seckill in SeckillContext.Seckills)</span><br><span class="line">        &#123;</span><br><span class="line">            seckill.SeckillName = &quot;Tony&quot;; // 批量一个一个更新</span><br><span class="line">        &#125;</span><br><span class="line">        SeckillContext.SaveChanges();</span><br><span class="line"></span><br><span class="line">        // 2、直接sql处理（减少客户端数据）</span><br><span class="line">        SeckillContext.Seckills.FromSqlRaw(&quot;UPDATE [Seckills] SET [SeckillName] = &#x27;Tony&#x27;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DbContext连接池</p>
</li>
<li><p>在 Startup 类的 ConfigService 方法里面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">            services.AddDbContextPool&lt;BloggingContext&gt;(</span><br><span class="line">options =&gt; options.UseSqlServer(connectionString));</span><br></pre></td></tr></table></figure>
</li>
<li><p>多使用参数化查询，使用复用语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    // 高级性能主题 </span><br><span class="line">    #region 13、查询缓存和参数化(预编译) 编译预先的sql。复用sql语句，提升性能目的</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、固定值查询（生成2条sql）直接生成sql</span><br><span class="line">        var seckill1 = SeckillContext.Seckills.FirstOrDefault(p =&gt; p.SeckillName == &quot;iPhone 13&quot;);</span><br><span class="line">        var seckill2 = SeckillContext.Seckills.FirstOrDefault(p =&gt; p.SeckillName == &quot;123123&quot;);</span><br><span class="line"></span><br><span class="line">        // 2、参数化查询（生成一条sql）原理 ：sql参数缓存</span><br><span class="line">        var SeckillName = &quot;iPhone 13&quot;;</span><br><span class="line">        var seckill3 = SeckillContext.Seckills.FirstOrDefault(p =&gt; p.SeckillName == SeckillName);</span><br><span class="line">        SeckillName = &quot;123123&quot;;</span><br><span class="line">        var seckill4 = SeckillContext.Seckills.FirstOrDefault(p =&gt; p.SeckillName == SeckillName);</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用动态拼接查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询秒杀商品接口</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public IEnumerable&lt;Seckill&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">     // 查询商品：商品名称，商品价格，商品ID</span><br><span class="line">    #region 14、动态拼接查询</span><br><span class="line">    &#123;</span><br><span class="line">        IQueryable&lt;Seckill&gt; seckills = SeckillContext.Seckills;</span><br><span class="line"></span><br><span class="line">        if (seckill.SeckillName != null &amp;&amp; seckill.SeckillName.Length &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            seckills = seckills.Where(b =&gt; b.SeckillName == seckill.SeckillName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/7%E3%80%81MySQL%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/7%E3%80%81MySQL%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">7、MySQL调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-06 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-06T10:48:57+08:00">2023-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-30 00:40:18" itemprop="dateModified" datetime="2024-01-30T00:40:18+08:00">2024-01-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/7%E3%80%81MySQL%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/06/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/7%E3%80%81MySQL%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="慢sql语句查询"><a href="#慢sql语句查询" class="headerlink" title="慢sql语句查询"></a>慢sql语句查询</h1><p>mysqld.exe –defaults-file&#x3D;D:\work\net\mysql\MySQL-Server-5.7\my.ini</p>
<p>mysqld install MySQL –defaults-file&#x3D;D:\work\net\mysql\MySQL-Server-5.7\my.ini</p>
<p>MySQL 慢查询的相关参数解释：</p>
<p>slow_query_log ：是否开启慢查询日志，1表示开启，0表示关闭。</p>
<p>log-slow-queries ：旧版（5.6以下版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log</p>
<p>slow-query-log-file：新版（5.6及以上版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log</p>
<p>long_query_time ：慢查询阈值，当查询时间多于设定的阈值时，记录日志。</p>
<p>log_queries_not_using_indexes：未使用索引的查询也被记录到慢查询日志中（可选项）。</p>
<p>log_output：日志存储方式。log_output&#x3D;‘FILE’表示将日志存入文件，默认值是’FILE’。log_output&#x3D;‘TABLE’表示将日志存入数据库，这样日志信息就会被写入到mysql.slow_log表中。MySQL数据库支持同时两种日志存储方式，配置的时候以逗号隔开即可，如：log_output&#x3D;‘FILE,TABLE’。日志记录到系统的专用日志表中，要比记录到文件耗费更多的系统资源，因此对于需要启用慢查询日志，又需要能够获得更高的系统性能，那么建议优先记录到文件。</p>
<h1 id="查看慢查询日志"><a href="#查看慢查询日志" class="headerlink" title="查看慢查询日志"></a>查看慢查询日志</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like ‘%slow_query_log%’</span><br></pre></td></tr></table></figure>
<p>开启慢查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global slow_query_log=1</span><br></pre></td></tr></table></figure>
<p>关闭慢查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global slow_query_log=0</span><br></pre></td></tr></table></figure>
<p>慢查询记录时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;long_query_time%&#x27;;</span><br></pre></td></tr></table></figure>
<p>设置慢查询时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global long_query_time=4;</span><br></pre></td></tr></table></figure>
<p>执行慢查询sql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sleep(3);</span><br></pre></td></tr></table></figure>
<p>日志分析工具<strong>mysqldumpslow</strong></p>
<p>在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具mysqldumpslow</p>
<p>查看mysqldumpslow的帮助信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@DB-Server ~]# mysqldumpslow --help mysqldump --help</span><br><span class="line">Usage: mysqldumpslow [ OPTS... ] [ LOGS... ]</span><br><span class="line"> </span><br><span class="line">Parse and summarize the MySQL slow query log. Options are</span><br><span class="line"> </span><br><span class="line">  --verbose    verbose</span><br><span class="line">  --debug      debug</span><br><span class="line">  --help       write this text to standard output</span><br><span class="line"> </span><br><span class="line">  -v           verbose</span><br><span class="line">  -d           debug</span><br><span class="line">  -s ORDER     what to sort by (al, at, ar, c, l, r, t), &#x27;at&#x27; is default</span><br><span class="line">                al: average lock time</span><br><span class="line">                ar: average rows sent</span><br><span class="line">                at: average query time</span><br><span class="line">                 c: count</span><br><span class="line">                 l: lock time</span><br><span class="line">                 r: rows sent</span><br><span class="line">                 t: query time  </span><br><span class="line">  -r           reverse the sort order (largest last instead of first)</span><br><span class="line">  -t NUM       just show the top n queries</span><br><span class="line">  -a           don&#x27;t abstract all numbers to N and strings to &#x27;S&#x27;</span><br><span class="line">  -n NUM       abstract numbers with at least n digits within names</span><br><span class="line">  -g PATTERN   grep: only consider stmts that include this string</span><br><span class="line">  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),</span><br><span class="line">               default is &#x27;*&#x27;, i.e. match all</span><br><span class="line">  -i NAME      name of server instance (if using mysql.server startup script)</span><br><span class="line">  -l           don&#x27;t subtract lock time from total time</span><br></pre></td></tr></table></figure>
<p>-s, 是表示按照何种方式排序，</p>
<pre><code>c: 访问计数

l: 锁定时间

r: 返回记录

t: 查询时间

al:平均锁定时间

ar:平均返回记录数

at:平均查询时间
</code></pre>
<p>-t, 是top n的意思，即为返回前面多少条的数据；</p>
<p>-g, 后边可以写一个正则匹配模式，大小写不敏感的；</p>
<p>比如</p>
<p>得到返回记录集最多的10个SQL。</p>
<p>mysqldumpslow -s r -t 10 &#x2F;database&#x2F;mysql&#x2F;mysql06_slow.log</p>
<p>得到访问次数最多的10个SQL</p>
<p>mysqldumpslow -s c -t 10 &#x2F;database&#x2F;mysql&#x2F;mysql06_slow.log</p>
<p>得到按照时间排序的前10条里面含有左连接的查询语句。</p>
<p>mysqldumpslow -s t -t 10 -g “left join” &#x2F;database&#x2F;mysql&#x2F;mysql06_slow.log</p>
<p>另外建议在使用这些命令时结合 | 和more 使用 ，否则有可能出现刷屏的情况。</p>
<p>mysqldumpslow -s r -t 20 &#x2F;mysqldata&#x2F;mysql&#x2F;mysql06-slow.log | more</p>
<h1 id="Sql语句查询计划Explain"><a href="#Sql语句查询计划Explain" class="headerlink" title="Sql语句查询计划Explain"></a>Sql语句查询计划Explain</h1><h2 id="什么是Explain"><a href="#什么是Explain" class="headerlink" title="什么是Explain"></a>什么是Explain</h2><p>分析sql语句执行计划。</p>
<h2 id="为什么要使用Explain"><a href="#为什么要使用Explain" class="headerlink" title="为什么要使用Explain"></a>为什么要使用Explain</h2><p>目的：了解sql语句如何从表中查询到目标数据</p>
<h2 id="如何使用Explain分析sql"><a href="#如何使用Explain分析sql" class="headerlink" title="如何使用Explain分析sql"></a>如何使用Explain分析sql</h2><p>条件</p>
<p>1、Explain</p>
<p>步骤</p>
<p>1、先执行Sql,然后通过Explain分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line"> SELECT `s`.`ProductId`, `s`.`SeckillDescription`, `s`.`SeckillIstop`, `s`.`SeckillLimit`, `s`.`SeckillName`, `s`.`SeckillPercent`, `s`.`SeckillPrice`, `s`.`SeckillStatus`, `s`.`SeckillStock`, `s`.`SeckillType`, `s`.`SeckillUrl`, `s`.`TimeId` FROM `Seckills` AS `s`</span><br></pre></td></tr></table></figure>
<p>2、然后分析语句详细细节</p>
<pre><code>id: 查询的唯一标识
select_type: 查询的类型
table: 查询的表, 可能是数据库中的表/视图，也可能是 FROM 中的子查询
type: 搜索数据的方法
possible_keys: 可能使用的索引
key: 最终决定要使用的key
key_len: 查询索引使用的字节数。通常越少越好
ref: 查询的列或常量
rows: 需要扫描的行数，估计值。通常越少越好
filtered：过滤rows返回的数据。
extra: 额外的信息
</code></pre>
<h3 id="执行计划-ID"><a href="#执行计划-ID" class="headerlink" title="执行计划-ID"></a>执行计划-ID</h3><p>select查询的序列号,包含一组数字，表示查询中执行select子句或操作表的顺序</p>
<p>有三种情况：<br>（1）、id相同，执行顺序由上至下<br>（2）、id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行<br>（3）、id相同不同，同时存在</p>
<p>执行计划-select-type</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SIMPLE: 简单查询，不包含子查询和union</span><br><span class="line">PRIMRARY: 包含子查询时的最外层查询; 使用union时的第一个查询</span><br><span class="line">UNION: 包含union的查询中非第一个查询</span><br><span class="line">UNION RESULT 临时结果</span><br><span class="line">DEPENDENT UNION: 与 UNION 相同，但依赖外层查询的结果 次要</span><br><span class="line">SUBQUERY: 子查询</span><br><span class="line">DEPENDENT SUBQUERY: 依赖外层查询的子查询</span><br><span class="line">DERIVED: 用于 FROM 中的子查询(中间表)</span><br></pre></td></tr></table></figure>
<p>联合查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explain</span><br><span class="line">SELECT `s`.`ProductId`, `s`.`SeckillDescription`, `s`.`SeckillIstop`, `s`.`SeckillLimit`, `s`.`SeckillName`, `s`.`SeckillPercent`, `s`.`SeckillPrice`, `s`.`SeckillStatus`, `s`.`SeckillStock`, `s`.`SeckillType`, `s`.`SeckillUrl`, `s`.`TimeId` FROM `Seckills` AS `s` </span><br><span class="line">  union</span><br><span class="line">  SELECT `s`.`ProductId`, `s`.`SeckillDescription`, `s`.`SeckillIstop`, `s`.`SeckillLimit`, `s`.`SeckillName`, `s`.`SeckillPercent`, `s`.`SeckillPrice`, `s`.`SeckillStatus`, `s`.`SeckillStock`, `s`.`SeckillType`, `s`.`SeckillUrl`, `s`.`TimeId`</span><br><span class="line">  FROM `Seckills` AS `s`</span><br></pre></td></tr></table></figure>

<p>子查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  Explain</span><br><span class="line">  SELECT * FROM Seckills WHERE Id = (</span><br><span class="line">SELECT SeckillId FROM seckillrecords WHERE SeckillNum = 1</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p>子查询依赖查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explain</span><br><span class="line">SELECT * FROM Seckills WHERE Id = (</span><br><span class="line">  SELECT SeckillId FROM seckillrecords WHERE SeckillNum = 1 and Seckills.Id = 		seckillrecords.SeckillId</span><br><span class="line"> );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>联合查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Explain</span><br><span class="line">SELECT `s`.`Id`, `s`.`ProductId`, `s`.`SeckillDescription`, `s`.`SeckillIstop`, `s`.`SeckillLimit`, `s`.`SeckillName`, `s`.`SeckillPercent`, `s`.`SeckillPrice`, `s`.`SeckillStatus`, `s`.`SeckillStock`, `s`.`SeckillType`, `s`.`SeckillUrl`, `s`.`TimeId`, `s0`.`Id`, `s0`.`Createtime`, `s0`.`OrderSn`, `s0`.`ProductPrice`, `s0`.`RecordStatus`, `s0`.`RecordTotalprice`, `s0`.`SeckillId`, `s0`.`SeckillNum`, `s0`.`SeckillPrice`, `s0`.`Updatetime`, `s0`.`UserId`</span><br><span class="line">      FROM `Seckills` AS `s`</span><br><span class="line">      LEFT JOIN `SeckillRecords` AS `s0` ON `s`.`Id` = `s0`.`SeckillId`</span><br><span class="line">      ORDER BY `s`.`Id`, `s0`.`Id`</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="执行计划-type"><a href="#执行计划-type" class="headerlink" title="执行计划-type"></a>执行计划-type</h1><p>type 字段描述了查询的方式，从好到坏为:</p>
<p>null: 不需要访问索引和表即可完成, 示例: SELECT 1;</p>
<p>const: 表中仅有一行匹配，在分解查询计划时直接将其读出作为常量使用。system 是 const 类型的特例。<br>示例:SELECT * FROM Seckills WHERE SeckillId &#x3D; 4;</p>
<p>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>| —- | ———– | —– | —– | ————- | ——– | ——- | —– | —- | ———– |<br>| 1 | SIMPLE | user | const | uni_name | uni_name | 258 | const | 1 | Using index |</p>
<p>UNIQUE KEY uni_name (name) ON user</p>
<p>eq_ref: 使用 PRIMARY KEY 或 UNIQUE KEY 进行关联查询。<br>示例:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  SELECT *</span><br><span class="line"> FROM Seckills  left join seckillrecords </span><br><span class="line"> on Seckills .Id = seckillrecords .SeckillId </span><br><span class="line">where seckillrecords .SeckillNum = 1</span><br></pre></td></tr></table></figure>
<p>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>| —- | ———– | ————– | —— | ————- | ——- | ——- | ——– | —– | ———– |<br>| 1 | SIMPLE | Seckills | ALL | idx_uid | 0 | 0 | 0 | 57796 | null |<br>| 1 | SIMPLE | seckillrecords | eq_ref | PRIMARY | PRIMARY | 8 | post.uid | 1 | Using where |</p>
<p>ref: 使用允许重复的索引进行查询<br>示例: SELECT * FROM seckillrecords WHERE SeckillNum&#x3D;1;<br>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>| —- | ———– | —– | —- | ————- | ———- | ——- | —– | —- | ——————— |<br>| 1 | SIMPLE | user | ref | SeckillNum | SeckillNum | 4 | const | 1 | Using index condition |</p>
<p>range: 使用索引进行范围查询:<br>示例: SELECT * FROM seckillrecords WHERE SeckillNum &gt; 2;<br>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>| —- | ———– | —– | —- | ————- | ——- | ——- | —– | —- | —– |<br>| 1 | SIMPLE | user | ref | idx_age | idx_age | 259 | const | 1 | null |</p>
<p>index: 在索引上进行顺序扫描。常见于在多列索引中未使用最左列进行查询。<br>示例: SELECT * FROM seckillrecords WHERE OrderSn &#x3D; ‘sminit’;<br>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>| —- | ———– | —– | —- | ————- | ————- | ——- | —– | —- | ———– |<br>| 1 | SIMPLE | user | ref | idx_full_name | idx_full_name | 259 | const | 1 | Using where |</p>
<p>all: 扫描全表，最坏的情况</p>
<ul>
<li>执行计划-possible_keys ：</li>
</ul>
<p>实际使用的索引。如果为NULL，则没有使用索引，查询中若使用了覆盖索引，则该索引和查询的select字段重叠</p>
<ul>
<li>执行计划-key_len</li>
</ul>
<p>索引使用的字节数，相当于长度</p>
<p>char和varchar跟字符编码也有密切的联系,<br>​ latin1占用1个字节，gbk占用2个字节，utf8占用3个字节。（不同字符编码占用的存储空间不同）</p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-39.png" alt="Alt text"></p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-40.png" alt="Alt text"></p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-41.png" alt="Alt text"></p>
<ul>
<li><p>执行计划-ref ：<br>显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值</p>
</li>
<li><p>执行计划-rows：<br>根据表统计信息及索引选用情况，大致估算出找到所需的记录所需要读取的行数</p>
</li>
<li><p>执行计划-filtered</p>
</li>
<li><p>执行计划-Extra：<br>extra 列显示了查询过程中需要执行的其它操作，有些情况应尽力避免。</p>
</li>
</ul>
<p>using filesort: 查询时执行了排序操作而无法使用索引排序。虽然名称为’file’但操作可能是在内存中执行的，取决是否有足够的内存进行排序。<br>应尽量避免这种filesort出现。<br>using temporary: 使用临时表存储中间结果，常见于ORDER BY和GROUP BY语句中。临时表可能在内存中也可能在硬盘中，应尽量避免这种操作出现。<br>using index: 索引中包含查询的所有列不需要查询数据表(回表)。可以加快查询速度。<br>using where: 使用了WHERE从句来限制哪些行将与下一张表匹配或者是返回给客户端<br>using index condition: 索引条件推送(MySQL 5.6 新特性)，服务器层将不能直接使用索引的查询条件推送给存储引擎，从而避免在服务器层进行过滤。<br>distinct: 优化distinct操作，查询到匹配的数据后停止继续搜索</p>
<h1 id="sql语句性能Profile"><a href="#sql语句性能Profile" class="headerlink" title="sql语句性能Profile"></a>sql语句性能Profile</h1><h2 id="什么是Profile"><a href="#什么是Profile" class="headerlink" title="什么是Profile"></a>什么是Profile</h2><p>profile是sql性能监控工具，专门用来监控sql语句执行时间。用来达到sql性能监控目的</p>
<h2 id="如何使用Profile监控sql语句"><a href="#如何使用Profile监控sql语句" class="headerlink" title="如何使用Profile监控sql语句"></a>如何使用Profile监控sql语句</h2><p>条件</p>
<p>1、Profile</p>
<p>步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1、先在客户端打开Profile</span><br><span class="line"></span><br><span class="line">set profiling=1; </span><br><span class="line"></span><br><span class="line">2、然后执行sql语句</span><br><span class="line"></span><br><span class="line">select * from table</span><br><span class="line"></span><br><span class="line">update from table</span><br><span class="line"></span><br><span class="line">delete from table</span><br><span class="line"></span><br><span class="line">insert () table valus();</span><br><span class="line"></span><br><span class="line">3、然后统计执行时间</span><br><span class="line"></span><br><span class="line">show profiles; </span><br></pre></td></tr></table></figure>
<p>   会展示sql语句执行时间<br>Profile 显示sql执行过程详细时间<br>条件</p>
<p>1、profile</p>
<p>步骤</p>
<p>1、先执行;   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show profile for query 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>1：为sql语句监控编号
</code></pre>
<p>2、然后统计出过程<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-42.png" alt="Alt text"></p>
<p>上图中纵向栏意义<br>+———————-+———-+———-+————+<br>starting：开始<br>checking permissions：检查权限<br>Opening tables：打开表<br>init ： 初始化<br>System lock ：系统锁<br>optimizing ： 优化<br>statistics ： 统计<br>preparing ：准备<br>executing ：执行<br>Sending data ：发送数据<br>Sorting result ：排序<br>end ：结束<br>query end ：查询 结束<br>closing tables ： 关闭表 ／去除TMP 表<br>freeing items ： 释放物品<br>cleaning up ：清理</p>
<h1 id="Profile-显示sql详细执行过程"><a href="#Profile-显示sql详细执行过程" class="headerlink" title="Profile 显示sql详细执行过程"></a>Profile 显示sql详细执行过程</h1><p>条件</p>
<p>1、Profile</p>
<p>步骤</p>
<p>1、执行</p>
<p>show profile all for query 1</p>
<p>2、然后进行图形展示</p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-43.png" alt="Alt text"></p>
<p>上图中横向栏意义<br>+———————-+———-+———-+————+<br>“Status”: “query end”, 状态<br>“Duration”: “1.751142”, 持续时间<br>“CPU_user”: “0.008999”, cpu用户<br>“CPU_system”: “0.003999”, cpu系统<br>“Context_voluntary”: “98”, 上下文主动切换<br>“Context_involuntary”: “0”, 上下文被动切换<br>“Block_ops_in”: “8”, 阻塞的输入操作<br>“Block_ops_out”: “32”, 阻塞的输出操作<br>“Messages_sent”: “0”, 消息发出<br>“Messages_received”: “0”, 消息接受<br>“Page_faults_major”: “0”, 主分页错误<br>“Page_faults_minor”: “0”, 次分页错误<br>“Swaps”: “0”, 交换次数<br>“Source_function”: “mysql_execute_command”, 源功能<br>“Source_file”: “sql_parse.cc”, 源文件<br>“Source_line”: “4465” 源代码行</p>
<h1 id="Profile-关闭监控"><a href="#Profile-关闭监控" class="headerlink" title="Profile 关闭监控"></a>Profile 关闭监控</h1><p>条件</p>
<p>1、profile</p>
<p>步骤</p>
<p>1、执行</p>
<p>set profiling&#x3D;0;</p>
<p>汇总操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">set profiling=1;                  //打开监控</span><br><span class="line"> </span><br><span class="line">run your sql1; #执行sql</span><br><span class="line"> </span><br><span class="line">run your sql2; #执行sql</span><br><span class="line"> </span><br><span class="line">show profiles;                    //查看sql1,sql2的语句分析</span><br><span class="line"> </span><br><span class="line">show profile for query 1;        //查看sql1的具体分析</span><br><span class="line"> </span><br><span class="line">show profile ALL for query 1;    //查看sql1相关的所有分析【主要看i/o与cpu,下边分析中有各项意义介绍】</span><br><span class="line"> </span><br><span class="line">set profiling=0;                  //关闭分析</span><br></pre></td></tr></table></figure>
<h1 id="Sql语句优化"><a href="#Sql语句优化" class="headerlink" title="Sql语句优化"></a>Sql语句优化</h1><p>索引就是目录B+树<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-44.png" alt="Alt text"></p>
<ul>
<li>有一下SQL表，直接查询编号3数据。<blockquote>
<p>1、for循环。一个一个判断。4次查询操作。每一次查询都需要消耗时间。<br>2、200万数据  for循环。200万。时间累加。时间边长。性能下降。原因：1、查询次数多了。</p>
</blockquote>
</li>
</ul>
<h3 id="需求：性能能够提升。方案：查询次数减少。"><a href="#需求：性能能够提升。方案：查询次数减少。" class="headerlink" title="需求：性能能够提升。方案：查询次数减少。"></a>需求：性能能够提升。方案：查询次数减少。</h3><p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-45.png" alt="Alt text"></p>
<h3 id="Mysql中如何使用索引"><a href="#Mysql中如何使用索引" class="headerlink" title="Mysql中如何使用索引"></a>Mysql中如何使用索引</h3><ul>
<li><p>步骤1、先创建商品表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE product (  </span><br><span class="line">    Id bigint(8) NOT NULL,  </span><br><span class="line">    ProductName char(245) NOT NULL DEFAULT &#x27;1&#x27;, </span><br><span class="line">     ProductId char(255) NOT NULL DEFAULT &#x27;1&#x27;,  </span><br><span class="line">     ProductDescription char(255) NOT NULL DEFAULT &#x27;1&#x27;,  </span><br><span class="line">    ProductUrl char(255) NOT NULL DEFAULT &#x27;1&#x27;,  </span><br><span class="line">    PRIMARY KEY (id)) </span><br><span class="line">    ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、然后创建存储过程product_insert BEGIN</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 定义一个临时变量 </span><br><span class="line">declare i int default 0;</span><br><span class="line"># 提交一次</span><br><span class="line">set autocommit = 0;</span><br><span class="line">set i = start_num;</span><br><span class="line"># 开始循环</span><br><span class="line">loopname:loop    </span><br><span class="line">    if i &gt; max_num then  </span><br><span class="line">        leave loopname; </span><br><span class="line">    end if; </span><br><span class="line">    set i = i + 1; </span><br><span class="line">    insert into product(Id,ProductName,ProductId,ProductDescription,ProductUrl) values(i,CONCAT(&#x27;p6+架构班&#x27;,i),CONCAT(&#x27;ydt&#x27;,i),CONCAT(&#x27;2021&#x27;,i),CONCAT(&#x27;tony&#x27;,i));</span><br><span class="line">    end loop loopname;END</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、然后执行存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">product_insert 插入1000万条数据CALL </span><br><span class="line">`product_insert`(&#x27;1&#x27;, &#x27;10000000&#x27;)</span><br><span class="line"></span><br><span class="line">   </span><br></pre></td></tr></table></figure>
</li>
<li><p>4、然后先直接根据商品Id查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select Id,ProductName,ProductId,ProductDescription,ProductUrl from product a where a.ProductId = &#x27;rm8807&#x27; </span><br><span class="line">计算出时间： 查询计划分析：</span><br><span class="line">select Id,ProductName,ProductId,ProductDescription,ProductUrl from product a where a.ProductId = &#x27;rm8807&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、然后使用索引优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5.1 在ProductId上创建索引    </span><br><span class="line">5.2 然后直接优化         </span><br><span class="line">计算出时间：         </span><br><span class="line">查询计划分析：</span><br><span class="line">select Id,ProductName,ProductId,ProductDescription,ProductUrl from product a where a.ProductId = &#x27;rm8807&#x27;</span><br></pre></td></tr></table></figure>


<p>  1、执行profile监控<br>  set profiling&#x3D;1;<br>  得出时间<br>  show profiles;<br>  2、执行查询计划<br>  得到是否走索引3、增加索引测试</p>
</li>
</ul>
<h2 id="Mysql如何正确的使用索引"><a href="#Mysql如何正确的使用索引" class="headerlink" title="Mysql如何正确的使用索引"></a>Mysql如何正确的使用索引</h2><pre><code>- 存储引擎：对数据存取操作  索引
</code></pre>
<h3 id="Mysql-InnoDB存储引擎-数据文件"><a href="#Mysql-InnoDB存储引擎-数据文件" class="headerlink" title="Mysql InnoDB存储引擎 数据文件"></a>Mysql InnoDB存储引擎 数据文件</h3><pre><code>    - product.frm
    - product.ibd
</code></pre>
<h3 id="Mysql搜索引擎如何组织数据Page（存储数据的容器）"><a href="#Mysql搜索引擎如何组织数据Page（存储数据的容器）" class="headerlink" title="Mysql搜索引擎如何组织数据Page（存储数据的容器）"></a>Mysql搜索引擎如何组织数据Page（存储数据的容器）</h3><pre><code>- Page：数据页
</code></pre>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-46.png" alt="Alt text"></p>
<ul>
<li>Page：索引页<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-47.png" alt="Alt text"></li>
</ul>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-48.png" alt="Alt text"></p>
<h3 id="索引页和数据页关系"><a href="#索引页和数据页关系" class="headerlink" title="索引页和数据页关系"></a>索引页和数据页关系</h3><p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-49.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-50.png" alt="Alt text"></p>
<h3 id="Mysql交互全局流程"><a href="#Mysql交互全局流程" class="headerlink" title="Mysql交互全局流程"></a>Mysql交互全局流程</h3><p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-51.png" alt="Alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看磁盘信息</span><br><span class="line">1、fsutil fsinfo ntfsinfo </span><br><span class="line">c:查看mysql文件信息</span><br><span class="line">java -jar innodbPageInfo.jar -path product.ibd -v 0</span><br></pre></td></tr></table></figure>

<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-52.png" alt="Alt text"></p>
<ul>
<li><p>一页存储多少数据<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-53.png" alt="Alt text"></p>
</li>
<li><p>数据页Page内部结构</p>
<p>  1、File Header，文件头，固定38字节；<br>  2、Page Header，页头，固定56字节；<br>  3、Infimum + supremum，固定26字节；<br>  4、User Records，用户记录，即行记录，大小不固定；<br>  5、Free Space，空闲空间，大小不固定；<br>  6、Page Directort，页目录，大小不固定；<br>  7、File Trailer，文件结尾信息，固定8字节。</p>
</li>
</ul>
<h1 id="存储引擎底层原理意义"><a href="#存储引擎底层原理意义" class="headerlink" title="存储引擎底层原理意义"></a>存储引擎底层原理意义</h1><p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-54.png" alt="Alt text"></p>
<h1 id="索引使用策略"><a href="#索引使用策略" class="headerlink" title="索引使用策略"></a>索引使用策略</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、数字索引</span><br><span class="line">2、字符索引</span><br><span class="line">3、日期和时间索引</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/05/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/5%E3%80%81HttpClient%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/05/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/5%E3%80%81HttpClient%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">5、HttpClient调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-05 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-05T10:48:57+08:00">2023-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-30 00:40:18" itemprop="dateModified" datetime="2024-01-30T00:40:18+08:00">2024-01-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/05/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/5%E3%80%81HttpClient%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/05/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/5%E3%80%81HttpClient%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>在 .NET 中使用 HttpClient 进行 HTTP 请求时，HttpClient 本身并没有内建的缓存机制。然而，你可以通过一些技术手段来实现自定义的缓存策略。以下是一些常见的缓存实现方式：</p>
</blockquote>
<h1 id="HttpClient-缓存"><a href="#HttpClient-缓存" class="headerlink" title="HttpClient 缓存"></a>HttpClient 缓存</h1><ul>
<li>引入 缓存包 Microsoft.Extensions.Caching.Memory</li>
<li>修改 Startup 的 ConfigureServices 方法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddMemoryCache();</span><br></pre></td></tr></table></figure></li>
<li>控制器访问HttpClient的时候进行缓存<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-38.png" alt="Alt text"></li>
</ul>
<h1 id="HttpClient-自动缓存"><a href="#HttpClient-自动缓存" class="headerlink" title="HttpClient 自动缓存"></a>HttpClient 自动缓存</h1><ul>
<li><p>创建 CacheHttpClientMessageHanlder 类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 自定义</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public class CacheHttpClientMessageHanlder : DelegatingHandler</span><br><span class="line">&#123;</span><br><span class="line">    private readonly IMemoryCache _memoryCache;// 本地缓存</span><br><span class="line">    private readonly IDistributedCache _distributedCache; // 分布式缓存</span><br><span class="line"></span><br><span class="line">    public CacheHttpClientMessageHanlder(IMemoryCache memoryCache, </span><br><span class="line">        IDistributedCache distributedCache)</span><br><span class="line">    &#123;</span><br><span class="line">        _memoryCache = memoryCache;</span><br><span class="line">        _distributedCache = distributedCache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override Task&lt;HttpResponseMessage&gt; SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)</span><br><span class="line">    &#123;</span><br><span class="line">        // 2、本地缓存</span><br><span class="line">        HttpResponseMessage httpResponseMessage = _memoryCache.Get&lt;HttpResponseMessage&gt;(request.RequestUri.AbsoluteUri);</span><br><span class="line"></span><br><span class="line">        // 3、获取响应头中，</span><br><span class="line">        if (httpResponseMessage == null)</span><br><span class="line">        &#123;</span><br><span class="line">            // 2.1、从远程查找</span><br><span class="line">            httpResponseMessage = base.SendAsync(request, cancellationToken).Result;</span><br><span class="line"></span><br><span class="line">            // 2.2、是否需要缓存</span><br><span class="line">            CacheControlHeaderValue cacheControl = httpResponseMessage.Headers.CacheControl;</span><br><span class="line">            var NoCache = cacheControl.NoCache;</span><br><span class="line">            var NoStore = cacheControl.NoStore;</span><br><span class="line">            var MaxAge = cacheControl.MaxAge;</span><br><span class="line">            if (!NoCache &amp;&amp; !NoStore)</span><br><span class="line">            &#123;</span><br><span class="line">                // 1、设置缓存过期时间</span><br><span class="line">                MemoryCacheEntryOptions memoryCacheEntryOptions = new MemoryCacheEntryOptions();</span><br><span class="line">                memoryCacheEntryOptions.AbsoluteExpirationRelativeToNow = MaxAge; // 过期时间</span><br><span class="line"></span><br><span class="line">                // 2.2、存储到本地缓存中</span><br><span class="line">                _memoryCache.Set&lt;HttpResponseMessage&gt;(request.RequestUri.AbsoluteUri, httpResponseMessage, memoryCacheEntryOptions);</span><br><span class="line">            &#125;</span><br><span class="line">            return Task.FromResult(httpResponseMessage);</span><br><span class="line">        &#125; else</span><br><span class="line">        &#123;</span><br><span class="line">            // 2.2、是否直接返回缓存数据</span><br><span class="line">            CacheControlHeaderValue cacheControl = httpResponseMessage.Headers.CacheControl;</span><br><span class="line">            var NoCache = cacheControl.NoCache; // 1、是否缓存</span><br><span class="line">            var NoStore = cacheControl.NoStore; // 2、是否存储</span><br><span class="line">            var MaxAge = cacheControl.MaxAge;</span><br><span class="line">            if (!NoCache || !NoStore)</span><br><span class="line">            &#123;</span><br><span class="line">                return Task.FromResult(httpResponseMessage);</span><br><span class="line">            &#125; else</span><br><span class="line">            &#123;</span><br><span class="line">                httpResponseMessage = base.SendAsync(request, cancellationToken).Result;</span><br><span class="line"></span><br><span class="line">                return Task.FromResult(httpResponseMessage);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 Startup 类的 ConfigureServices 方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">services.AddTransient&lt;CacheHttpClientMessageHanlder&gt;();</span><br><span class="line">services.AddHttpClient(&quot;CacheClient&quot;).</span><br><span class="line">   AddHttpMessageHandler&lt;CacheHttpClientMessageHanlder&gt;();// 配置HttpClient</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务端引入 Marvin.Cache.Headers 包</p>
</li>
<li><p>在 Startup 类的 ConfigureServices 方法里面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//10、添加响应缓存(Http缓存)</span><br><span class="line">services.AddHttpCacheHeaders(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    // 1、浏览器和服务器需要进行数据验证。</span><br><span class="line">    options.MustRevalidate = true;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Startup 类的 Configure 方法添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 1、开启响应缓存(Http缓存)</span><br><span class="line">app.UseHttpCacheHeaders();</span><br></pre></td></tr></table></figure>
</li>
<li><p>在服务端的控制器里面添加  [HttpCacheExpiration(NoStore&#x3D;false, MaxAge&#x3D;10000)] 特性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[HttpGet]</span><br><span class="line">[HttpCacheExpiration(NoStore=false, MaxAge=10000)]</span><br><span class="line">public ActionResult&lt;IEnumerable&lt;Seckill&gt;&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>此时再通过HttpClient访问服务端的接口数据，将自动缓存该接口数据</p>
</li>
</ul>
<h1 id="HttpClient-分布式储存"><a href="#HttpClient-分布式储存" class="headerlink" title="HttpClient 分布式储存"></a>HttpClient 分布式储存</h1><ul>
<li><p>引入 Microsoft.Extensions.Caching.Redis 包</p>
</li>
<li><p>在 Startup 的 ConfigureServices 方法里面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 7、添加分布式缓存依赖到IOC容器</span><br><span class="line">services.AddDistributedRedisCache(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.Configuration = &quot;localhost:6379&quot;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 CacheHttpClientMessageHanlder 类里面添加对应的Redis存储代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">private readonly IDistributedCache _distributedCache; // 分布式缓存</span><br><span class="line"></span><br><span class="line">public CacheHttpClientMessageHanlder(</span><br><span class="line">    IDistributedCache distributedCache)</span><br><span class="line">&#123;</span><br><span class="line">    _distributedCache = distributedCache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[HttpGet]</span><br><span class="line">[HttpCacheExpiration(NoStore=false, MaxAge=10000)]</span><br><span class="line">public ActionResult&lt;IEnumerable&lt;Seckill&gt;&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;获取秒杀数据&quot;);</span><br><span class="line">    // 1、先查询redis分布式缓存</span><br><span class="line">    string seckillsString = distributedCache.GetString(&quot;seckills&quot;);</span><br><span class="line">    List&lt;Seckill&gt; seckills = null;</span><br><span class="line">    if (string.IsNullOrEmpty(seckillsString))</span><br><span class="line">    &#123;</span><br><span class="line">        // 1.1 查询数据库</span><br><span class="line">        seckills = SeckillService.GetSeckills().ToList();</span><br><span class="line">        seckillsString = JsonConvert.SerializeObject(seckills);</span><br><span class="line"></span><br><span class="line">        // 设置过期的时间。</span><br><span class="line">        var distributedCacheEntryOptions = new DistributedCacheEntryOptions();</span><br><span class="line">        distributedCacheEntryOptions.AbsoluteExpirationRelativeToNow = TimeSpan.FromDays(3);</span><br><span class="line">        // 1.2 存储到redis中</span><br><span class="line">        distributedCache.SetString(&quot;seckills&quot;, seckillsString, distributedCacheEntryOptions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 1.3反序列化成对象</span><br><span class="line">    seckills = JsonConvert.DeserializeObject&lt;List&lt;Seckill&gt;&gt;(seckillsString);</span><br><span class="line">    return seckills;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/04/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/4%E3%80%81WebApi%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/04/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/4%E3%80%81WebApi%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">4、WebApi调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-04 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-04T10:48:57+08:00">2023-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-28 22:17:23" itemprop="dateModified" datetime="2024-01-28T22:17:23+08:00">2024-01-28</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/04/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/4%E3%80%81WebApi%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/04/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/4%E3%80%81WebApi%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="正常查询"><a href="#正常查询" class="headerlink" title="正常查询"></a>正常查询</h1><ul>
<li>普通数据库查询<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[HttpGet]</span><br><span class="line">public ActionResult&lt;IEnumerable&lt;Seckill&gt;&gt; GetSeckills()</span><br><span class="line">&#123;</span><br><span class="line">    // 1、业务信息</span><br><span class="line">    Console.WriteLine(&quot;查询秒杀商品信息&quot;);</span><br><span class="line">    // 2、查询数据库</span><br><span class="line">    //List&lt;Seckill&gt; seckills = SeckillService.GetSeckills().ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h1><ul>
<li><p>引入 Microsoft.Extensions.Caching.Memory 包</p>
</li>
<li><p>修改 Startup 类的 ConfigureServices 方法，注册本地缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 6、添加本缓存依赖到IOC</span><br><span class="line">services.AddMemoryCache();</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制器修改代码，对数据进行缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">private readonly IMemoryCache memoryCache;// 本地缓存</span><br><span class="line">  public SeckillsController(IMemoryCache memoryCache)</span><br><span class="line">  &#123;</span><br><span class="line">      this.memoryCache = memoryCache;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> [HttpGet]</span><br><span class="line"> public ActionResult&lt;IEnumerable&lt;Seckill&gt;&gt; GetSeckills()</span><br><span class="line"> &#123;</span><br><span class="line">        Console.WriteLine(&quot;获取秒杀数据&quot;);</span><br><span class="line">        List&lt;Seckill&gt; seckills = null;</span><br><span class="line">        bool flag = memoryCache.TryGetValue&lt;List&lt;Seckill&gt;&gt;(&quot;seckills&quot;, out seckills);</span><br><span class="line">        if (!flag)</span><br><span class="line">        &#123;</span><br><span class="line">            // 1.1 查询数据库</span><br><span class="line">            seckills = SeckillService.GetSeckills().ToList();</span><br><span class="line">            // 1.2 添加到缓存</span><br><span class="line">            MemoryCacheEntryOptions memoryCacheEntryOptions = new MemoryCacheEntryOptions();</span><br><span class="line">            // 1、过期时间(保证数据和源头一致)</span><br><span class="line">            memoryCacheEntryOptions.AbsoluteExpirationRelativeToNow = TimeSpan.FromSeconds(3);</span><br><span class="line">            // 2、设置缓存量大小。(保证系统不影响其他操作)</span><br><span class="line">            memoryCacheEntryOptions.SetSize(1024);</span><br><span class="line">            // 3、方案：使用异步更新。</span><br><span class="line">            memoryCacheEntryOptions.RegisterPostEvictionCallback((key, value, reason, state) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                // 1、key = seckills</span><br><span class="line">                // 2、value = List&lt;Seckill&gt;</span><br><span class="line">                // 3、reason = 回收的原因</span><br><span class="line">                // 4、state = 是否成功，是否失败</span><br><span class="line">                Console.WriteLine($&quot;缓存自动失效：key:&#123;key&#125;,value:&#123;value&#125;,reason:&#123;reason&#125;,state:&#123;state&#125;&quot;);</span><br><span class="line"></span><br><span class="line">                // 1、查询数据库的代码。</span><br><span class="line">                // 自动同步：</span><br><span class="line">                // 1、根据key查询数据库，查询秒杀商品数据</span><br><span class="line">                // 2、然后把查询秒杀商品数据存储到数据库中。</span><br><span class="line">                // 扩展：数据异构形式。</span><br><span class="line">            &#125;);</span><br><span class="line">            // 4、如果数据量缓存数据量，比较大。1000条数据</span><br><span class="line">            //    都会设置过期时间。</span><br><span class="line"></span><br><span class="line">            // 5、优先级设置。</span><br><span class="line">            memoryCacheEntryOptions.Priority = CacheItemPriority.High;</span><br><span class="line"></span><br><span class="line">            memoryCache.Set&lt;List&lt;Seckill&gt;&gt;(&quot;seckills&quot;, seckills, memoryCacheEntryOptions);</span><br><span class="line">        &#125;</span><br><span class="line">        return seckills;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="分布式缓存"><a href="#分布式缓存" class="headerlink" title="分布式缓存"></a>分布式缓存</h1><ul>
<li><p>引入 Microsoft.Extensions.Caching.Redis 包</p>
</li>
<li><p>修改 Startup 类的 ConfigureServices 方法，注册redis分布式缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 7、添加分布式缓存依赖到IOC容器</span><br><span class="line">services.AddDistributedRedisCache(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.Configuration = &quot;localhost:6379&quot;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制器修改代码，对数据进行缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">private readonly IDistributedCache distributedCache; // 分布式缓存</span><br><span class="line">  public SeckillsController(IDistributedCache distributedCache)</span><br><span class="line">  &#123;</span><br><span class="line">      this.distributedCache = distributedCache;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [HttpGet]</span><br><span class="line"> public ActionResult&lt;IEnumerable&lt;Seckill&gt;&gt; GetSeckills()</span><br><span class="line"> &#123;</span><br><span class="line">         #region 3、分布式缓存</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;获取秒杀数据&quot;);</span><br><span class="line">            // 1、先查询redis分布式缓存</span><br><span class="line">            string seckillsString = distributedCache.GetString(&quot;seckills&quot;);</span><br><span class="line">            List&lt;Seckill&gt; seckills = null;</span><br><span class="line">            if (string.IsNullOrEmpty(seckillsString))</span><br><span class="line">            &#123;</span><br><span class="line">                // 1.1 查询数据库</span><br><span class="line">                seckills = SeckillService.GetSeckills().ToList();</span><br><span class="line">                seckillsString = JsonConvert.SerializeObject(seckills);</span><br><span class="line"></span><br><span class="line">                // 设置过期的时间。</span><br><span class="line">                var distributedCacheEntryOptions = new DistributedCacheEntryOptions();</span><br><span class="line">                distributedCacheEntryOptions.AbsoluteExpirationRelativeToNow = TimeSpan.FromDays(3);</span><br><span class="line">                // 1.2 存储到redis中</span><br><span class="line">                distributedCache.SetString(&quot;seckills&quot;, seckillsString, distributedCacheEntryOptions);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 1.3反序列化成对象</span><br><span class="line">            seckills = JsonConvert.DeserializeObject&lt;List&lt;Seckill&gt;&gt;(seckillsString);</span><br><span class="line">            return seckills;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="相应数据压缩"><a href="#相应数据压缩" class="headerlink" title="相应数据压缩"></a>相应数据压缩</h1><ul>
<li><p>引入 Microsoft.AspNetCore.ResponseCompression 包</p>
</li>
<li><p>修改 Startup 类的 Configure 方法，开启响应数据压缩</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> // 1、开启响应数据压缩</span><br><span class="line">app.UseResponseCompression();</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 Startup 类的 ConfigureServices 方法，注册redis分布式缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 11、添加响应数据压缩</span><br><span class="line">services.AddResponseCompression(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    // 1、默认之支持http数据压缩</span><br><span class="line">    options.EnableForHttps = true;</span><br><span class="line"></span><br><span class="line">    // 2、指定数据类型数据压缩</span><br><span class="line">    options.MimeTypes = new[]</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;application/json; charset=utf-8&quot;,</span><br><span class="line">        &quot;application/xml; charset=utf-8&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">    options.Providers.Add&lt;GzipCompressionProvider&gt;();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/03/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/3%E3%80%81Nginx%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/03/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/3%E3%80%81Nginx%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">2、Nginx调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-03 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-03T10:48:57+08:00">2023-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-30 00:40:18" itemprop="dateModified" datetime="2024-01-30T00:40:18+08:00">2024-01-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/03/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/3%E3%80%81Nginx%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/03/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/3%E3%80%81Nginx%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-37.png" alt="Alt text"></p>
<ul>
<li>配置Nginx 静态资源文件路径</li>
<li>#expires 过期时间</li>
<li>#ETag  在HTTP缓存中的作用是帮助客户端验证资源是否发生变化，从而避免无谓的资源传输，减少带宽的浪费。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.(htm|gif|jpg|jpeg|bmp|png|css|js|ico)$ &#123;</span><br><span class="line">    root D:/work/net/nginx/YDT.EBusiness.StaticResource/wwwroot;</span><br><span class="line">    #expires 10d;</span><br><span class="line">    #etag off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="1-OpenResty"><a href="#1-OpenResty" class="headerlink" title="1. OpenResty"></a>1. OpenResty</h1><p>OpenResty是一个基于Nginx的可扩展的Web平台，它整合了Nginx服务器和一系列的模块，其中最突出的是LuaJIT，使得开发人员可以使用Lua脚本语言扩展Nginx的功能。OpenResty的主要特点包括：</p>
<p>高性能： 基于Nginx的高性能特性，加上使用LuaJIT作为扩展语言，能够实现非常快速的处理和响应。</p>
<p>可扩展性： 支持通过Lua脚本自定义和扩展Nginx的功能，方便开发者根据需求定制化配置。</p>
<p>集成性： OpenResty集成了大量的Nginx模块和第三方模块，提供了丰富的功能集合。</p>
<h1 id="2-数据异构"><a href="#2-数据异构" class="headerlink" title="2. 数据异构"></a>2. 数据异构</h1><p>数据异构是指在数据处理过程中，将不同种类或格式的数据整合在一起，使其能够被共同使用。这可以包括不同数据库之间的数据整合、不同数据格式之间的转换等。</p>
<h1 id="3-允许数据过期时候"><a href="#3-允许数据过期时候" class="headerlink" title="3. 允许数据过期时候"></a>3. 允许数据过期时候</h1><p>允许数据过期是指在缓存系统中，允许缓存的数据拥有一个设定的过期时间。一旦超过过期时间，缓存的数据将被认为是失效的，需要重新从数据源获取新的数据。</p>
<p>多级缓存<br>多级缓存是一种层次化的缓存结构，通常包括多个层次的缓存存储，每个层次的缓存具有不同的特性和过期策略。典型的多级缓存包括：</p>
<h1 id="1-多个本地缓存"><a href="#1-多个本地缓存" class="headerlink" title="1. 多个本地缓存"></a>1. 多个本地缓存</h1><p>一级缓存： 通常是内存中的缓存，响应速度最快，用于存储经常访问的数据。</p>
<p>二级缓存： 可以是磁盘缓存或其他存储介质，用于存储一些相对不那么频繁访问但仍然需要缓存的数据。</p>
<h1 id="2-设置过期时间不一致"><a href="#2-设置过期时间不一致" class="headerlink" title="2. 设置过期时间不一致"></a>2. 设置过期时间不一致</h1><p>一级缓存过期时间较短： 因为一级缓存通常是内存，空间有限，过期时间较短可以确保及时释放内存。</p>
<p>二级缓存过期时间相对较长： 由于二级缓存一般是磁盘或其他持久化存储，可以存储相对更久的时间，减少频繁从数据源获取数据的次数。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/02/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/2%E3%80%81CDN%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/02/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/2%E3%80%81CDN%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">2、CDN调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-02 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-02T10:48:57+08:00">2023-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-30 00:40:18" itemprop="dateModified" datetime="2024-01-30T00:40:18+08:00">2024-01-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/02/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/2%E3%80%81CDN%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/02/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/2%E3%80%81CDN%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CDN课件"><a href="#CDN课件" class="headerlink" title="CDN课件"></a>CDN课件</h1><blockquote>
<p>CDN，即内容分发网络，是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。通常情况下，CDN的关键技术主要有内容存储和分发技术。（引自©百度百科：CDN）<br>CDN的搭建方式有很多种，并且所使用的软件也有很多种，在本文中以老牌的squid为例进行搭建和实验。</p>
</blockquote>
<h1 id="本实验CDN拓扑"><a href="#本实验CDN拓扑" class="headerlink" title="本实验CDN拓扑"></a>本实验CDN拓扑</h1><blockquote>
<p>在本文中，旨在通过nginx+squid这样的方式搭建一个简易的CDN服务器，用于缓存源服务器上的内容，从而提高达到提高访问速度和流量分摊的目的，我们使用两台服务器进行实验，其中一台安装nginx充当源服务器，另一台则是安装nginx和squid充当CDN缓存服务器，相关拓扑如下：<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-30.png" alt="Alt text"></p>
</blockquote>
<h1 id="3、-配置步骤"><a href="#3、-配置步骤" class="headerlink" title="3、 配置步骤"></a>3、 配置步骤</h1><p>3.1、网站源服务器（操作系统为centos）<br>（1）安装nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure>
<p>（2）修改nginx的初始页面，以便区分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;This is test webpage!!!!&#x27; &gt; /var/www/html/index.nginx-debian.html</span><br></pre></td></tr></table></figure>
<p>（3）重启nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>
<ul>
<li>需要注意的是，debian默认的防火墙为iptables，因为该防火墙默认是没有规则的，因此不用专门关闭。</li>
</ul>
<blockquote>
<p>上述配置完成后，客户端输入网站源服务器的IP地址，可以看到访问是正常的如下图所示：<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-31.png" alt="Alt text"></p>
</blockquote>
<h3 id="CDN服务器（操作系统为CentOS7-6）"><a href="#CDN服务器（操作系统为CentOS7-6）" class="headerlink" title="CDN服务器（操作系统为CentOS7.6）"></a>CDN服务器（操作系统为CentOS7.6）</h3><p>针对于CDN服务器，相应的部署步骤如下：</p>
<p>（1）关闭防火墙以及防火墙自启动，也可写入具体的安全策略至防火墙</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld</span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure>
<p>（2）安装nginx和squid</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br><span class="line">yum install squid -y</span><br></pre></td></tr></table></figure>
<p>（3）输入命令“vim &#x2F;etc&#x2F;squid&#x2F;squid.conf”，修改该配置文件，增加如下图红框中所示的内容，以达到将squid缓存代理服务指向网站源服务器的IP地址和端口（192.168.80.135:80）之目的<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-32.png" alt="Alt text"><br>（4）输入命令“vim &#x2F;etc&#x2F;nginx&#x2F;nginx.conf”，修改该配置文件，在server结构体下，增加如下图红框中所示的内容，以达到CDN上的nginx指向squid代理服务（<strong>默认监听端口是3128</strong>）之目的<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-33.png" alt="Alt text"><br>（5）配置完成后，重启nginx和squid</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br><span class="line">systemctl restart squid</span><br></pre></td></tr></table></figure>

<p>（6）输入以下命令修改SELinux安全上下文的布尔值，如果在CentOS上遗失此步骤，会出现因为SELinux的httpd_can_network_connect模块阻拦，而导致nginx和squid无法建立通信，缓存不到网站源服务器的资源，最终使得客户端访问CDN服务器时报“<strong>502 bad Gateway</strong>”错误，如下图<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-34.png" alt="Alt text"><br>输入命令“setsebool -P httpd_can_network_connect 1”后，然后在客户端的浏览器上输入CDN服务器的IP地址192.168.80.136，发现可以成功访问到网站源服务器（192.168.80.135）上的页面，通过浏览器的开发者工具也可以看到访问过程中经过了squid，说明此时CDN服务器缓存成功<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-36.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-35.png" alt="Alt text"></p>
<h1 id="4、附：nginx和squid的配置文件"><a href="#4、附：nginx和squid的配置文件" class="headerlink" title="4、附：nginx和squid的配置文件"></a>4、附：nginx和squid的配置文件</h1><ul>
<li>4.1、&#x2F;etc&#x2F;nginx&#x2F;nginx.conf<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"># For more information on configuration, see:</span><br><span class="line">#   * Official English Documentation: http://nginx.org/en/docs/</span><br><span class="line">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span><br><span class="line"></span><br><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        #listen       [::]:80;</span><br><span class="line">        #server_name  _;</span><br><span class="line">        #root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        #include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://127.0.0.1:3128;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Settings for a TLS enabled server.</span><br><span class="line">#</span><br><span class="line">#    server &#123;</span><br><span class="line">#        listen       443 ssl http2;</span><br><span class="line">#        listen       [::]:443 ssl http2;</span><br><span class="line">#        server_name  _;</span><br><span class="line">#        root         /usr/share/nginx/html;</span><br><span class="line">#</span><br><span class="line">#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;</span><br><span class="line">#        ssl_certificate_key &quot;/etc/pki/nginx/private/server.key&quot;;</span><br><span class="line">#        ssl_session_cache shared:SSL:1m;</span><br><span class="line">#        ssl_session_timeout  10m;</span><br><span class="line">#        ssl_ciphers PROFILE=SYSTEM;</span><br><span class="line">#        ssl_prefer_server_ciphers on;</span><br><span class="line">#</span><br><span class="line">#        # Load configuration files for the default server block.</span><br><span class="line">#        include /etc/nginx/default.d/*.conf;</span><br><span class="line">#</span><br><span class="line">#        error_page 404 /404.html;</span><br><span class="line">#            location = /40x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 500 502 503 504 /50x.html;</span><br><span class="line">#            location = /50x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">4.2、/etc/squid/squid.conf</span><br><span class="line">#</span><br><span class="line"># Recommended minimum configuration:</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># Example rule allowing access from your local networks.</span><br><span class="line"># Adapt to list your (internal) IP networks from where browsing</span><br><span class="line"># should be allowed</span><br><span class="line">acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 &quot;this&quot; network (LAN)</span><br><span class="line">acl localnet src 10.0.0.0/8             # RFC 1918 local private network (LAN)</span><br><span class="line">acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)</span><br><span class="line">acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines</span><br><span class="line">acl localnet src 172.16.0.0/12          # RFC 1918 local private network (LAN)</span><br><span class="line">acl localnet src 192.168.0.0/16         # RFC 1918 local private network (LAN)</span><br><span class="line">acl localnet src fc00::/7               # RFC 4193 local private network range</span><br><span class="line">acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines</span><br><span class="line"></span><br><span class="line">acl SSL_ports port 443</span><br><span class="line">acl Safe_ports port 80          # http</span><br><span class="line">acl Safe_ports port 21          # ftp</span><br><span class="line">acl Safe_ports port 443         # https</span><br><span class="line">acl Safe_ports port 70          # gopher</span><br><span class="line">acl Safe_ports port 210         # wais</span><br><span class="line">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class="line">acl Safe_ports port 280         # http-mgmt</span><br><span class="line">acl Safe_ports port 488         # gss-http</span><br><span class="line">acl Safe_ports port 591         # filemaker</span><br><span class="line">acl Safe_ports port 777         # multiling http</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Recommended minimum Access Permission configuration:</span><br><span class="line">#</span><br><span class="line"># Deny requests to certain unsafe ports</span><br><span class="line">http_access deny !Safe_ports</span><br><span class="line"></span><br><span class="line"># Deny CONNECT to other than secure SSL ports</span><br><span class="line">http_access deny CONNECT !SSL_ports</span><br><span class="line"></span><br><span class="line"># Only allow cachemgr access from localhost</span><br><span class="line">http_access allow localhost manager</span><br><span class="line">http_access deny manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># We strongly recommend the following be uncommented to protect innocent</span><br><span class="line"># web applications running on the proxy server who think the only</span><br><span class="line"># one who can access services on &quot;localhost&quot; is a local user</span><br><span class="line">#http_access deny to_localhost</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># Example rule allowing access from your local networks.</span><br><span class="line"># Adapt localnet in the ACL section to list your (internal) IP networks</span><br><span class="line"># from where browsing should be allowed</span><br><span class="line">http_access allow localnet</span><br><span class="line">http_access allow localhost</span><br><span class="line"></span><br><span class="line"># And finally deny all other access to this proxy</span><br><span class="line">#http_access deny all</span><br><span class="line">#http_access allow all</span><br><span class="line"></span><br><span class="line"># Squid normally listens to port 3128</span><br><span class="line">http_port 3128 accel vhost vport</span><br><span class="line">cache_peer 192.168.80.135 parent 80 0 originserver</span><br><span class="line">cache_peer_access 192.168.80.135 allow all</span><br><span class="line"># Uncomment and adjust the following to add a disk cache directory.</span><br><span class="line">cache_dir ufs /var/spool/squid 100 16 256</span><br><span class="line"></span><br><span class="line"># Leave coredumps in the first cache dir</span><br><span class="line">coredump_dir /var/spool/squid</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Add any of your own refresh_pattern entries above these.</span><br><span class="line">#</span><br><span class="line">refresh_pattern ^ftp:           1440    20%     10080</span><br><span class="line">refresh_pattern ^gopher:        1440    0%      1440</span><br><span class="line">refresh_pattern -i (/cgi-bin/|\?) 0     0%      0</span><br><span class="line">refresh_pattern .               0       20%     4320</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2023/06/01/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/1%E3%80%81DNS%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2023/06/01/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/1%E3%80%81DNS%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">1、DNS调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-01 10:48:57" itemprop="dateCreated datePublished" datetime="2023-06-01T10:48:57+08:00">2023-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-30 00:40:18" itemprop="dateModified" datetime="2024-01-30T00:40:18+08:00">2024-01-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2023/06/01/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/1%E3%80%81DNS%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2023/06/01/%E5%85%A8%E6%A0%88%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/1%E3%80%81DNS%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DNS服务器搭建"><a href="#DNS服务器搭建" class="headerlink" title="DNS服务器搭建"></a>DNS服务器搭建</h1><h2 id="DNS介绍"><a href="#DNS介绍" class="headerlink" title="DNS介绍"></a>DNS介绍</h2><h3 id="1-DNS简介"><a href="#1-DNS简介" class="headerlink" title="1.DNS简介"></a>1.DNS简介</h3><blockquote>
<p>DNS，全称 Domain Name System，域名系统。</p>
</blockquote>
<ul>
<li>DNS是将域名解析成IP地址，然后找到IP对应的主机或者服务器。我们平常上网查找资料的时候，总是在浏览器的搜索栏输入 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> ，当出现百度一下的界面，我们就进行搜索，实际上，在输入 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 按下回车键的时候，就已经开始了域名解析的过程，最后解析成一个ip地址，然后找到ip对应的百度的服务器，将页面呈现。</li>
</ul>
<blockquote>
<p>我们可以在windows系统或者Linux系统中 ping 一下<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 来看看。<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-1.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-2.png" alt="Alt text"><br>在这里插入图片描述</p>
</blockquote>
<p>2.DNS工作原理<br>DNS服务使用TCP和UDP的53端口，TCP的53端口用于连接DNS服务器，UDP的53端口用于解析DNS。每一级域名长度的限制是63个字符，域名总长度则不能超过253个字符。</p>
<p>DNS分布式系统结构：<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-3.png" alt="Alt text"><br>DNS分为两种解析方式：</p>
<p>正向解析：将域名解析成IP地址<br>逆向解析：将IP地址解析成域名<br>我们通常使用的都是正向解析，即将域名<a target="_blank" rel="noopener" href="http://www.baidu.com输入浏览器,然后解析成ip地址,进行访问./">www.baidu.com输入浏览器，然后解析成IP地址，进行访问。</a></p>
<p>DNS递归查询和迭代查询，简单的来说：</p>
<p>递归查询：就是主机发送DNS请求给本地的DNS服务器，本地服务器有记录，就直接回给主机；若没有，本地的DNS服务器就会以DNS客户端的身份向根服务器发送请求，根没有，就像其他顶级服务器查询，直到查到结果，返还给本地DNS服务器，然后交由本地服务器发给主机，整个过程中，主机只和本地服务器建立连接。<br>迭代查询：主机发送请求给本地服务器，若本地没有，则返回一个可以进行查询的其他的服务器的列表，然后主机再向列表中的服务器进行请求，直至查出，返回给主机。整个过程，主机不知建立和本地服务器的连接，还会和其他的服务器进行连接。<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-4.png" alt="Alt text"></p>
<p>3.DNS的资源记录<br>记录类型：A,AAAA,PTR,SOA,NS,CNAME,MX</p>
<p>SOA：Start Of Authority，起始授权记录；一个区域解析库有且仅能有一个SOA记录，必须位于解析库的第一条记录SOA，是起始授权机构记录，说明了在众多 NS 记录里哪一台才是主要的服务器。在任何DNS记录文件中，都是以SOA ( Startof Authority )记录开始。SOA资源记录表明此DNS名称服务器是该DNS域中数据信息的最佳来源。<br>A：域名解析成IP地址<br>AAAA：IPV6<br>PTR：反向解析，ip地址解析成域名<br>NS：专用于标明当前区域的DNS服务器，服务器类型为域名服务器<br>CNAME：别名记录<br>MX：邮件交换器<br>SOA记录与NS记录的区别：NS记录表示域名服务器记录，用来指定该域名由哪个DNS服务器来进行解析；SOA记录设置一些数据版本和更新以及过期时间等信息。</p>
<p>二、实验<br>1.DNS正向解析实验<br>首先开启两台虚拟机<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-5.png" alt="Alt text"><br>服务器端下载bind和bind-utils，这是dns的服务软件（<strong>yum install -y bind bind-utils</strong>）<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-6.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-7.png" alt="Alt text"><br>查看配置文件位置（<strong>rpm -qc bind</strong>）<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-8.png" alt="Alt text"><br>修改配置文件<br>编辑 &#x2F;etc&#x2F;named.conf 文件<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-9.png" alt="Alt text"><br>编辑 &#x2F;etc&#x2F;named.rfc1912.zones 文件<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-10.png" alt="Alt text"><br>进入 &#x2F;var&#x2F;named 目录，新建一个 yyh.com.zone 文件，这个名字熟悉吧，就是1912文件中 file 的参数<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-11.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-12.png" alt="Alt text"><br>编辑网卡文件（<strong>vim &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33</strong>）<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-13.png" alt="Alt text"><br>重启network和named服务（<strong>systemctl restart network &amp;&amp; systemctl restart named</strong>）<br>（注：先关闭防火墙（systemctl stop firewalld &amp;&amp; setenforce 0））<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-14.png" alt="Alt text"><br>使用客户端测试<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-15.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-16.png" alt="Alt text"><br>2.反向解析<br>具体步骤和正向解析一样的，只是将 &#x2F;etc&#x2F;named.rfc1912.zone 和 &#x2F;var&#x2F;named&#x2F;yyh.com.zone 文件修改一下就行，我就只上图了，不做过多解释。<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-17.png" alt="Alt text"></p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-18.png" alt="Alt text"></p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-19.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-20.png" alt="Alt text"></p>
<p>3.主从服务器配置<br>这时，我们需要再建一台虚拟机，做dns备份服务器。<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-21.png" alt="Alt text"><br>如图，7-1 和 7-2 都要安装bind 和 bind-utils</p>
<p>主服务器，即7-1上的配置不用动</p>
<p>从服务器配置：</p>
<p>修改 &#x2F;etc&#x2F;named.conf 文件<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-22.png" alt="Alt text"><br>修改 &#x2F;etc&#x2F;named.rfc1912.zone 文件<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-23.png" alt="Alt text"><br>从服务器从重启服务，查看 &#x2F;var&#x2F;named&#x2F;slaves目录下的文件<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-24.png" alt="Alt text"><br>测试<br>将7-4客户端网卡配置更改，dns1为主服务器，dns2为从服务器<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-25.png" alt="Alt text"><br>测试1（主从都没down）<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-26.png" alt="Alt text"><br>测试2（主down）<br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-27.png" alt="Alt text"><br><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-28.png" alt="Alt text"><br>缓存服务器配置<br>forwarders{218.30.19.40; };</p>
<p>也可以通过以下选项让服务器转发所有dns查询到forwarders服务器；</p>
<p>forward only;</p>
<p><img src="/BlogPro/images%E8%B0%83%E4%BC%98/image-29.png" alt="Alt text"></p>
<p>三、总结<br>每次首先要干的务必关掉防火墙（systemctl stop firewalld &amp;&amp; setenforce 0）<br>每次修改完配置文件，务必重启相关服务<br>一定要细心，配置文件中错一点，服务都跑不起来<br>网卡配置文件中的dns地址务必填写正确</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/BlogPro/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/BlogPro/">1</a><a class="page-number" href="/BlogPro/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/BlogPro/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/BlogPro/page/7/">7</a><a class="extend next" rel="next" href="/BlogPro/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="John Doe"
      src="/BlogPro/images/Wx.jpg">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description">这里是何锦祥的博客，记录生活点滴，分享思考与感悟。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/BlogPro/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/BlogPro/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/SMDegz" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SMDegz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/BlogPro/1522107010@qq.com" title="E-Mail → 1522107010@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/%E4%B8%8D%E4%BC%9A%E7%BC%96%E7%A8%8B%E7%9A%84%E7%8C%AB" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;不会编程的猫" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://smdegz.github.io/BlogPro/" title="https:&#x2F;&#x2F;smdegz.github.io&#x2F;BlogPro&#x2F;">smdegz Blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/BlogPro/lib/anime.min.js"></script>
  <script src="/BlogPro/lib/velocity/velocity.min.js"></script>
  <script src="/BlogPro/lib/velocity/velocity.ui.min.js"></script>

<script src="/BlogPro/js/utils.js"></script>

<script src="/BlogPro/js/motion.js"></script>


<script src="/BlogPro/js/schemes/pisces.js"></script>


<script src="/BlogPro/js/next-boot.js"></script>


  <script defer src="/BlogPro/lib/three/three.min.js"></script>
    <script defer src="/BlogPro/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/BlogPro/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'i6ML4c6D9phSdR4vRG7tjH8M-gzGzoHsz',
      appKey     : 'BfRJ9pJSV3u0CAuvm1xEwNL8',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
