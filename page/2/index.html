<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/BlogPro/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/BlogPro/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/BlogPro/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/BlogPro/images/logo.svg" color="#222">

<link rel="stylesheet" href="/BlogPro/css/main.css">


<link rel="stylesheet" href="/BlogPro/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/BlogPro/lib/pace/pace-theme-minimal.min.css">
  <script src="/BlogPro/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"smdegz.github.io","root":"/BlogPro/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
<meta property="og:type" content="website">
<meta property="og:title" content="何锦祥 博客">
<meta property="og:url" content="https://smdegz.github.io/BlogPro/page/2/index.html">
<meta property="og:site_name" content="何锦祥 博客">
<meta property="og:description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="生活, 思考, 感悟, 分享">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://smdegz.github.io/BlogPro/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>何锦祥 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/SMDegz" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/BlogPro/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">何锦祥 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">探索生活，分享思考</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/BlogPro/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/BlogPro/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/BlogPro/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/BlogPro/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/BlogPro/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1/7%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6(%E4%BA%8C)-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1/7%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6(%E4%BA%8C)-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">7、容器化-k8s进阶(二)-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-07 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-07T10:48:57+08:00">2024-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-24 14:18:30" itemprop="dateModified" datetime="2024-01-24T14:18:30+08:00">2024-01-24</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1/7%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6(%E4%BA%8C)-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1/7%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6(%E4%BA%8C)-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>7、容器化-k8s进阶(二)-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>笔记</h1><h3><a name='header-n2' class='md-header-anchor '></a>课程专题：微服务容器化</h3><h2><a name='header-n3' class='md-header-anchor '></a>七、容器化-k8s进阶(二)</h2><p>时间：20:00~21:30</p><p>1、部署webapi项目</p><p><span>	</span>前提：</p><p><span>		</span>1、必须有webapik8s项目镜像</p><p><span>		</span>2、运行webapik8s镜像</p><p><span>				</span>pod yaml</p><p><span>			</span>1、创建webapik8s.yml</p><p><span>			</span>2、运行webapik8s.yml</p><p><span>	</span>总结：</p><p><span>	</span>1、先创建webapi项目</p><p><span>	</span>2、构造镜像</p><p><span>	</span>3、运行镜像</p><p> 访问webapi项目</p><p><span>	</span>浏览器访问webapik8syml </p><p><span>	</span>service</p><p><span>	</span>1、先创建service</p><p><span>		</span>webapik8s.yml</p><p><span>	</span>2、然后运行service</p><p><span>		</span>webapik8s.yml</p><p><span>		</span>总结：部署webapi项目</p><p><span>		</span>1、先创建webapi项目</p><p><span>		</span>2、构造镜像</p><p><span>		</span>3、运行镜像</p><p><span>		</span>4、访问项目</p><p>2、部署nginx项目</p><p><span>		</span>1、先创建nginx项目</p><p><span>		</span>2、构造ydtnginx镜像<span>	</span></p><p><span>		</span>3、运行ydtnginx镜像</p><p><span>				</span>pod</p><p><span>		</span>        1、创建ydtnginx.yml</p><p><span>			</span>2、运行ydtnginx.yml</p><p><span>		</span>4、访问ydtnginx项目</p><p><span>			</span>service</p><p><span>		</span>1、先创建service</p><p><span>			</span>ydtnginx.yml</p><p><span>		</span>2、然后运行service</p><p><span>			</span>ydtnginx.yml</p><p><span>	</span>k8s:</p><p><span>		</span>1、pod</p><p><span>		</span>2、service<span>	</span></p><p>3、service通信</p><p><span>	</span>nginx 代理webapi项目</p><p><span>	</span>工具：flannel</p><p><span>		</span>service名称通信</p><p><span>		</span>webapik8syml  ydtnginxyml</p><p><span>	</span>1、配置webapik8syml。</p><p><span>		</span>webapik8syml  ----&gt; /usr/local/nginx/conf/nginx.conf</p><p><span>		</span>步骤：</p><p><span>		</span>1、进入到ydtnginxyml pod中</p><p><span>				</span>kubectl exec pod/ydtnginxyml -it bash</p><p><span>		</span>2、然后切换到/usr/local/nginx/conf</p><p><span>				</span>cd /usr/local/nginx/conf</p><p><span>		</span>3、最后配置nginx.conf</p><p><span>		</span>4、重新运行nginx</p><p><span>	</span>nginx 代理webapi项目：总结</p><p><span>	</span>工具：flannel</p><p><span>	</span>1、service之间通信</p><p><span>	</span>2、service 名称建立通信。</p><p><span>			</span>nginx手动配置。通信效率低。</p><p><span>	</span>3、不使用pod进行通信。<span>			</span></p><p>4、volumes数据挂载</p><p><span>	</span>nginx 实现自动配置</p><p><span>	</span>volumes ：1、主机文件放到pod中。 2、pod中文件放到主机中。</p><p><span>	</span>目标：nginx 中nginx.conf文件实现自动配置</p><p><span>	</span>1、先创建nginx.conf</p><p><span>		</span>1、主：192.168.142.129</p><p><span>				</span>1、创建nginx.conf</p><p><span>				</span>2、配置nginx.conf</p><p><span>		</span>2、从：192.168.142.168</p><p><span>				</span>1、创建nginx.conf</p><p><span>				</span>2、配置nginx.conf</p><p><span>	</span>2、然后挂载nginx.conf</p><p><span>		</span>含义：主机上的nginx.conf 实现替换 ydtnginxyml /usr/local/nginx/conf/nginx.conf</p><p><span>		</span>volumes </p><p><span>		</span>1、创建volumes </p><p><span>		</span>2、引用volumes </p><p><span>	</span>nginx 实现自动配置：总结</p><p><span>	</span>1、主机上面nginx.conf文件覆盖ydtnginxyml  pod中nginx.conf<span>	</span></p><p><span>	</span>2、使用volumes 数据挂载实现</p><p><span>	</span>3、主从节点分别创建nginx.conf，而且目录一致<span>		</span></p><p><span>	</span>4、最后实现主机nginx.conf文件挂载</p><p><span>	</span>应用场景：</p><p><span>	</span>1、mysql 数据文件和日志文件同步。</p><p><span>		</span>实现主机和pod中间数据同步。<span>	</span></p><p>5、configmap配置</p><p><span>		</span>作用：只需要创建一次配置文件，就可以在多个节点上运行。</p><p><span>		</span>目标：使用configmap创建nginx.conf </p><p><span>		</span>用法</p><p><span>		</span>1、先创建nginx.conf </p><p><span>		</span>2、然后创建configmap</p><p><span>			</span>kubectl create configmap nginxconf3 --from-file=conf=nginx.conf</p><p><span>		</span>3、使用configmap创建nginx.conf <span>	</span></p><p><span>			</span>含义：将主机上面的nginx.conf 文件交给nginxconf3 管理</p><p><span>		</span>4、使用configmap</p><p><span>			</span>含义：使用nginxconf3 ----&gt;替换ydtnginxyml /usr/local/nginx/conf/nginx.conf</p><p><span>			</span>工具：volumes </p><p><span>			</span>1、创建volumes </p><p><span>				</span>ydtnginx.yml</p><p><span>			</span>2、引用volumes </p><p><span>		</span>configmap配置 总结：</p><p><span>		</span>作用：nginx配置文件只需要创建一次，实现多节点运行。</p><p><span>		</span>1、先在主节点创建nginx.conf </p><p><span>		</span>2、然后再创建configmap nginxconf3 </p><p><span>		</span>3、使用 nginxconf3 绑定nginx.conf </p><p><span>		</span>4、使用volumes  将 nginxconf3 替换 ydtnginxyml /usr/local/nginx/conf/nginx.conf文件</p><p><span>	</span>总结：nginx代理webapi</p><p>6、deployment机制</p><p><span>	</span>目标：启动webapi集群</p><p><span>		</span> 启动多个webapi实例 </p><p><span>		</span>要启动多个webapi pod才可以。</p><p><span>	</span>具体目标：webapik8syml pod启动多个。启动2个。</p><p><span>	</span>工具：deployment </p><p><span>		</span> 启动pod集群。</p><p><span>	</span>1、创建deployment</p><p><span>		</span>使用命令：kubectl create deployment webapis --image=webapik8s</p><p><span>		</span>使用yml文件：</p><p><span>		</span>1、创建webapi.yml</p><p><span>		</span>2、配置webapi.yml</p><p><span>		</span>3、运行webapi.yml</p><p><span>		</span>目标：使用deployment 创建了2个webapi实例。</p><p><span>	</span>2、访问deployment</p><p><span>		</span>客户端访问 webapis 集群。webapi集群。</p><p><span>		</span>工具：service</p><p><span>	</span>deployment ：</p><p><span>	</span>1、启动集群</p><p>7、deployment 动态伸缩</p><p><span>	</span>2、集群动态伸缩</p><p><span>		</span>实例可以动态增加，动态删除</p><p><span>		</span>2   345   321</p><p><span>		</span>目标：webapi项目实现动态伸缩，动态增加5个实例。动态删除3个实例</p><p><span>		</span>scale</p><p><span>		</span>kubectl scale --replicas=5 deployment/webapis</p><p>客户端-----&gt;service------&gt;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>webapis-644954f875-87p5h &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  15s</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>webapis-644954f875-9k4m5 &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  11m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>webapis-644954f875-kqcxk &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  11m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>webapis-644954f875-l5mtv &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  15s</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>webapis-644954f875-r4dw9 &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  15s</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>负载均衡</p><p>1、最小活跃数算法。</p><p><span>		</span>kubectl scale --replicas=2 deployment/webapis</p><p>nginx代理webapi集群</p><p>1、使用service通信</p><p><span>	</span>有nginx的功能。可以不需要nginx。</p><p>2、使用service名称。</p><p>&nbsp;</p><p>总结：</p><p>1、部署webapi项目</p><p>2、部署nginx项目</p><p>3、nginx 代理 webapi 使用service</p><p>4、主机和pod之间的数据挂载，volumes</p><p>5、配置文件管理工具：configmap</p><p>6、nginx和webapi集群搭建。deployment</p><p>7、nginx和webapi集群动态伸缩。scale</p><p>8、nginx和webapi集群之间通信。service。</p><p>9、有了service通信后，不需要nginx实现反向代理。</p><p>&nbsp;</p><p>下节课：</p><p>docker镜像仓库。</p><h2><a name='header-n159' class='md-header-anchor '></a>1、在pod里指定挂载的时候可以只指定到目录，在下面子目录里指定文件名称可以吗？</h2><p>答案：是可以的。configmap subPath。hostPath。没有subPath 。直接根据路径和路径文件名称制定</p><h2><a name='header-n161' class='md-header-anchor '></a>2、比如appsettings.json?</h2><p>答案：使用多个数据挂载。一个configmap可以指定多个配置文件</p><h2><a name='header-n163' class='md-header-anchor '></a>3、这样运行k8s只使用master节点暴露端口给客户端访问，就行不需要nginx了吧。</h2><p>答案：是的。不需要了。</p><h2><a name='header-n165' class='md-header-anchor '></a>4、Service能负责 负载均衡 和 反向代理？</h2><p>答案：service，负载均衡 和 反向代理？  对于相同的pod。</p><p><span>		</span>对service负载均衡 和 反向代理。只能使用nginx。</p><h2><a name='header-n168' class='md-header-anchor '></a>5、harbor？</h2><p>答案：私有仓库。</p><h2><a name='header-n170' class='md-header-anchor '></a>6、双11的用户多的时候动态扩容伸缩也是用k8s做的吗？</h2><p>答案：之前不是的，现在是的。</p><h2><a name='header-n172' class='md-header-anchor '></a>7、业务体量不大，数据量也不多，只用docker swarm就可以了吧，感觉K8S一个人负责起来是很麻烦的，用到的技术点比较多。</h2><p>答案：K8S 复杂一些。docker swarm也行。</p><h2><a name='header-n174' class='md-header-anchor '></a>8、k8s不支持dockerle</h2><p>答案：不支持。</p><h2><a name='header-n176' class='md-header-anchor '></a>9、好像是有这个说法，支持podman了</h2><p>答案：支持。</p><p>docker镜像仓库。</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/06/9%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Permission%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/06/9%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Permission%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">9、ABP vNext-应用模块-Permission权限模块</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-06 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-06T10:48:57+08:00">2024-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 20:06:49" itemprop="dateModified" datetime="2024-01-23T20:06:49+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/06/9%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Permission%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/06/9%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Permission%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/BlogPro/image-47.png" alt="Alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">存储权限</span><br><span class="line">给用户授权</span><br><span class="line">对用户权限进行校验</span><br><span class="line"></span><br><span class="line">ABP框架的PermissionManagement模块是一个用于权限管理的模块，它提供了基于角色的访问控制（RBAC）功能。该模块允许您定义角色和权限，并将它们关联起来，以便在应用程序中进行权限控制。</span><br><span class="line"></span><br><span class="line">该模块提供了一些基础服务，如组织机构管理、角色管理和权限管理等。通过使用这些服务，您可以定义组织机构、角色和权限，并指定它们之间的关系。例如，您可以创建一个角色，并为该角色分配所需的权限，然后将该角色分配给一个或多个用户。</span><br><span class="line"></span><br><span class="line">此外，PermissionManagement模块还提供了一些中间件和过滤器，用于处理权限相关的请求和操作。这些中间件和过滤器可以在应用程序的各个层面上使用，以确保只有具有适当权限的用户才能访问受保护的资源或执行受保护的操作。</span><br><span class="line"></span><br><span class="line">总的来说，ABP框架的PermissionManagement模块是一个功能强大、易于使用的权限管理解决方案，可以帮助开发人员快速构建安全的应用程序。</span><br></pre></td></tr></table></figure>

<h3 id="Permission权限模块-在电商项目中的使用"><a href="#Permission权限模块-在电商项目中的使用" class="headerlink" title="Permission权限模块 在电商项目中的使用"></a>Permission权限模块 在电商项目中的使用</h3><ul>
<li>1、定义权限</li>
<li>2、集成权限管理模块</li>
<li>3、存储权限</li>
<li>4、给接口授权</li>
<li>5、给用户授权</li>
<li>6、用户鉴权(校验用户是否有相应的权限)</li>
</ul>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li><p>创建Permissions文件夹</p>
</li>
<li><p>创建 EbusinessPermission 类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 权限定义</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public class EbusinessPermission : PermissionDefinitionProvider</span><br><span class="line">&#123;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 用户添加权限</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public string Name = &quot;UserInset&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入  Volo.Abp.PermissionManagement.Domain 包</p>
</li>
<li><p>引入  Volo.Abp.PermissionManagement.EntityFrameworkCore 包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//集成应用模块，permission权限模块</span><br><span class="line">typeof(AbpPermissionManagementDomainModule),</span><br><span class="line">typeof(AbpPermissionManagementEntityFrameworkCoreModule)</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库上下文类添加对应Permission表的注册<br><img src="/BlogPro/images/image-14.png" alt="Alt text"></p>
</li>
<li><p>执行数据库迁移命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet ef migrations add Permission1</span><br><span class="line"></span><br><span class="line">dotnet ef database update</span><br></pre></td></tr></table></figure></li>
<li><p>生成出对应的表</p>
</li>
<li><p>包含 权限表、权限授权表、权限分组表<br><img src="/BlogPro/images/image-15.png" alt="Alt text"></p>
</li>
<li><p>添加相应权限 在 EbusinessPermission 类添加Define方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">   /// 1、定义权限方法</span><br><span class="line">   /// &lt;/summary&gt;</span><br><span class="line">   /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span><br><span class="line">   /// &lt;exception cref=&quot;NotImplementedException&quot;&gt;&lt;/exception&gt;</span><br><span class="line">   public override void Define(IPermissionDefinitionContext context)</span><br><span class="line">   &#123;</span><br><span class="line">       // 1、定义权限组</span><br><span class="line">       PermissionGroupDefinition permissionGroupDefinition= context.AddGroup(&quot;UserService&quot;);</span><br><span class="line"></span><br><span class="line">       // 2、定义权限组中具体权限</span><br><span class="line">       // 1、定义一级权限</span><br><span class="line">       PermissionDefinition permissionDefinition = permissionGroupDefinition.AddPermission(&quot;UsermManage&quot;);</span><br><span class="line"></span><br><span class="line">       // 2、定义二级权限</span><br><span class="line">      // PermissionDefinition permissionDefinition1 = permissionDefinition.AddChild(&quot;UsermManage.UserInset&quot;);</span><br><span class="line">      // permissionDefinition1.AddChild(&quot;&quot;);</span><br><span class="line">      // permissionDefinition.AddChild(&quot;UsermManage.UserUpdate&quot;);</span><br><span class="line">       permissionGroupDefinition.AddPermission(&quot;UserInset&quot;);</span><br><span class="line">       permissionGroupDefinition.AddPermission(&quot;UserUpdate&quot;);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在控制器的Authorize 特性添加 对应权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Authorize(&quot;UsermManage&quot;)]</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="给用户进行授权"><a href="#给用户进行授权" class="headerlink" title="给用户进行授权"></a>给用户进行授权</h3><ul>
<li>引入  Volo.Abp.PermissionManagement.Domain.Identity 包</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpPermissionManagementDomainIdentityModule),</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建用户授权服务 PermissionService</p>
</li>
<li><p>授权完，会把对应的授权数据加进  abppermissiongrants -&gt; 权限授予表里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 用户授权服务</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">[Dependency(ServiceLifetime.Singleton)]</span><br><span class="line">public class PermissionService : IRemoteService</span><br><span class="line">&#123;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 授权管理器</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public IPermissionManager permissionManager &#123; set; get; &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 给用户授权</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    /// &lt;param name=&quot;userId&quot;&gt; 3a0cd7eb-38d3-b3c8-927c-cbe3c24677d3&lt;/param&gt;</span><br><span class="line">    /// &lt;param name=&quot;permissionName&quot;&gt;UserInset &lt;/param&gt;</span><br><span class="line">    /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">    public async Task GrantPermissionForUserAsync(Guid userId, string permissionName)</span><br><span class="line">    &#123;</span><br><span class="line">        await permissionManager.SetForUserAsync(userId, permissionName, true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 给用户授权(批量)</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    /// &lt;param name=&quot;userId&quot;&gt; 3a0cd7eb-38d3-b3c8-927c-cbe3c24677d3&lt;/param&gt;</span><br><span class="line">    /// &lt;param name=&quot;permissionName&quot;&gt;UserInset &lt;/param&gt;</span><br><span class="line">    /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">    public async Task GrantPermissionsForUserAsync(Guid userId, List&lt;string&gt; permissionNames)</span><br><span class="line">    &#123;</span><br><span class="line">        foreach (var permissionName in permissionNames)</span><br><span class="line">        &#123;</span><br><span class="line">            await permissionManager.SetForUserAsync(userId, permissionName, true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加对应的过滤器，防止XSS攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">context.Services.AddControllers(options =&gt; &#123;</span><br><span class="line">    // 取消默认的xss攻击</span><br><span class="line">    options.Filters.Add(new IgnoreAntiforgeryTokenAttribute());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/BlogPro/images/image-16.png" alt="Alt text"></p>
</li>
<li><p>给指定用户进行授权<br><img src="/BlogPro/images/image-17.png" alt="Alt text"></p>
</li>
</ul>
<h3 id="修改自带表的前缀"><a href="#修改自带表的前缀" class="headerlink" title="修改自带表的前缀"></a>修改自带表的前缀</h3><ul>
<li>在 ABPEbusinessContext 类中的 OnModelCreating 方法里面添加如下方法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 2、ermissionManagement 生成对应的数据库迁移文件。</span><br><span class="line">AbpPermissionManagementDbProperties.DbTablePrefix = &quot;Sys_&quot;;</span><br></pre></td></tr></table></figure></li>
<li>在 EbusinessModule 类 中的  ConfigureServices 方法里面添加<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 14、PermissionManagement模块访问新前缀</span><br><span class="line">AbpPermissionManagementDbProperties.DbTablePrefix = &quot;Sys_&quot;;</span><br></pre></td></tr></table></figure></li>
<li>重新进行迁移命令，可实现修改自带的权限表的前缀</li>
</ul>
<h3 id="给用户授予角色权限"><a href="#给用户授予角色权限" class="headerlink" title="给用户授予角色权限"></a>给用户授予角色权限</h3><ul>
<li><p>创建一个新用户</p>
</li>
<li><p>登录新用户</p>
</li>
<li><p>批量授予新权限<br><img src="/BlogPro/images/image-19.png" alt="Alt text"></p>
</li>
<li><p>创建新的角色<br><img src="/BlogPro/images/image-20.png" alt="Alt text"></p>
</li>
<li><p>到PermissionService类里面新增给角色授权的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 给用户角色授权</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;param name=&quot;userId&quot;&gt; 3a0cd7eb-38d3-b3c8-927c-cbe3c24677d3&lt;/param&gt;</span><br><span class="line">/// &lt;param name=&quot;permissionName&quot;&gt;UserInset &lt;/param&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public async Task GrantPermissionsForUserRoleAsync(string RoleName, string permissionName)</span><br><span class="line">&#123;</span><br><span class="line">    await permissionManager.SetForRoleAsync(RoleName, permissionName, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>给指定角色授予相对应的权限<br><img src="/BlogPro/images/image-21.png" alt="Alt text"></p>
</li>
<li><p>给当前用户授予角色修改权限<br><img src="/BlogPro/images/image-23.png" alt="Alt text"></p>
</li>
<li><p>给用户指定授予相对应的角色<br><img src="/BlogPro/images/image-22.png" alt="Alt text"></p>
</li>
<li><p>重新登录用户，刷新令牌，发现当前用户已经被授予了相关权限</p>
</li>
</ul>
<h3 id="根据用户邮箱给指定用户授予权限"><a href="#根据用户邮箱给指定用户授予权限" class="headerlink" title="根据用户邮箱给指定用户授予权限"></a>根据用户邮箱给指定用户授予权限</h3><ul>
<li>创建一个 用户邮箱权限类  UserEamilPermissionManagementProvider</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 用户邮箱 权限管理(提供用户授权)</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public class UserEamilPermissionManagementProvider : PermissionManagementProvider</span><br><span class="line">&#123;</span><br><span class="line">    public UserEamilPermissionManagementProvider(IPermissionGrantRepository permissionGrantRepository, IGuidGenerator guidGenerator, ICurrentTenant currentTenant) : base(permissionGrantRepository, guidGenerator, currentTenant)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 提供者名称 自定义</span><br><span class="line">    public override string Name =&gt; &quot;UserEamil&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>到PermissionService类里面新增给用户授权通过邮箱的方法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 给用户邮箱授权</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;param name=&quot;userId&quot;&gt; 3a0cd7eb-38d3-b3c8-927c-cbe3c24677d3&lt;/param&gt;</span><br><span class="line">/// &lt;param name=&quot;permissionName&quot;&gt;UserInset &lt;/param&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">public async Task GrantPermissionsForUserEamilAsync(string Eamil, string permissionName)</span><br><span class="line">&#123;</span><br><span class="line">    await permissionManager.SetAsync(permissionName, &quot;UserEamil&quot;, Eamil, true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>-在 EbusinessModule 类的 ConfigureServices 方法中 注册自定义用户邮箱权限类到系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 15、注册自定义用户邮箱权限管理提供者</span><br><span class="line">Configure&lt;PermissionManagementOptions&gt;(options =&gt; &#123;</span><br><span class="line">    options.ManagementProviders.Add&lt;UserEamilPermissionManagementProvider&gt;();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>给指定邮箱授予权限<br><img src="/BlogPro/images/image-24.png" alt="Alt text"></li>
</ul>
<h3 id="自定义用户邮箱鉴权"><a href="#自定义用户邮箱鉴权" class="headerlink" title="自定义用户邮箱鉴权"></a>自定义用户邮箱鉴权</h3><ul>
<li>创建用户邮箱鉴权类 UserEamilPermissionValueProvider<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 用户邮箱自定义鉴权</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public class UserEamilPermissionValueProvider : PermissionValueProvider</span><br><span class="line">&#123;</span><br><span class="line">    public UserEamilPermissionValueProvider(IPermissionStore permissionStore) : base(permissionStore)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public override string Name =&gt; &quot;UserEamil&quot;;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 鉴权方法（校验用户邮箱是否有权限）</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span><br><span class="line">    /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">    /// &lt;exception cref=&quot;NotImplementedException&quot;&gt;&lt;/exception&gt;</span><br><span class="line">    public override async Task&lt;PermissionGrantResult&gt; CheckAsync(PermissionValueCheckContext context)</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、获取用户邮箱</span><br><span class="line">        var Email = context.Principal?.FindFirst(AbpClaimTypes.Email)?.Value;</span><br><span class="line"></span><br><span class="line">        if (Email == null)</span><br><span class="line">        &#123;</span><br><span class="line">            // 2、返回授权失败</span><br><span class="line">            return PermissionGrantResult.Undefined;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 3、根据邮箱查询UsermManage权限</span><br><span class="line">        // 1、获取的是接口权限。</span><br><span class="line">        // 2、UserEamil</span><br><span class="line">        // 3、具体邮箱</span><br><span class="line">        // 核心鉴权：查询授权数据库是否有权限。</span><br><span class="line">        bool flag = await PermissionStore.IsGrantedAsync(context.Permission.Name, Name, Email);</span><br><span class="line"></span><br><span class="line">        return flag ? PermissionGrantResult.Granted</span><br><span class="line">            : PermissionGrantResult.Undefined; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 多权限鉴权方法</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span><br><span class="line">    /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line"></span><br><span class="line">    public override async Task&lt;MultiplePermissionGrantResult&gt; CheckAsync(PermissionValuesCheckContext context)</span><br><span class="line">    &#123;</span><br><span class="line">        var permissionNames = context.Permissions.Select(x =&gt; x.Name).Distinct().ToArray();</span><br><span class="line">        Check.NotNullOrEmpty(permissionNames, nameof(permissionNames));</span><br><span class="line"></span><br><span class="line">        var Email = context.Principal?.FindFirst(AbpClaimTypes.Email)?.Value;</span><br><span class="line">        if (Email == null)</span><br><span class="line">        &#123;</span><br><span class="line">            return new MultiplePermissionGrantResult(permissionNames);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return await PermissionStore.IsGrantedAsync(permissionNames, Name, Email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>-在 EbusinessModule 类的 ConfigureServices 方法中 注册自定义用户邮箱鉴权到系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> // 16、注册自定义用户邮箱鉴权提供者</span><br><span class="line">Configure&lt;AbpPermissionOptions&gt;(options =&gt; &#123;</span><br><span class="line">    options.ValueProviders.Add&lt;UserEamilPermissionValueProvider&gt;();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="更加精细化的权限控制-指定方法或者代码"><a href="#更加精细化的权限控制-指定方法或者代码" class="headerlink" title="更加精细化的权限控制  指定方法或者代码"></a>更加精细化的权限控制  指定方法或者代码</h3><ul>
<li><p>在控制器上面依赖注入 AbpAuthorizationService 类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">///  abp鉴权service</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public AbpAuthorizationService abpAuthorizationService &#123; set; get; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 查询商品方法</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;param name=&quot;product&quot;&gt;&lt;/param&gt;</span><br><span class="line">/// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">[HttpGet]</span><br><span class="line">public List&lt;ProductDto&gt; SelectProduct()</span><br><span class="line">&#123;</span><br><span class="line">    //return productABPService.Select(new Product());</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        // 1、保护具体的子方法(判断用户邮箱是否有 UserInset)</span><br><span class="line">        abpAuthorizationService.CheckAsync(&quot;UserInset&quot;).Wait();</span><br><span class="line"></span><br><span class="line">        // 使用日志</span><br><span class="line">        Log.Information(&quot;查询商品&quot;); // 建议直接使用 内部依赖ILogger</span><br><span class="line">        _logger.LogInformation(&quot;查询商品&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new UserFriendlyException(&quot;查询商品失败&quot;, &quot;-1&quot;, e.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    return productABPService.GetListAsync(new PagedAndSortedResultRequestDto()).Result.Items.ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PermissionDefitionManager 类的理解<br><img src="/BlogPro/images/image-26.png" alt="Alt text"></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1/6%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1/6%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">6、容器化-k8s进阶-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-06 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-06T10:48:57+08:00">2024-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-24 14:18:30" itemprop="dateModified" datetime="2024-01-24T14:18:30+08:00">2024-01-24</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1/6%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1/6%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>6、容器化-k8s进阶-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>笔记</h1><h3><a name='header-n2' class='md-header-anchor '></a>课程专题：微服务容器化</h3><h2><a name='header-n3' class='md-header-anchor '></a>六、容器化-k8s进阶</h2><p>时间：20:00~21:30</p><p>1、部署.NET7项目</p><p><span>		</span>1、先准备k8s集群</p><p><span>			</span>用VPN : <a href='https://ikuuu.art/auth/register' target='_blank' class='url'>https://ikuuu.art/auth/register</a><span>	</span></p><p><span>		</span>2、准备.NET7项目</p><p><span>		</span>3、创建.NET7项目镜像</p><p><span>				</span>1、192.168.142.129主节点创建<span>					</span></p><p><span>				</span>2、192.168.142.168从节点创建</p><p><span>		</span>4、部署.NET7项目</p><p><span>			</span>部署：</p><p><span>			</span>1、pod：运行镜像：部署.NET7项目</p><p><span>				</span>kubectl run webapik8s --image=webapik8s --port=80 --image-pull-policy=IfNotPresent</p><p><span>				</span>pod容器：</p><p><span>				</span>1、运行镜像：</p><p><span>				</span>2、启动容器：启动docker的容器</p><p><span>					</span>--port=80：pod端口 和镜像端口一致。80</p><p><span>					</span>--image-pull-policy=IfNotPresent 本地有镜像，直接运行，本地没镜像，远程下载<span>				</span></p><p><span>					</span>pod  ----&gt;启动docker容器</p><p><span>					</span>webapik8s                 k8s_webapik8s_webapik8s_default_d714ecbf-90da-44cf-a265-b13777bdf53c_0</p><p><span>					</span></p><p><span>			</span>2、service：访问.NET7项目</p><p><span>					</span>kubectl expose pod webapik8s  --port=80 --target-port=80 --name=webapik8s --type=NodePort</p><p><span>				</span>项目访问流程</p><p><span>				</span>客户端----&gt;Linux(32085)---&gt;Service(80)----&gt;Pod(80)---&gt;容器(80)----&gt;.NET7应用(80)</p><p><span>				</span>项目IP地址访问</p><p><span>				</span>客户端---&gt;192.168.142.129----&gt;10.1.230.55---&gt;10.244.1.45---&gt;容器共享pod ip地址</p><p><span>				</span>kubectl logs service/webapik8s -f</p><p>2、部署Nginx</p><p><span>		</span>1、准备Nginx项目</p><p><span>		</span>2、创建Nginx项目镜像</p><p><span>				</span>1、192.168.142.129主节点创建<span>					</span></p><p><span>				</span>2、192.168.142.168从节点创建</p><p><span>		</span>3、部署Nginx项目</p><p><span>			</span>pod：kubectl run ydtnginx --image=ydtnginx --port=80 --image-pull-policy=IfNotPresent</p><p><span>			</span>service：kubectl expose pod ydtnginx  --port=80 --target-port=80 --name=ydtnginx --type=NodePort<span>			</span></p><p>3、pod机制</p><p>4、service机制</p><p>5、pod yml文件机制</p><p><span>	</span>目的：批量部署webapi+nginx</p><p><span>	</span>工具：pod.yml</p><p><span>	</span>前提：yml----&gt;json文件</p><p><span>	</span>原理：客户端----&gt;服务端</p><p><span>		</span>kuebctl    -----&gt;        kubelet</p><p><span>				</span>单个参数。</p><p><span>				</span>json/yml</p><p><span>	</span>1、先创建webapi.yml</p><p><span>		</span>1、创建</p><p><span>		</span>2、配置<span>			</span></p><p><span>	</span>2、然后创建nginx.yml</p><p><span>		</span>1、创建</p><p><span>		</span>2、配置</p><p><span>	</span>3、批量运行</p><p><span>		</span>运行目录</p><p><span>		</span>kubectl create -f pod/</p><p>6、service yml文件机制</p><p><span>		</span>service yml文件</p><p><span>	</span>1、先创建webapik8syml.yml</p><p><span>		</span>1、创建</p><p><span>		</span>2、配置<span>			</span></p><p><span>	</span>2、然后创建ydtnginxyml.yml</p><p><span>		</span>1、创建</p><p><span>		</span>2、配置</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> name: ydtnginxyml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> selector:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  app: ydtnginxyml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - port: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  targetPort: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> type: NodePort</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 249px;"></div><div class="CodeMirror-gutters" style="display: none; height: 249px;"></div></div></div></pre><p><span>	</span>3、批量运行Service</p><p><span>		</span>运行目录</p><p><span>		</span>kubectl create -f pod/</p><p><span>	</span>总结：</p><p><span>	</span>1、使用pod.yml</p><p><span>	</span>2、使用service.yml</p><p><span>	</span>实现了项目的批量部署。</p><p><span>	</span>service ---&gt;pod</p><p><span>	</span>一对多关系。</p><p><span>	</span>1、一个service。对应pod</p><p><span>	</span>代理关系</p><p><span>	</span>service 对 pod的反向代理</p><p><span>	</span></p><p>7、deployment yaml文件机制</p><p>8、configmap机制</p><p><span>	</span>工具：deployment</p><p><span>		</span>   configmap</p><p>总结：</p><p>1、k8s部署项目</p><p>2、k8s批量部署项目</p><h2><a name='header-n87' class='md-header-anchor '></a>1、暴露的32075端口是怎么来的</h2><p>service：kubectl expose pod ydtnginx  --port=80 --target-port=80 --name=ydtnginx </p><p>--type=NodePort</p><h2><a name='header-n90' class='md-header-anchor '></a>2、kubectl get service 中的CLUSTER-IP 这个IP是指每次重新生成service都不一样的吗？</h2><p>答案：可以直接固定</p><h2><a name='header-n92' class='md-header-anchor '></a>3、service yaml里的app 对应的是 pod里的name还是name后面的app名</h2><p>答案：对应的是pod name</p><h2><a name='header-n94' class='md-header-anchor '></a>4、这service 到 pod 到 容器，它是用什么协议去访问的？http吗？</h2><p><span>	</span>命名空间：自定义flannel协议。socket。内网通信。</p><p>下节课：</p><p>k8s 集群部署</p><p>k8s service之间通信。</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/05/8%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Account%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/05/8%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Account%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">8、ABP vNext-应用模块-Account账户模块</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-05 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-05T10:48:57+08:00">2024-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 14:49:01" itemprop="dateModified" datetime="2024-01-23T14:49:01+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/05/8%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Account%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9D%97/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/05/8%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Account%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9D%97/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ABP框架的Account模块是一个基于ABP标准的模块，它基于IdentityServer库。这个模块提供了一个单点登录（SSO）服务，这意味着一旦用户在一个应用程序上登录或退出，他们将在所有关联的应用程序上相应地登录或退出。</span><br><span class="line"></span><br><span class="line">此外，Account模块还提供了用户管理、角色管理、权限管理等基础服务，并支持自定义。通过使用ABP框架提供的API和UI，开发人员可以轻松地管理用户和角色，并为应用程序分配相应的权限。</span><br><span class="line"></span><br><span class="line">总结来说，ABP框架的Account模块是一个功能强大的身份验证和授权解决方案，可以帮助开发人员快速构建安全的应用程序。</span><br></pre></td></tr></table></figure>


<ul>
<li>先集成注册模块 引入包 </li>
<li>Volo.Abp.Account.Application</li>
<li>Volo.Abp.Account.HttpApi</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//集成应用模块，account账户模块</span><br><span class="line">typeof(AbpAccountApplicationModule),</span><br><span class="line">typeof(AbpAccountHttpApiModule),</span><br></pre></td></tr></table></figure>
<p><img src="/BlogPro/images/image-8.png"></p>
<ul>
<li><p>进行注册，往对应的注册表添加注册数据<br><img src="/BlogPro/images/image-9.png" alt="Alt text"></p>
</li>
<li><p>用户注册原理<br><img src="/BlogPro/images/image-10.png" alt="Alt text"></p>
</li>
</ul>
<h3 id="自定义用户Account实现"><a href="#自定义用户Account实现" class="headerlink" title="自定义用户Account实现"></a>自定义用户Account实现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 用户Account自定义实现</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">[Dependency(ServiceLifetime.Singleton)]</span><br><span class="line">public class AccountABPService : ApplicationService, IAccountAppService, IRemoteService</span><br><span class="line">&#123;</span><br><span class="line">    protected IIdentityRoleRepository RoleRepository &#123; get; &#125;</span><br><span class="line">    protected IdentityUserManager UserManager &#123; get; &#125;</span><br><span class="line">    protected IAccountEmailer AccountEmailer &#123; get; &#125;</span><br><span class="line">    protected IdentitySecurityLogManager IdentitySecurityLogManager &#123; get; &#125;</span><br><span class="line">    protected IOptions&lt;IdentityOptions&gt; IdentityOptions &#123; get; &#125;</span><br><span class="line"></span><br><span class="line">    public AccountABPService(</span><br><span class="line">        IdentityUserManager userManager,</span><br><span class="line">        IIdentityRoleRepository roleRepository,</span><br><span class="line">        IAccountEmailer accountEmailer,</span><br><span class="line">        IdentitySecurityLogManager identitySecurityLogManager,</span><br><span class="line">        IOptions&lt;IdentityOptions&gt; identityOptions)</span><br><span class="line">    &#123;</span><br><span class="line">        RoleRepository = roleRepository;</span><br><span class="line">        AccountEmailer = accountEmailer;</span><br><span class="line">        IdentitySecurityLogManager = identitySecurityLogManager;</span><br><span class="line">        UserManager = userManager;</span><br><span class="line">        IdentityOptions = identityOptions;</span><br><span class="line"></span><br><span class="line">        //LocalizationResource = typeof(AccountResource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SignInManager&lt;IdentityUser&gt; SignInManager &#123; set; get; &#125;</span><br><span class="line">    public ISettingProvider SettingProvider &#123; set; get; &#125;</span><br><span class="line"></span><br><span class="line">    public virtual async Task&lt;IdentityUserDto&gt; RegisterAsync(RegisterDto input)</span><br><span class="line">    &#123;</span><br><span class="line">        //await CheckSelfRegistrationAsync();</span><br><span class="line"></span><br><span class="line">        await IdentityOptions.SetAsync();</span><br><span class="line"></span><br><span class="line">        var user = new IdentityUser(GuidGenerator.Create(), input.UserName, input.EmailAddress, CurrentTenant.Id);</span><br><span class="line"></span><br><span class="line">        input.MapExtraPropertiesTo(user);</span><br><span class="line"></span><br><span class="line">        (await UserManager.CreateAsync(user, input.Password)).CheckErrors();</span><br><span class="line"></span><br><span class="line">        await UserManager.SetEmailAsync(user, input.EmailAddress);</span><br><span class="line">        await UserManager.AddDefaultRolesAsync(user);</span><br><span class="line"></span><br><span class="line">        return ObjectMapper.Map&lt;IdentityUser, IdentityUserDto&gt;(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    。。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>自定义Account 接口类  IAcoountABPService<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 账户自定义AcoountABPService </span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">public interface IAcoountABPService </span><br><span class="line">&#123;</span><br><span class="line">    public void Registry();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void Login();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/BlogPro/images/image-11.png" alt="Alt text"></p>
<h3 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h3><ul>
<li>通过登录，实现把用户信息转换成token存储到cookie中</li>
<li>引入 Volo.Abp.Account.Web 包<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpAccountWebModule)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/BlogPro/images/image-12.png" alt="Alt text"></p>
<ul>
<li>在控制器或者Service添加Authorize特性，实现访问控制 [Authorize]</li>
</ul>
<p><img src="/BlogPro/images/image-13.png" alt="Alt text"></p>
<ul>
<li>此时访问对应接口将不通过，只有登录之后，才能进行访问</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/05/%E5%BE%AE%E6%9C%8D%E5%8A%A1/5%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/05/%E5%BE%AE%E6%9C%8D%E5%8A%A1/5%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">5、容器化-k8s基础-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-05 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-05T10:48:57+08:00">2024-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-24 14:18:30" itemprop="dateModified" datetime="2024-01-24T14:18:30+08:00">2024-01-24</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/05/%E5%BE%AE%E6%9C%8D%E5%8A%A1/5%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/05/%E5%BE%AE%E6%9C%8D%E5%8A%A1/5%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-k8s%E5%9F%BA%E7%A1%80-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>5、容器化-k8s基础-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a></h1><h3><a name='header-n2' class='md-header-anchor '></a>课程专题：微服务容器化</h3><h2><a name='header-n3' class='md-header-anchor '></a>五、容器化-k8s基础</h2><p>1、docker swarm通信问题</p><p><span>	</span>webapi </p><p><span>	</span>nginx</p><p><span>	</span>nginx无法访问webapi。</p><p><span>	</span>1、通信问题。</p><p><span>	</span>前提</p><p><span>	</span>1、docker是集群。至少2个实例以上</p><p><span>	</span>2、docker两个实例必须有相同的镜像。</p><p><span>	</span>docker 自定义仓库</p><p><span>	</span>1、只创建一次镜像，可以在整个集群中运行。</p><p>2、k8s核心概念理解</p><p>        docker swarm ：只能管理docker集群。不能管理其他容器技术</p><p><span>	</span>k8s ：能管理docker集群。也能管理其他容器技术</p><p>        docker。 </p><p><span>	</span>  </p><p>        k8s ------------------docker1</p><p><span>				</span>     docker2 </p><p><span>				</span>     docker3</p><p><span>				</span>     docker 4</p><p><span>	</span>总结</p><p><span>	</span>1、管理docker集群</p><p><span>	</span>2、调度镜像。调度到哪一个docker实例上运行镜像</p><p><span>	</span>3、管理容器的生命周期。</p><p>3、k8s安装</p><p><span>	</span>前提：</p><p><span>	</span>1、集群概念：</p><p><span>		</span>master  主节点 </p><p><span>			</span>1、管理工作节点</p><p><span>			</span>2、调用容器。安排容器到哪一个工作节点运行</p><p><span>		</span>slaver 工作节点</p><p><span>			</span>1、运行容器</p><p><span>	</span>2、集群搭建工具。</p><p><span>		</span> 1、kubeadm：搭建k8s集群。创建master节点 和 slaver 工作节点</p><p><span>	</span>3、访问集群工具。</p><p><span>		</span>2、kubectl：访问k8s集群</p><p><span>	</span>4、集群调度工具。</p><p><span>		</span>3、kubelet：安排容器到哪一个slaver 节点运行。</p><p><span>	</span>安装：</p><p><span>	</span>1、安装k8s master节点</p><p><span>	</span>2、然后安装k8s slaver节点</p><p><span>	</span>准备：</p><p><span>	</span>1、准备2台Linux 主机。centos7</p><p><span>	</span>2、每台主机CPU，必须为2核。内存4G。</p><p><span>	</span>目标1：安装k8s master节点</p><p><span>			</span>1、环境配置</p><p><span>				</span>6个步骤</p><p><span>			</span>2、安装kubeadm kubectl kubelet</p><p><span>			</span></p><p><span>			</span>3、安装k8s master节点</p><p><span>				</span>kubeadm  init  ：创建 master节点</p><p><span>						</span>   join ：创建slaver节点</p><p><span>						</span>   reset ：删除 master节点 slaver节点</p><p><span>			</span>      </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubeadm init \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--apiserver-advertise-address=192.168.142.129 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image-repository registry.aliyuncs.com/google_containers \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--kubernetes-version v1.18.0 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--service-cidr=10.1.0.0/16 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--pod-network-cidr=10.244.0.0/16</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><p><span>				</span>主节点初始化成功</p><p>kubeadm join 192.168.142.129:6443 --token k2yss0.1m3x98o1v1dyd2sl \
    --discovery-token-ca-cert-hash sha256:9c04c04fde699150524e6293eaed416c328310ee45802a22b47f398554e9cb9c </p><p><span>	</span> mkdir -p $HOME/.kube
 <span>	</span> sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
 <span>	</span> sudo chown $(id -u):$(id -g) $HOME/.kube/config</p><p><span>				</span>kubectl 客户端：访问k8s集群 （服务端）</p><p><span>				</span>4、安装k8s master节点网络</p><p><span>					</span>flannel</p><p><span>	</span>目标2：安装k8s slaver节点<span>	</span></p><p><span>			</span>1、环境配置</p><p><span>				</span>6个环境配置</p><p><span>			</span>2、安装kubeadm kubectl kubelet</p><p><span>				</span></p><p><span>			</span>3、安装k8s slaver节点</p><p><span>				</span>kubeadm join命令</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubeadm join 192.168.142.129:6443 --token k2yss0.1m3x98o1v1dyd2sl \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; &nbsp; &nbsp; --discovery-token-ca-cert-hash sha256:9c04c04fde699150524e6293eaed416c328310ee45802a22b47f398554e9cb9c</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>			</span>4、同步master节点网络</p><p><span>				</span>1、同步flannel网络</p><p><span>				</span>scp -r /etc/cni root@192.168.142.168:/etc</p><p><span>				</span>2、同步flannel网络-</p><p><span>				</span>scp -r /run/flannel/ root@192.168.142.168:/run</p><p><span>				</span>kubelet ：运行k8s实例</p><p><span>				</span>systemctl enable kubelet </p><p><span>		</span>       总结</p><p><span>			</span>k8s集群搭建</p><p><span>				</span>1、k8s主节点创建</p><p><span>				</span>2、k8s从节点创建</p><p><span>			</span>扩展：</p><p><span>			</span>镜像加速：快速下载镜像</p><p><span>			</span>国内常见镜像仓库</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1、阿里云 docker hub mirror（推荐使用）</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2)、腾讯云 docker hub mirror</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[https://mirror.ccs.tencentyun.com](https://mirror.ccs.tencentyun.com/)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3、华为云</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[https://05f073ad3c0010ea0f4bc00b7105ec20.mirror.swr.myhuaweicloud.com](https://05f073ad3c0010ea0f4bc00b7105ec20.mirror.swr.myhuaweicloud.com/)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4、docker中国</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[https://registry.docker-cn.com](https://registry.docker-cn.com/)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5、网易</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[http://hub-mirror.c.163.com](http://hub-mirror.c.163.com/)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6、 daocloud</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[http://f1361db2.m.daocloud.io](http://f1361db2.m.daocloud.io/?spm=a2c6h.12873639.article-detail.20.36a05e64NfRQnu)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7、docker官方地址仓库国外地址</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;https://download.docker.com/linux/centos/docker-ce.repo&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 657px;"></div><div class="CodeMirror-gutters" style="display: none; height: 657px;"></div></div></div></pre><p><span>	</span>vi /etc/docker/daemon.json</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{ &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>"registry-mirrors": ["registry.docker-cn.com"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>systemctl daemon-reload
systemctl restart docker</p><p> 总结</p><p>k8s集群搭建</p><p><span>	</span>1、k8s主节点创建</p><p><span>	</span>2、k8s从节点创建</p><p>注意</p><p>遇到了镜像无法下载问题</p><p><span>	</span>1、使用镜像加速</p><p><span>	</span>2、k8s 重置。kubeadm reset</p><p><span>	</span>3、再次 k8s 初始化。就得到解决。</p><h2><a name='header-n99' class='md-header-anchor '></a>2、service-cidr是什么？</h2><p>答案：service之间通信的网段</p><h2><a name='header-n101' class='md-header-anchor '></a>3、大佬，你给我的仓库加速地址在群里还给你了</h2><p>答案：感谢</p><h2><a name='header-n103' class='md-header-anchor '></a>3、老师加个屏幕吧，专门用来看消息</h2><p>答案：可以，后面我会使用一恶搞新屏幕，来完成。</p><h2><a name='header-n105' class='md-header-anchor '></a>4、这个安装文档有共享吗？</h2><p>答案：直接分享给你。</p><h2><a name='header-n107' class='md-header-anchor '></a>5、--server --container指定的网段是固定的吗？</h2><p>答案：</p><p>--service-cidr=10.1.0.0/16 \
--pod-network-cidr=10.244.0.0/16</p><h2><a name='header-n110' class='md-header-anchor '></a>6、k8s需要先安装docker才可以吗？</h2><p>答案：是的。</p><h2><a name='header-n112' class='md-header-anchor '></a>7、docker容器设置了restart=always 重启了虚拟机，容器还是不会自动启动</h2><p>答案：docker 启动，就会自动启动</p><p>systemctl enable docker</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/04/7%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Identity%E8%BA%AB%E4%BB%BD%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/04/7%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Identity%E8%BA%AB%E4%BB%BD%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">7、ABP vNext-应用模块-Identity身份模块</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-04 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-04T10:48:57+08:00">2024-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 14:49:01" itemprop="dateModified" datetime="2024-01-23T14:49:01+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/04/7%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Identity%E8%BA%AB%E4%BB%BD%E6%A8%A1%E5%9D%97/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/04/7%E3%80%81ABP%20vNext-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9D%97-Identity%E8%BA%AB%E4%BB%BD%E6%A8%A1%E5%9D%97/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ABP框架的Identity模块提供了身份验证和授权功能。这个模块支持多种身份验证和授权机制，包括ASP.NET Identity和OAuth2。</span><br><span class="line"></span><br><span class="line">它提供了一些基础服务，如用户管理、角色管理、权限管理等，并且支持自定义。此外，ABP框架的Identity模块还集成了OpenID Connect协议，提供了登录、注册、注销等功能。</span><br><span class="line"></span><br><span class="line">在开发过程中，可以使用ABP框架提供的API和UI来管理用户和角色，以及为应用程序分配权限。同时，它还提供了一些中间件和过滤器，用于处理身份验证和授权相关的事情。</span><br></pre></td></tr></table></figure>

<ul>
<li>安装 Volo.Abp.Identity.Domain 包</li>
<li>安装 Volo.Abp.Identity.EntityFrameworkCore 包</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//集成应用模块, identity身份模块</span><br><span class="line">typeof(AbpIdentityDomainModule),</span><br><span class="line">typeof(AbpIdentityEntityFrameworkCoreModule),</span><br></pre></td></tr></table></figure>

<h3 id="使用Identity"><a href="#使用Identity" class="headerlink" title="使用Identity"></a>使用Identity</h3><ul>
<li><p>在数据库上下文中创建OnModelCreating方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">///  根据模型创建迁移文件。进一步创建表</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;param name=&quot;modelBuilder&quot;&gt;&lt;/param&gt;</span><br><span class="line">protected override void OnModelCreating(ModelBuilder builder)</span><br><span class="line">&#123;</span><br><span class="line">    // 1、根据Identity 生成对应的数据库迁移文件。</span><br><span class="line">    AbpIdentityDbProperties.DbTablePrefix = &quot;Sys_&quot;;</span><br><span class="line">    builder.ConfigureIdentity();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成迁移文件 可以发现，现在生成的迁移文件出现很多的Identity实体脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet ef migrations add ebsuiness</span><br><span class="line"></span><br><span class="line">dotnet ef database update </span><br></pre></td></tr></table></figure>
<p><img src="/BlogPro/images/image-3.png" alt="Alt text"></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ABP框架中的Identity包包含了用于身份验证和授权的表。以下是Identity包中包含的一些主要表：</span><br><span class="line"></span><br><span class="line">AspNetUsers - 存储用户信息，如用户名、邮箱、密码等。</span><br><span class="line">AspNetUserRoles - 存储用户角色信息，将用户与角色相关联。</span><br><span class="line">AspNetUserClaims - 存储用户声明信息，可以用于存储用户的自定义属性。</span><br><span class="line">AspNetUserLogins - 存储用户登录信息，与用户的登录凭据相关联。</span><br><span class="line">AspNetRoleClaims - 存储角色声明信息，可以用于存储角色的自定义属性。</span><br><span class="line">AspNetRoles - 存储系统角色的信息。</span><br><span class="line">AspNetRoleClaims - 存储角色声明信息，可以用于存储角色的自定义属性。</span><br><span class="line">AspNetRolePermissions - 存储角色权限信息，将角色与权限相关联。</span><br><span class="line">AspNetUserTokens - 存储用户安全令牌信息，用于验证用户的登录状态。</span><br><span class="line">这些表是ABP框架中Identity包的一部分，用于构建身份验证和授权功能。根据实际需求，你可以根据这些表来扩展或自定义你的身份验证和授权机制。</span><br></pre></td></tr></table></figure>

<ul>
<li><p>引入abp 自带的identity Server包    —&gt;  Volo.Abp.Identity.Application</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpIdentityApplicationModule),</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来在user控制器里面注入abp.application 提供的服务</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public IIdentityUserAppService identityUserAppService &#123; get; set; &#125; </span><br><span class="line"> /// &lt;summary&gt;</span><br><span class="line"> /// 添加用户方法</span><br><span class="line"> /// &lt;/summary&gt;</span><br><span class="line"> /// &lt;param name=&quot;User&quot;&gt;&lt;/param&gt;</span><br><span class="line"> /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line"> [HttpPost(Name = &quot;AddUser&quot;)]</span><br><span class="line"> public string AddUser(User User)</span><br><span class="line"> &#123;</span><br><span class="line">     UserService.Insert(User);</span><br><span class="line"></span><br><span class="line">     identityUserAppService.CreateAsync(identityUserCreateDto);</span><br><span class="line">     return &quot;添加成功&quot;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<p>-引入abp提供的控制器 引入 Volo.Abp.Identity.HttpApi 包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpIdentityHttpApiModule),</span><br><span class="line">~~~~</span><br><span class="line"></span><br><span class="line">- 引入Identity 对应的权限包 ---&gt; Volo.Abp.PermissionManagement.EntityFrameworkCore</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> typeof(AbpPermissionManagementEntityFrameworkCoreModule)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 运行之后发现多了很多个User接口</span><br><span class="line">![Alt text](/images/image-4.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- module 类，添加对应的Identity权限</span><br></pre></td></tr></table></figure>
<p>  &#x2F;&#x2F; 10、添加身份认证<br>  context.Services.AddAuthentication().AddCookie();</p>
<p>  &#x2F;&#x2F; 11、添加权限校验<br>  context.Services.AddAuthorization();</p>
<p>  &#x2F;&#x2F; 12、去掉所有的权限<br>  context.Services.AddAlwaysAllowAuthorization();</p>
<p>  &#x2F;&#x2F; 13、identity身份模块访问新前缀<br>  AbpIdentityDbProperties.DbTablePrefix &#x3D; “Sys_”;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 添加角色</span><br><span class="line">![Alt text](/images/image-6.png)</span><br><span class="line"></span><br><span class="line">- 添加用户</span><br><span class="line">![Alt text](/images/image-5.png)</span><br><span class="line"></span><br><span class="line">- 数据库上下文可以修改表前缀</span><br><span class="line">![Alt text](/images/image-7.png)</span><br><span class="line"></span><br><span class="line">- 自定义Identity表字段，在提供的字段里面新增其他字段 创建一个SysUser实体类</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户自定义字段<br>&#x2F;&#x2F;&#x2F; </summary><br>public class SysUser : IdentityUser<br>{<br>    public string CreateTony { set; get; }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p> public DbSet<SysUser> sys_users { set; get; }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 重新迁移文件，发现自定义字段已经加到原先Identity表里面</span><br><span class="line"></span><br><span class="line">### 如何查询自定义新增的实体字段</span><br><span class="line"></span><br><span class="line">- 创建新的IRepository接口文件  IUserABPRepository</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户自定义仓储 用来实现abp提供的仓储接口<br>&#x2F;&#x2F;&#x2F; </summary></p>
<p>public interface IUserABPRepository : IRepository&lt;SysUser, Guid&gt;<br>{<br>   Task<SysUser> FindByNormalizedUserNameAsync(<br>    [NotNull] string normalizedUserName,<br>    bool includeDetails &#x3D; true,<br>    CancellationToken cancellationToken &#x3D; default<br>);</p>
<p>Task&lt;List<string>&gt; GetRoleNamesAsync(<br>    Guid id,<br>    CancellationToken cancellationToken &#x3D; default<br>);</p>
<p>Task&lt;List<string>&gt; GetRoleNamesInOrganizationUnitAsync(<br>    Guid id,<br>    CancellationToken cancellationToken &#x3D; default);</p>
<p>Task<SysUser> FindByLoginAsync(<br>    [NotNull] string loginProvider,<br>    [NotNull] string providerKey,<br>    bool includeDetails &#x3D; true,<br>    CancellationToken cancellationToken &#x3D; default<br>);<br>}<br>…………</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 创建Repository文件  UserABPRepository</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户仓储自定义实现<br>&#x2F;&#x2F;&#x2F; </summary><br>[Dependency(ServiceLifetime.Singleton)]<br>public class UserABPRepository : EfCoreRepository&lt;ABPEbusinessContext, SysUser, Guid&gt;, IUserABPRepository<br>{<br>    public UserABPRepository(IDbContextProvider<ABPEbusinessContext> dbContextProvider) : base(dbContextProvider)<br>    {<br>    }</p>
<pre><code>public Task&lt;SysUser&gt; FindByLoginAsync([NotNull] string loginProvider, [NotNull] string providerKey, bool includeDetails = true, CancellationToken cancellationToken = default)
&#123;
    throw new NotImplementedException();
&#125;

public Task&lt;SysUser&gt; FindByNormalizedEmailAsync([NotNull] string normalizedEmail, bool includeDetails = true, CancellationToken cancellationToken = default)
&#123;
    throw new NotImplementedException();
&#125;

public Task&lt;SysUser&gt; FindByNormalizedUserNameAsync([NotNull] string normalizedUserName, bool includeDetails = true, CancellationToken cancellationToken = default)
&#123;
    throw new NotImplementedException();
&#125;

public Task&lt;SysUser&gt; FindByTenantIdAndUserNameAsync([NotNull] string userName, Guid? tenantId, bool includeDetails = true, CancellationToken cancellationToken = default)
&#123;
    throw new NotImplementedException();
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 创建一个Service接口文件 IUserABPService</span><br></pre></td></tr></table></figure>

<p> &#x2F;&#x2F;&#x2F; <summary><br> &#x2F;&#x2F;&#x2F; 用户自定义service<br> &#x2F;&#x2F;&#x2F; </summary><br> public interface IUserABPService : ICrudAppService&lt;<br>     SysUserDto,<br>     Guid,<br>     GetSysUserInput,<br>     SysUserCreateDto,<br>     SysUserUpdateDto&gt;<br> {<br>     Task&lt;ListResultDto<IdentityRoleDto>&gt; GetRolesAsync(Guid id);</p>
<pre><code> Task&lt;ListResultDto&lt;IdentityRoleDto&gt;&gt; GetAssignableRolesAsync();

 Task UpdateRolesAsync(Guid id, IdentityUserUpdateRolesDto input);

 Task&lt;SysUserDto&gt; FindByUsernameAsync(string userName);

 Task&lt;SysUserDto&gt; FindByEmailAsync(string email);
 
</code></pre>
<p> }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 创建一个Service 文件  UserABPService</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户service自定义实现<br>&#x2F;&#x2F;&#x2F; </summary><br>[Dependency(ServiceLifetime.Singleton)]<br>&#x2F;&#x2F;[Authorize]<br>public class UserABPService : CrudAppService&lt;<br>    SysUser,<br>    SysUserDto,<br>    Guid,<br>    GetSysUserInput,<br>    SysUserCreateDto,<br>    SysUserUpdateDto&gt;, IUserABPService, IRemoteService<br>{</p>
<pre><code>public UserABPService(IUserABPRepository userABPRepository) : base(userABPRepository)
&#123;

&#125;

public Task&lt;SysUserDto&gt; FindByEmailAsync(string email)
&#123;
    throw new NotImplementedException();
&#125;

public Task&lt;SysUserDto&gt; FindByUsernameAsync(string userName)
&#123;
    throw new NotImplementedException();
&#125;

public Task&lt;ListResultDto&lt;IdentityRoleDto&gt;&gt; GetAssignableRolesAsync()
&#123;
    throw new NotImplementedException();
&#125;

public Task&lt;ListResultDto&lt;IdentityRoleDto&gt;&gt; GetRolesAsync(Guid id)
&#123;
    throw new NotImplementedException();
&#125;

public Task UpdateRolesAsync(Guid id, IdentityUserUpdateRolesDto input)
&#123;
    throw new NotImplementedException();
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- 创建相关实体的DTO</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户自定义字段<br>&#x2F;&#x2F;&#x2F; </summary><br>public class SysUserDto : ExtensibleFullAuditedEntityDto<Guid>, IMultiTenant, IHasConcurrencyStamp, IHasEntityVersion<br>{</p>
<p>}</p>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户自定义字段<br>&#x2F;&#x2F;&#x2F; </summary><br>public class SysUserCreateDto : IdentityUserCreateDto<br>{<br>    public string CreateTony { set; get; }<br>}</p>
<p>&#x2F;&#x2F;&#x2F; <summary><br>&#x2F;&#x2F;&#x2F; 用户自定义字段<br>&#x2F;&#x2F;&#x2F; </summary><br>public class SysUserUpdateDto : IdentityUserUpdateDto<br>{<br>    public string CreateTony { set; get; }<br>}</p>
<p>。。。。<br>~~~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/04/%E5%BE%AE%E6%9C%8D%E5%8A%A1/4%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E9%9B%86%E7%BE%A4-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/04/%E5%BE%AE%E6%9C%8D%E5%8A%A1/4%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E9%9B%86%E7%BE%A4-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">4、容器化-Docker集群-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-04 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-04T10:48:57+08:00">2024-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-24 14:18:30" itemprop="dateModified" datetime="2024-01-24T14:18:30+08:00">2024-01-24</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/04/%E5%BE%AE%E6%9C%8D%E5%8A%A1/4%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E9%9B%86%E7%BE%A4-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/04/%E5%BE%AE%E6%9C%8D%E5%8A%A1/4%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E9%9B%86%E7%BE%A4-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>4、容器化-Docker集群-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>笔记</h1><h3><a name='header-n2' class='md-header-anchor '></a>课程专题：微服务容器化</h3><h2><a name='header-n3' class='md-header-anchor '></a>四、容器化-Docker集群</h2><p>1、Docker集群理解</p><p><span>	</span>docker集群：多个docker实例组成的集合</p><p><span>	</span>1、保证docker高可用</p><p><span>	</span>2、解决项目高性能和高可用</p><p><span>	</span>docker集群搭建前提</p><p><span>	</span>docker集群内部概念</p><p><span>	</span>1、worker 工作者 运行项目</p><p><span>	</span>2、manager 管理者 管理其他docker实例。安排项目到哪个worker运行</p><p>       docker集群内部关系</p><p><span>	</span>manager  和 worker </p><p><span>	</span>一对多关系</p><p><span>	</span>3个docker</p><p><span>	</span>只有一个manager  。2个worker</p><p>2、Docker集群搭建</p><p><span>	</span>swarm </p><p><span>	</span>1、创建docker manager 角色 </p><p><span>	</span>2、创建docker worker角色</p><p><span>	</span>条件</p><p><span>	</span>1、准备2台虚拟机</p><p><span>	</span>2、每台虚拟机安装docker</p><p><span>	</span>3、再使用swarm</p><p><span>		</span>1、先创建manager 角色 192.168.142.129</p><p><span>		</span>2、然后创建worker角色</p><p><span>		</span>注意：关闭防火墙</p><p>3、Docker node</p><p><span>	</span>node：节点。管理集群</p><p><span>	</span>前提：必须在manager 节点上才能使用</p><p><span>	</span>node：就是用来管理节点。</p><p>4、Docker service</p><p><span>	</span>目标：docker 集群运行webapi镜像</p><p><span>	</span>docker run</p><p><span>	</span>docker service</p><p><span>	</span>1、先确认service在哪里</p><p><span>	</span>2、然后再使用service运行镜像</p><p><span>	</span>docker service create webapi</p><p><span>	</span>运行流程：</p><p><span>	</span>1、创建service ：管理容器 </p><p><span>	</span>2、创建task(线程)：调度任务</p><p><span>	</span>3、分配哪一个docker运行镜像。得到容器</p><p><span>		</span>docker run webapi(调度去完成)</p><p><span>		</span>strange_ellis---&gt;strange_ellis.1------&gt;strange_ellis.1.pktse7sdtfocw1k1glb3ktbpv</p><p><span>	</span>service ----&gt;容器关系</p><p><span>	</span>一对多关系：一个service可以管理多个容器</p><p><span>	</span>service访问</p><p><span>	</span>访问流程</p><p><span>	</span>客户端----&gt;Linux----&gt;Docker----&gt;Service-----&gt;容器----&gt;项目</p><p><span>			</span>   9099          ------&gt;           80               80          80</p><p><span>	</span>service运行项目集群（扩容）</p><p><span>	</span>scale</p><p><span>	</span>客户端----&gt;Linux----&gt;Docker----&gt;Service-----&gt;容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>		</span>1、轮询算法</p><p><span>		</span>2、最小活跃数算法（默认）</p><p><span>	</span>service作用：</p><p><span>	</span>1、运行镜像</p><p><span>	</span>2、管理容器</p><p><span>	</span>3、负载均衡</p><p><span>	</span>service运行webapi</p><p><span>	</span>service运行ydtnginx</p><p><span>		</span></p><p>5、Docker stack</p><p><span>	</span>service :只能做到镜像一个一个运行。</p><p><span>	</span>需求：批量运行镜像</p><p><span>	</span>service编排。批量创建service</p><p><span>	</span>核心：stack </p><p><span>		</span>deploy 命令</p><p><span>	</span>1、docker-compose.yml</p><p><span>		</span>json</p><p><span>	</span>docker客户端---&gt;docker 服务器</p><p><span>	</span>1、先准备docker-compose.yml</p><p><span>	</span>2、然后配置docker-compose.yml</p><p><span>	</span>3、运行docker-compose.yml</p><p><span>	</span>stack：</p><p><span>	</span>1、deploy 命令</p><p><span>	</span>2、docker-compose.yml</p><p><span>	</span>应用：</p><p><span>	</span>1、微服务部署</p><p><span>	</span>2、多租户部署</p><p>6、Docker config</p><p><span>	</span>service之间通信</p><p><span>	</span>webapi</p><p><span>	</span>客户端----&gt;Linux----&gt;Docker----&gt;Service-----&gt;容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>	</span>nginx</p><p><span>	</span>客户端----&gt;Linux----&gt;Docker----&gt;Service-----&gt;容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>										</span>    容器----&gt;项目</p><p><span>										</span>      容器----&gt;项目<span>				</span></p><p>    通信前提<span>								</span> </p><p><span>	</span>1、service名称通信</p><p><span>	</span>docker-compose.yml文件</p><p><span>	</span>ydtnginx  webapi</p><p><span>	</span>2、config。集群配置</p><p><span>		</span>只需要配置一次，整个集群可以使用</p><p><span>		</span>原理：主节点创建，同步到其他节点。</p><p>实现service之间通信。</p><p>目标：实现nginx和webapi之间通信</p><p>1、先创建nginx.conf</p><p>2、配置nginx.conf配置文件</p><p>3、使用config实现集群配置</p><p><span>	</span>1、先创建config</p><p><span>	</span>2、使用config</p><p><span>		</span>/usr/local/nginx/conf/nginx.conf</p><p>4、最后使用stack运行</p><p><span>	</span>docker 集群搭建，出现了网络问题。</p><p><span>		</span>1、无法使用名称通信</p><p><span>		</span>2、只能主节点访问，工作节点不能访问</p><p>&nbsp;</p><p>下节课</p><p>使用k8s。</p><h2><a name='header-n118' class='md-header-anchor '></a>1、如果master节点宕机，可以使用吗？<span>		</span></h2><p>答案：可以使用。集群节点之间选举</p><h2><a name='header-n120' class='md-header-anchor '></a>2、只能用主节点访问，这样有什么好处吗？</h2><p>答案：所有节点都能访问。才合理。</p><h2><a name='header-n122' class='md-header-anchor '></a>3、docker service在manager节点、worker节点都可以运行？<span>	</span></h2><p>答案：service只能在manager节点。容器可以运行在manager 和 worker节点</p><h2><a name='header-n124' class='md-header-anchor '></a>4、复制集是什么？为什么要用复制集？</h2><p>答案：多个相同的实例。</p><h2><a name='header-n126' class='md-header-anchor '></a>5、如果是winform项目或者是WPF项目的话和这个webapi项目的操作过程是一样的吗？</h2><p>答案：没有任何区别。</p><h2><a name='header-n128' class='md-header-anchor '></a>6、所以总的层次是：客户端-&gt;linux-&gt;docker-&gt;stack-&gt;service-&gt;容器-&gt;服务实例 吗？</h2><p>答案：客户端-&gt;linux-&gt;docker-&gt;service-&gt;容器-&gt;服务实例 吗？</p><h2><a name='header-n130' class='md-header-anchor '></a>7、之前安装虚拟机机，内存需要16G?</h2><p>答案：虚拟机内存大一点好一些</p><h2><a name='header-n132' class='md-header-anchor '></a>8、复制集 和 集群 有本质区别吗？</h2><p>答案：复制集是集群的特例。实例作用完全一样</p><p><span>	</span>    集群</p><p><span>	</span>1、实例作用完全一样</p><p><span>	</span>2、实例作用不一样</p><h2><a name='header-n137' class='md-header-anchor '></a>9、docker里有没有用其他操作系统的？</h2><p>docker 容器里面。默认使用的Linux 乌班图。ubantu</p><p>apt yum</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/03/6%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-API%E6%96%87%E6%A1%A3%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/03/6%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-API%E6%96%87%E6%A1%A3%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">6、ABP vNext-核心模块-API文档、日志、异常模块-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-03 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-03T10:48:57+08:00">2024-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 14:49:01" itemprop="dateModified" datetime="2024-01-23T14:49:01+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/03/6%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-API%E6%96%87%E6%A1%A3%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/03/6%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-API%E6%96%87%E6%A1%A3%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安全的API接口，不让外部访问"><a href="#安全的API接口，不让外部访问" class="headerlink" title="安全的API接口，不让外部访问"></a>安全的API接口，不让外部访问</h1><ul>
<li>安装 Volo.Abp.Swashbuckle 包<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//引入</span><br><span class="line"> typeof(AbpSwashbuckleModule),</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//集成</span><br><span class="line">// 8、配置ABP Swagger添加到IOC容器</span><br><span class="line">context.Services.AddAbpSwaggerGenWithOAuth(</span><br><span class="line">    Configuration[&quot;AuthServer:Authority&quot;],</span><br><span class="line">    new Dictionary&lt;string, string&gt;</span><br><span class="line">    &#123;</span><br><span class="line">       &#123;&quot;api&quot;, &quot;YDT.Ebusiness.WebApi&quot;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.SwaggerDoc(&quot;v1&quot;, new OpenApiInfo &#123; Title = &quot;YDT.Ebusiness.WebApi&quot;, Version = &quot;v1&quot; &#125;);</span><br><span class="line">    options.DocInclusionPredicate((docName, description) =&gt; true);</span><br><span class="line">    options.CustomSchemaIds(type =&gt; type.FullName);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>加完锁之后，怎么开锁  登录之后，可以开锁<br><img src="/BlogPro/images/image-2.png" alt="Alt text"></li>
</ul>
<h1 id="日志模块应用"><a href="#日志模块应用" class="headerlink" title="日志模块应用"></a>日志模块应用</h1><ul>
<li><p>日志可以快速定位到错误位置</p>
</li>
<li><p>引入两个日志程序集包</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Serilog.AspNetCore</span><br><span class="line"></span><br><span class="line">Serilog.Sinks.Async</span><br></pre></td></tr></table></figure>
</li>
<li><p>在program 类中继承 日志 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">var loggerConfiguration = new LoggerConfiguration()</span><br><span class="line">#if DEBUG</span><br><span class="line">     .MinimumLevel.Debug()</span><br><span class="line">#else</span><br><span class="line">    .MinimumLevel.Information()</span><br><span class="line">#endif</span><br><span class="line">.MinimumLevel.Override(&quot;Microsoft&quot;, LogEventLevel.Information)</span><br><span class="line">.MinimumLevel.Override(&quot;Microsoft.EntityFrameworkCore&quot;, LogEventLevel.Information)</span><br><span class="line">.Enrich.FromLogContext()</span><br><span class="line">.WriteTo.Async(c =&gt; c.File(&quot;Logs/logs.txt&quot;))</span><br><span class="line">.WriteTo.Async(c =&gt; c.Console());</span><br><span class="line"></span><br><span class="line">// 2、使用Serilog</span><br><span class="line">Log.Logger = loggerConfiguration.CreateLogger();</span><br><span class="line"></span><br><span class="line"> try</span><br><span class="line">&#123;</span><br><span class="line">    var builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line">    // 5、集成Autofac</span><br><span class="line">    builder.Host.UseAutofac().UseSerilog();</span><br><span class="line"></span><br><span class="line">    // 1、加载EbusinessModule</span><br><span class="line">    builder.Services.AddApplication&lt;EbusinessModule&gt;();</span><br><span class="line"></span><br><span class="line">    // 2、将Add方法放到EbusinessModule中（在IOC容器中注册Service）</span><br><span class="line"></span><br><span class="line">    var app = builder.Build();</span><br><span class="line"></span><br><span class="line">    // 3、加载中间件</span><br><span class="line">    app.InitializeApplication();</span><br><span class="line"></span><br><span class="line">    // 4、将Use方法放到EbusinessModule中 （加载中间件middle）</span><br><span class="line"></span><br><span class="line">    app.MapControllers();</span><br><span class="line"></span><br><span class="line">    // 记录开始运行的日志</span><br><span class="line">    Log.Information(&quot;YDT.Ebusiness.WebApi项目开始启动...&quot;);</span><br><span class="line">    app.Run();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception e)</span><br><span class="line">&#123;</span><br><span class="line">    // 1、手动输出日志</span><br><span class="line">    Log.Error($&quot;项目启动失败&#123;e.Message&#125;&quot;);</span><br><span class="line">&#125; finally</span><br><span class="line">&#123;</span><br><span class="line">    Log.Information(&quot;YDT.Ebusiness.WebApi项目关闭&quot;);</span><br><span class="line">    Log.CloseAndFlush(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制器依赖注入 log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public ILogger&lt;ProductABPController&gt; _logger;/*&#123; get; set; &#125;*/</span><br><span class="line"></span><br><span class="line">  try</span><br><span class="line">  &#123;</span><br><span class="line">      // 使用日志</span><br><span class="line">      Log.Information(&quot;查询商品&quot;); // 建议直接使用 内部依赖ILogger</span><br><span class="line">      _logger.LogInformation(&quot;查询商品&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  catch (Exception e)</span><br><span class="line">  &#123;</span><br><span class="line">      throw new UserFriendlyException(&quot;查询商品失败&quot;, &quot;-1&quot;, e.ToString());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/3%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/3%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">3、容器化-Docker进阶-笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-03 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-03T10:48:57+08:00">2024-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-24 14:18:30" itemprop="dateModified" datetime="2024-01-24T14:18:30+08:00">2024-01-24</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/3%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/3%E3%80%81%E5%AE%B9%E5%99%A8%E5%8C%96-Docker%E8%BF%9B%E9%98%B6-%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>3、容器化-Docker进阶-笔记</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>笔记</h1><h3><a name='header-n2' class='md-header-anchor '></a>课程专题：微服务容器化</h3><h2><a name='header-n3' class='md-header-anchor '></a>三、容器化-Docker进阶</h2><p>1、Docker 自定义镜像</p><p><span>	</span>含义：项目做成一个镜像。</p><p><span>	</span>核心：Dockerfile</p><p><span>	</span>目标：nginx 做成一个镜像</p><p><span>	</span>Dockerfile</p><p><span>	</span>理解：Dockerfile深入理解。配置命令。实现批量操作</p><p><span>		</span>   1、基础镜像 父镜像</p><p><span>		</span>   2、其他命令</p><p><span>	</span>落地：</p><p><span>	</span>思路：</p><p><span>		</span>1、Linux上面：如何运行nginx<span>	</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1 安装 nginx需要工具</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> yum -y install gcc make pcre-devel zlib-devel tar zlib</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2 下载nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> wget  http://nginx.org/download/nginx-1.15.2.tar.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3 nginx解压/nginx目录</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>tar -zxvf  nginx-1.15.2.tar.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4 切换到/nginx/nginx-1.15.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>执行./configure</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>make</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>make install 进行安装</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5 切换到/usr/local/nginx/sbin</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>执行 ./nginx </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>启动nginx</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 295px;"></div><div class="CodeMirror-gutters" style="display: none; height: 295px;"></div></div></div></pre><p><span>	</span>  docker 中容器运行 nginx 也是这5个步骤</p><p><span>	</span>  Dockerfile</p><p> Docker自定义镜像 </p><p>   1、Dockerfile</p><p>   2、了解Docker 指令</p><p>   3、配置Dockerfile：使用指令操作 原始Linux运行nginx命令</p><p>   4、构造自定义镜像</p><p>   5、运行自定义镜像，得到容器</p><p>  Docker自定义.NET7项目镜像</p><p>  <span>	</span>1、安装.NET7 SDK</p><p><span>		</span>yum</p><p><span>	</span>  2、切换到pulish中</p><p><span>		</span>cd  pulish</p><p><span>	</span>  3、运行项目</p><p><span>		</span>dotnet YDT_Docker_WebAPI.dll<span>	</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM mcr.microsoft.com/dotnet/aspnet:7.0</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WORKDIR /publish</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE 443</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">COPY publish/ /publish</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ENTRYPOINT ["dotnet", "YDT_Docker_WebAPI.dll"]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><p><span>	</span>docker run -d -P webapi</p><p><span>				</span>      ydtnginx</p><p><span>	</span>一个一个创建，</p><p><span>	</span>一个一个运行</p><p><span>	</span>1000个镜像。</p><p><span>	</span>批量操作<span>	</span></p><p>2、Docker 容器编排</p><p><span>	</span>含义：批量构造镜像，批量操作容器</p><p><span>	</span>目的： docker-compose批量运行镜像（ydtnginx webapi）</p><p><span>		</span>    docker-compose批量构造镜像（ydtnginx webapi）</p><p><span>	</span>工具：docker-compose</p><p><span>		</span>下载docker-compose </p><p><span>			</span><a href='https://github.com/docker/compose/releases' target='_blank' class='url'>https://github.com/docker/compose/releases</a></p><p><span>			</span>VPN  阿里云镜像仓库<span>	</span></p><p>    <span>	</span>  1、手动安装docker-compose</p><p><span>			</span>1、windows10上下载docker-compose-linux-x86_64</p><p><span>			</span>2、修改docker-compose-linux-x86_64 后缀名docker-compose</p><p><span>			</span>3、上传到Linux到这个/usr/local/bin/docker-compose</p><p><span>			</span>4、授权docker-compose</p><p><span>			</span>5、添加docker-compose快捷操作</p><p><span>		</span>核心：docker-compose.yml文件  类似于json配置文件</p><p><span>				</span>客户端----&gt;json----&gt;服务端</p><p><span>				</span>客户端----&gt;直接数据----&gt;服务端</p><p><span>			</span>docker-compose.yml  批量传输容器或镜像批量操作命令</p><p><span>				</span>docker run -d -P webapi</p><p><span>		</span>        <span>	</span>docker run -d -P ydtnginx</p><p><span>		</span>如何用：</p><p><span>			</span>1、理解docker-compose.yml格式</p><p><span>				</span>json  {</p><p><span>						</span>&quot;name&quot;:&quot;dddd&quot;</p><p>                                                &quot;tony&quot;:{}</p><p><span>						</span> &quot;tony&quot;:[]</p><p>                                                  &quot;tony&quot;:[{},{}]</p><p><span>					</span>  } </p><p><span>				</span>yml</p><p><span>						</span>&quot;name&quot;: &quot;dddd&quot;</p><p>                                                &quot;tony1&quot;:</p><p><span>							</span>&quot;id&quot;: &quot;2&quot;</p><p><span>							</span>&quot;name&quot;: &quot;3&quot;</p><p><span>						</span> &quot;tony2&quot;:</p><p><span>						</span>     - &quot;2&quot;</p><p>                                                     - &quot;3&quot;</p><p><span>						</span> &quot;tony3&quot;:</p><p><span>						</span>       - &quot;2&quot;:</p><p>                                                          &quot;id&quot;: </p><p><span>						</span>       - &quot;3&quot;<span>				</span></p><p><span>			</span>2、理解docker-compose.yml指令</p><p><span>					</span>如何固定key。<span>			</span></p><p><span>			</span>3、配置docker-compose.yml</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">version: '3'</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">services:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; ydtnginx:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; build: /root/nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; - 8090:80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; webapicore:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; build: /root/webapi</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; - 8091:80</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 227px;"></div><div class="CodeMirror-gutters" style="display: none; height: 227px;"></div></div></div></pre><p>目的： docker-compose批量运行镜像（ydtnginx webapi）</p><p><span>	</span>    docker-compose批量构造镜像（ydtnginx webapi）</p><p><span>	</span>容器编排</p><p><span>	</span>1、docker-compose</p><p><span>	</span>2、docker-compose.yml<span>	</span></p><p>3、Docker 容器网络</p><p><span>	</span>容器网络 :容器之间通信</p><p><span>	</span>目标：实现nignx代理webapi</p><p><span>	</span>工具：network</p><p><span>		</span>  <span>				</span>192.168.182.1 ~ 192.168.182.255</p><p><span>	</span>  客户端---&gt;Linux---&gt;Docker---&gt;容器----&gt;项目</p><p><span>							</span>    容器----&gt;项目</p><p><span>							</span>    容器----&gt;项目</p><p><span>							</span>    容器----&gt;项目</p><p>              192.168.182.1 </p><p>                客户端---&gt;Linux---&gt;Docker---&gt;容器----&gt;项目</p><p>              192.168.183.1 </p><p><span>		</span>客户端---&gt;Linux---&gt;Docker---&gt;容器----&gt;项目</p><p><span>		</span> 192.168.184.1 </p><p><span>		</span>客户端---&gt;Linux---&gt;Docker---&gt;容器----&gt;项目</p><p><span>		</span> 192.168.185.1 </p><p><span>		</span>客户端---&gt;Linux---&gt;Docker---&gt; 容器----&gt;项目</p><p><span>		</span>容器----&gt;项目(内部模式)<span>						</span></p><p><span>	</span>桥接模式：（推荐桥接模式）默认模式 bridge</p><p><span>	</span>host模式：</p><p><span>	</span>none模式：</p><p><span>	</span>1、创建桥接模式网段</p><p><span>	</span>2、使用桥接模式网段</p><p><span>	</span>3、容器之间如何通信</p><p><span>		</span>核心：依靠容器名称 ydtnginx  webapicore</p><p><span>		</span>webapicore名称配置到nginx中就可以了</p><p><span>		</span>1、找到webapicore</p><p><span>		</span>2、进入nginx容器</p><p><span>			</span>cd /usr/local/nginx/sbin</p><p><span>	</span> 目标：使用网络实现了容器之间的通信。</p><p><span>	</span>1、network 桥接网络</p><p><span>	</span>2、使用的是容器名。docker-compose.yml中的容器名</p><p><span>	</span>缺陷：每一次通信都要进入容器。单独操作</p><p>4、Docker volume数据卷</p><p><span>	</span> 含义：Linux文件可以挂载到容器中。</p><p><span>		</span>    Linux文件可以复制到容器中。</p><p><span>	</span>目表：Linux主机上面的nginx.conf配置文件挂载到 nginx容器中。<span>	</span></p><p><span>	</span>nginx.conf<span>	</span>------&gt;<span>	</span>/usr/local/nginx/conf/nginx.conf</p><p><span>	</span>1、先创建nginx.conf</p><p><span>	</span>2、配置nginx.conf</p><p><span>	</span>3、nginx.conf挂载 。</p><p><span>		</span>1、docker-compose.yml中使用</p><p><span>	</span>第一个知识点</p><p><span>	</span>1、主机文件挂载到容器中。</p><p><span>	</span>2、主机目录挂载到容器中。<span>	</span></p><p><span>	</span>3、容器目录挂载到主机中。</p><p>总结</p><p>1、自定义镜像</p><p>2、容器编排</p><p>3、容器网络</p><p>4、数据挂载</p><p>&nbsp;</p><p>docker swarm</p><p>&nbsp;</p><h2><a name='header-n141' class='md-header-anchor '></a>1、文件复制到容器中？把文件从容器外copy后黏贴到容器内？</h2><p>挂载：先复制，后替换</p><p>答案：是的，</p><h2><a name='header-n144' class='md-header-anchor '></a>2、反向挂载，只限于目录？</h2><p>答案：是的</p><h2><a name='header-n146' class='md-header-anchor '></a>3、容器文件目录挂载到主机文件目录的意义是什么</h2><p>答案：应用场景</p><p><span>	</span>MySQL es mongodb</p><p><span>	</span>内存。持久化。</p><p><span>	</span>容器中数据库数据目录-----&gt;Linux主机目录</p><h2><a name='header-n151' class='md-header-anchor '></a>4、文件挂载后如果主机文件改了，还用重新up吗<span>	</span></h2><p>答案：重新运行，才会更新。运行的时候，才会生效。</p><h2><a name='header-n153' class='md-header-anchor '></a>5、容器数据目录和主机挂载的目录会同时存在数据吗?</h2><p>答案：同时存在的。config</p><h2><a name='header-n155' class='md-header-anchor '></a>6、挂载不就是类似于Windows的共享目录的功能吗？但是Linux功能强大一点</h2><p>答案：共享目录。</p><h2><a name='header-n157' class='md-header-anchor '></a>7、一般项目运行时，一个nginx会应对多个项目，应该是要主机一份配置文件吧？需要挂载到N个项目对应的容器中吗？</h2><p>答案：一个nginx挂载一个。运行多个nginx挂载</p><p>&nbsp;</p></div>
</body>
</html>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2024/01/02/5%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-%E8%87%AA%E5%8A%A8API%E6%8E%A7%E5%88%B6%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2024/01/02/5%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-%E8%87%AA%E5%8A%A8API%E6%8E%A7%E5%88%B6%E5%99%A8/" class="post-title-link" itemprop="url">5、ABP vNext-核心模块-自动API控制器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-02 10:48:57" itemprop="dateCreated datePublished" datetime="2024-01-02T10:48:57+08:00">2024-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-23 20:06:49" itemprop="dateModified" datetime="2024-01-23T20:06:49+08:00">2024-01-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2024/01/02/5%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-%E8%87%AA%E5%8A%A8API%E6%8E%A7%E5%88%B6%E5%99%A8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2024/01/02/5%E3%80%81ABP%20vNext-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-%E8%87%AA%E5%8A%A8API%E6%8E%A7%E5%88%B6%E5%99%A8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/BlogPro/image-46.png" alt="Alt text"><br><img src="/BlogPro/images/image-1.png" alt="Alt text"></p>
<ul>
<li><p>自动API控制器可以帮助我们提升开发效率</p>
</li>
<li><p>引入包 Volo.Abp.AspNetCore.Mvc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof(AbpAspNetCoreMvcModule),</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> context.Services.AddSwaggerGen(options =&gt; &#123;</span><br><span class="line">     // 1、创建所有的文档（.net7本身+abp控制器的）</span><br><span class="line">     options.DocInclusionPredicate((docname, api) =&gt; true); </span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line">// 7、配置自动API控制器</span><br><span class="line">Configure&lt;AbpAspNetCoreMvcOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    // 1、开启自动API控制器</span><br><span class="line">    options.ConventionalControllers.Create(typeof(EbusinessModule).Assembly, options =&gt; &#123;</span><br><span class="line">        options.RootPath = &quot;Ebusiness&quot;;// 电商项目</span><br><span class="line">        //options.TypePredicate = type =&gt; false; // 1、自动AIP都创建，为true不过滤。false 全部过滤。</span><br><span class="line">        // 不常用。不建议大家使用</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个  自动API控制器 Service 继承自 IRemoteService</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 自动API 控制器</span><br><span class="line">/// TonyService -----&gt;TonyController</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">[Dependency(ServiceLifetime.Singleton)]</span><br><span class="line">//[RemoteService(IsEnabled = false)]</span><br><span class="line">//[RemoteService(IsMetadataEnabled = false)]</span><br><span class="line">public class TonyService : IRemoteService</span><br><span class="line">&#123;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 自动API控制器过滤</span><br><span class="line">    /// true 代表显示</span><br><span class="line">    /// false 代表不显示</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    [RemoteService(IsEnabled = false)]</span><br><span class="line">    public void MyTestby()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*public void CreateTony()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public void DeleteTony()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void UpdateTony()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void GetTony()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;*/</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 自动API控制器过滤</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    [RemoteService(IsEnabled = false)]</span><br><span class="line">    public void CreateMyTestByAsync()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public void DeleteAsync()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void UpdateAsync()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    public void GetAsync(Guid Id)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void GetListsAsync(Product product)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成规则</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">http TonyController</span><br><span class="line">http方法：post（默认）</span><br><span class="line">get put delete</span><br><span class="line">​</span><br><span class="line">1、生成http方法规则：</span><br><span class="line">Get方法开头---&gt; http方法get</span><br><span class="line">Create方法开头----》 http post方法</span><br><span class="line">Delete方法开头-----》http delete方法</span><br><span class="line">Update方法开头-----》http put方法</span><br><span class="line">随便写方法吗，没有4个前缀。全部默认是http post方法</span><br><span class="line">​</span><br><span class="line">GetAsync方法开头---&gt; http方法get</span><br><span class="line">CreateAsync方法开头----》 http post方法</span><br><span class="line">DeleteAsync方法开头-----》http delete方法</span><br><span class="line">UpdateAsync方法开头-----》http put方法</span><br><span class="line">随便写方法吗，没有4个前缀。全部默认是http post方法</span><br><span class="line">​</span><br><span class="line">2、生成http链接地址规则</span><br><span class="line">http链接地址：http://localhost:5063/api/app/tony/my-test</span><br><span class="line">http://localhost:5063</span><br><span class="line">1、项目提供</span><br><span class="line">/api/app/tony/my-test</span><br><span class="line">2，api api固定的，被框架固定起来不能自定义</span><br><span class="line">3，app 默认的项目名称 Ebusiness 可以自定义。指定自己的项目</span><br><span class="line">4、tony TonyService的前缀Tony。</span><br><span class="line">5、my-test MyTest() 方法名称。</span><br><span class="line">    例如：MyTestBy----&gt;my-text-by</span><br><span class="line">    </span><br><span class="line">3、生成方法参数规则</span><br><span class="line">Conflicting method/path combination &quot;GET api/Ebusiness/tony&quot; for actions - YDT.Ebusiness.WebApi.Services.TonyService.GetAsync (YDT.Ebusiness.WebApi),YDT.Ebusiness.WebApi.Services.TonyService.GetListAsync (YDT.Ebusiness.WebApi). Actions require a unique method/path combination for Swagger/OpenAPI 3.0. Use ConflictingActionsResolver as a workaround</span><br><span class="line">​</span><br><span class="line">http get方法</span><br><span class="line">http://localhost:5063/api/app/tony</span><br><span class="line">​</span><br><span class="line">自动API控制器生成</span><br><span class="line">​</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>隐藏接口<br>[RemoteService(IsMetadataEnabled &#x3D; false)]</li>
</ul>
<p>作用：只创建控制器。不把链接地址显示到swagger页面上。</p>
<p>客户端可以直接调用。主要是在加密接口使用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/BlogPro/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/BlogPro/">1</a><span class="page-number current">2</span><a class="page-number" href="/BlogPro/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/BlogPro/page/7/">7</a><a class="extend next" rel="next" href="/BlogPro/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="John Doe"
      src="/BlogPro/images/Wx.jpg">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description">这里是何锦祥的博客，记录生活点滴，分享思考与感悟。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/BlogPro/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/BlogPro/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/SMDegz" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SMDegz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/BlogPro/1522107010@qq.com" title="E-Mail → 1522107010@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/%E4%B8%8D%E4%BC%9A%E7%BC%96%E7%A8%8B%E7%9A%84%E7%8C%AB" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;不会编程的猫" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://smdegz.github.io/BlogPro/" title="https:&#x2F;&#x2F;smdegz.github.io&#x2F;BlogPro&#x2F;">smdegz Blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/BlogPro/lib/anime.min.js"></script>
  <script src="/BlogPro/lib/velocity/velocity.min.js"></script>
  <script src="/BlogPro/lib/velocity/velocity.ui.min.js"></script>

<script src="/BlogPro/js/utils.js"></script>

<script src="/BlogPro/js/motion.js"></script>


<script src="/BlogPro/js/schemes/pisces.js"></script>


<script src="/BlogPro/js/next-boot.js"></script>


  <script defer src="/BlogPro/lib/three/three.min.js"></script>
    <script defer src="/BlogPro/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/BlogPro/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'i6ML4c6D9phSdR4vRG7tjH8M-gzGzoHsz',
      appKey     : 'BfRJ9pJSV3u0CAuvm1xEwNL8',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
