<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/BlogPro/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/BlogPro/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/BlogPro/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/BlogPro/images/logo.svg" color="#222">

<link rel="stylesheet" href="/BlogPro/css/main.css">


<link rel="stylesheet" href="/BlogPro/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/BlogPro/lib/pace/pace-theme-minimal.min.css">
  <script src="/BlogPro/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"smdegz.github.io","root":"/BlogPro/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
<meta property="og:type" content="website">
<meta property="og:title" content="何锦祥 博客">
<meta property="og:url" content="https://smdegz.github.io/BlogPro/page/9/index.html">
<meta property="og:site_name" content="何锦祥 博客">
<meta property="og:description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="生活, 思考, 感悟, 分享">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://smdegz.github.io/BlogPro/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>何锦祥 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/SMDegz" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/BlogPro/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">何锦祥 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">你知道的越多 你不知道的也就越多</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/BlogPro/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/BlogPro/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/BlogPro/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/BlogPro/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/BlogPro/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/15/Net%E9%AB%98%E7%BA%A7/15%E3%80%81%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%8F%98%E8%BF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/15/Net%E9%AB%98%E7%BA%A7/15%E3%80%81%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%8F%98%E8%BF%81/" class="post-title-link" itemprop="url">15、系统架构变迁</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-15 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-15T10:48:57+08:00">2022-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-04 16:32:56" itemprop="dateModified" datetime="2024-02-04T16:32:56+08:00">2024-02-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/15/Net%E9%AB%98%E7%BA%A7/15%E3%80%81%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%8F%98%E8%BF%81/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/15/Net%E9%AB%98%E7%BA%A7/15%E3%80%81%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%8F%98%E8%BF%81/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="单机系统"><a href="#单机系统" class="headerlink" title="单机系统"></a>单机系统</h2><p><img src="/BlogPro/image-8.png" alt="Alt text"></p>
<p>PV&#x2F;UV&#x2F;IP<br>单机承载能力—硬件资源不够<br>压力测试—loadrunner</p>
<p>随着时间的推移，用户增多，数据增多，并发量增多了，然后服务器扛不住了，怎么办？</p>
<p>1 垂直扩展：升级硬件<br>    立竿见影，但是有上限<br>2 水平扩展：多来几台服务器<br>    一个人力气不够，多来几个人</p>
<h2 id="独立服务器"><a href="#独立服务器" class="headerlink" title="独立服务器"></a>独立服务器</h2><p><img src="/BlogPro/image-9.png" alt="Alt text"></p>
<p>第一次分布式：这就是分布式<br>分布式就是一台服务器做的事儿分成多台服务器协作完成</p>
<p>很轻松的提升承载能力，但是当前的划分粒度是很粗放的</p>
<p>分布式的第一要务就是不要使用分布式</p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p><img src="/BlogPro/image-10.png" alt="Alt text"></p>
<p>系统性能优化的第一步就是使用缓存，成本低见效快(有弊端)</p>
<p>二八原则：<br>80%财富集中在20%人手里<br>80%的活儿是20%的人干了<br>80%的访问都集中在20%数据上<br>(性能优化就应该盯着大多数)</p>
<p>随着时间的推移，用户增多，数据增多，并发量增多了，然后服务器扛不住了，怎么办？</p>
<p>缓存，立竿见影，因为直接重用结果，<br>降低数据库压力，提升性能<br>改造也特别简单，成本也低</p>
<p>也要注意缓存的缺点，是可能有数据延迟(过期时间)<br>再给出解决方案，以场景为例，证明真的用过</p>
<p>—-应对大数据高并发，这个是第一阶段答案</p>
<h2 id="集群负载均衡"><a href="#集群负载均衡" class="headerlink" title="集群负载均衡"></a>集群负载均衡</h2><p><img src="/BlogPro/image-11.png" alt="Alt text"></p>
<p>集群：一台服务器做的事儿，现在由多台服务器共同承载，每台服务器都是独立完成的<br>—同一个服务有多个实例</p>
<p>分布式：一台服务器做的事儿分成多台服务器协作完成，每台服务器完成其中的一个部分<br>—微服务里面多个服务串成一个业务逻辑</p>
<p>其实集群也算分布式</p>
<p>在服务压力大，水平扩展，增强承载能力<br>每台服务器都能完成响应—内容是一样的(部署一台，其他FTP同步的)<br>DNS负载均衡—可以在DNS配置多个站点响应的，由DNS决定谁来响应<br>负载均衡：多个选项中，按照一定的策略去选择<br>就近策略—轮询策略—权重策略</p>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p><img src="/BlogPro/image-12.png" alt="Alt text"></p>
<p>数据库瓶颈：数据库读写分离<br>木桶理论：决定一个木桶装水能力是由最短的那块儿板<br>二八原则：80%的业务都是查询，20%是增删改</p>
<p>1主库—N从库：数据结构—数据都是一模一样的</p>
<p>分库分表表分区—从设计角度分担压力(让数据库可以水平扩展)<br>垂直分库—按业务分库—不同的服务器—降低—合理划分&#x2F;通过服务交互&#x2F;再来个合并库&#x2F;技术手段<br>水平分库—每个库是一样的—数据不同—降低—合理划分&#x2F;通过服务交互&#x2F;再来个合并库&#x2F;技术手段</p>
<h2 id="反向代理-CDN"><a href="#反向代理-CDN" class="headerlink" title="反向代理&amp;CDN"></a>反向代理&amp;CDN</h2><p><img src="/BlogPro/image-13.png" alt="Alt text"><br>继续缓存<br>CDN加速&#x2F;缓存：阿里云<br>南网宿 北<br>CDN其实是DNS提供的<br>DNS是互联网的第一心跳，CDN就是把数据存在离用户最近的地方<br>主要解决图片 视频，缓存<br>加快速度—减少服务器请求<br>反向代理：屏蔽和保护，也可以缓存一下<br>本地缓存+CDN+反向代理&#x3D;–明天上午10点，一起来探讨缓存</p>
<h2 id="分布式文件系统"><a href="#分布式文件系统" class="headerlink" title="分布式文件系统"></a>分布式文件系统</h2><p><img src="/BlogPro/image-14.png" alt="Alt text"></p>
<p>分布式文件服务器<br>图片多  视频多的<br>TFS  GFS  NFS<br>就是把多个硬盘管理成本地硬盘<br>可以直接读写–</p>
<h2 id="其他中间件"><a href="#其他中间件" class="headerlink" title="其他中间件"></a>其他中间件</h2><p><img src="/BlogPro/image-15.png" alt="Alt text"></p>
<h2 id="业务拆分"><a href="#业务拆分" class="headerlink" title="业务拆分"></a>业务拆分</h2><p><img src="/BlogPro/image-16.png" alt="Alt text"><br>继续拆分，垂直业务拆分<br>门户网站—Ask—BBS—Blog—NEW—DB组各种知识库<br>独立团队 独立维护 独立部署<br>很有效的提升承载能力</p>
<p>数据共享方式：<br>数据库—接口—队列—缓存Nosql</p>
<h2 id="分布式-微服务"><a href="#分布式-微服务" class="headerlink" title="分布式&amp;微服务"></a>分布式&amp;微服务</h2><p><img src="/BlogPro/image-17.png" alt="Alt text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/14/Net%E9%AB%98%E7%BA%A7/14%E3%80%81%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/14/Net%E9%AB%98%E7%BA%A7/14%E3%80%81%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="post-title-link" itemprop="url">14、常用中间件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-14 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-14T10:48:57+08:00">2022-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-04 16:33:00" itemprop="dateModified" datetime="2024-02-04T16:33:00+08:00">2024-02-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/14/Net%E9%AB%98%E7%BA%A7/14%E3%80%81%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/14/Net%E9%AB%98%E7%BA%A7/14%E3%80%81%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="内置中间件"><a href="#内置中间件" class="headerlink" title="内置中间件"></a>内置中间件</h2><p>Asp.NET Core官方内置了20多种中间件供我们使用，在不是复杂需求的情况下，常用的中间件完全能满足我们程序的应用，下面我们介绍一下ASP.NET Core官方常用的10种内置中间件 。</p>
<h3 id="1、异常处理中间件"><a href="#1、异常处理中间件" class="headerlink" title="1、异常处理中间件"></a>1、异常处理中间件</h3><p>分为两种，在开发环境中使用 UseDeveloperExceptionPage 生产环境使用UseExceptionHandler。</p>
<p>当应用程序在开发环境中运行时，可以使用开发人员异常页中间件（ UseDeveloperExceptionPage ）报告应用程序运行时的错误。</p>
<p>当应用程序在生产环境中运行时，可以使用生产环境的异常处理中间件（ UseExceptionHandler ）捕获下面中间件中引发的异常。</p>
<p>使用顺序是在生成错误的组件之前。异常终端或为新应用提供默认网页的终端。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var app = builder.Build();</span><br><span class="line">//非开发环境中使用</span><br><span class="line">if (!app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseExceptionHandler(&quot;/Error&quot;);</span><br><span class="line">    app.UseHsts();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、HTTPS重定向中间件"><a href="#2、HTTPS重定向中间件" class="headerlink" title="2、HTTPS重定向中间件"></a>2、HTTPS重定向中间件</h3><p>HTTPS重定向中间件（ UseHttpsRedirection ）能将HTTP请求重定向到HTTPS，非HTTPS的站点配置非常的方便。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseHttpsRedirection();//注册</span><br></pre></td></tr></table></figure>
<h3 id="3、静态文件中间件"><a href="#3、静态文件中间件" class="headerlink" title="3、静态文件中间件"></a>3、静态文件中间件</h3><p>静态文件中间件（ UseStaticFiles ）返回静态文件，为提供静态文件和目录浏览提供支持，并简化进一步请求处理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.UseStaticFiles(new StaticFileOptions</span><br><span class="line">&#123;</span><br><span class="line">    FileProvider = new PhysicalFileProvider(</span><br><span class="line">           Path.Combine(builder.Environment.ContentRootPath, &quot;MyStaticFiles&quot;)),</span><br><span class="line">    RequestPath = &quot;/StaticFiles&quot;</span><br><span class="line">&#125;);</span><br><span class="line">//上面代码是MyStaticFiles 目录层次结构通过 StaticFiles URI 段公开</span><br><span class="line">//访问MyStaticFiles目录会指向/StaticFiles</span><br></pre></td></tr></table></figure>
<h3 id="4、Cookie中间件"><a href="#4、Cookie中间件" class="headerlink" title="4、Cookie中间件"></a>4、Cookie中间件</h3><p>Cookie策略中间件（ UseCookiePolicy ）。跟踪用户是否同意存储个人信息，并强制实施 cookie 字段（如 secure 和 SameSite）的最低标准。使用顺序是在发出 cookie 的中间件之前。示例：身份验证、会话、MVC (TempData)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseCookiePolicy();</span><br></pre></td></tr></table></figure>
<h3 id="5、路由中间件"><a href="#5、路由中间件" class="headerlink" title="5、路由中间件"></a>5、路由中间件</h3><p>路由中间件（ UseRouting ）用于定义和约束请求路由。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.UseRouting();//的调用将路由匹配中间件配置为在自定义中间件之后运行。</span><br><span class="line">app.MapGet(&quot;/&quot;, () =&gt; &quot;Hello World!&quot;);//注册的终结点在管道末尾运行。</span><br></pre></td></tr></table></figure>
<h3 id="6、身份认证中间件"><a href="#6、身份认证中间件" class="headerlink" title="6、身份认证中间件"></a>6、身份认证中间件</h3><p>身份认证中间件（ UseAuthentication ）提供身份验证支持。验证通过之后才会允许用户访问安全资源。执行顺序需要在 HttpContext.User 之前， OAuth 回叫的终端。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseAuthentication();</span><br></pre></td></tr></table></figure>
<h3 id="7、授权中间件"><a href="#7、授权中间件" class="headerlink" title="7、授权中间件"></a>7、授权中间件</h3><p>授权中间件（ UseAuthorization ）用于授权验证通过的用户可以访问哪些资源。类似身份认证中间件（ UseAuthentication ）。执行顺序需要在 HttpContext.User 之前， OAuth 回叫的终端。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseAuthentication();</span><br></pre></td></tr></table></figure>
<h3 id="8、会话中间件"><a href="#8、会话中间件" class="headerlink" title="8、会话中间件"></a>8、会话中间件</h3><p>会话中间件（ UseSession ）提供对管理用户会话的支持。应用程序使用会话状态，需要在Cookie策略中间件之后和MVC中间件之前调用会话中间件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseSession();</span><br></pre></td></tr></table></figure>
<h3 id="9、终结点路由中间件"><a href="#9、终结点路由中间件" class="headerlink" title="9、终结点路由中间件"></a>9、终结点路由中间件</h3><p>终结点路由中间件（ UseEndpoints ）向中间件管道添加终结点执行。实际路径执行的。可以配置我们的默认路由等。注意UseEndpoints 跟UseRouting的区别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line"> &#123;</span><br><span class="line">     endpoints.MapControllerRoute(&quot;default&quot;, &quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="10、跨域请求中间件"><a href="#10、跨域请求中间件" class="headerlink" title="10、跨域请求中间件"></a>10、跨域请求中间件</h3><p>跨域请求中间件（UseCors）可以配置跨域的网站，跨域请求策略可防止恶意站点从另一站点读取敏感数据。使用顺序是 UseCors 的调用必须放在 UseRouting 之后，但在 UseAuthorization 之前。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var  MyAllowSpecificOrigins = &quot;_myAllowSpecificOrigins&quot;;//策略名称设置</span><br><span class="line">//配置访问站点</span><br><span class="line">builder.Services.AddCors(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.AddPolicy(name: MyAllowSpecificOrigins,</span><br><span class="line">                      policy  =&gt;</span><br><span class="line">                      &#123;</span><br><span class="line">                          policy.WithOrigins(&quot;http://example.com&quot;,</span><br><span class="line">                                              &quot;http://www.contoso.com&quot;);</span><br><span class="line">                      &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.UseCors(MyAllowSpecificOrigins);//注册到中间件</span><br></pre></td></tr></table></figure>

<h2 id="外部中间件"><a href="#外部中间件" class="headerlink" title="外部中间件"></a>外部中间件</h2><h3 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h3><p>ORM，Object Relational Mapping（对象关系映射）。它的作用是在关系型数据库和实体对象之间做一个映射，简单的属性和方法操作，省去与复杂的SQL打交道。</p>
<pre><code>EntityFramework：微软ORM
NHibernate： Hibernate的.NET实现
Mybatis.net：MyBatis的.NET实现
Dapper：轻量级ORM
SQLSugar：轻量级ORM
ServiceStack.OrmLite：Fast，Simple，Typed ORM for .NET
开源ORM Group https://github.com/orm-group
</code></pre>
<h3 id="任务调度"><a href="#任务调度" class="headerlink" title="任务调度"></a>任务调度</h3><p>Quartz.NET：开源作业调度框架，适合做定时轮询数据库同步，定时邮件处理，定时数据处理等。 底层使用ScheduledThreadPoolExecutor实现，提供了更友好的且带上下文的API。</p>
<p>Timer、TimerTask<br>提供简单调度功能<br>缺点：单线程，性能不足；需要维护上下文；需要自己实现持久化；自己实现分布式；自己实现监控</p>
<p>ScheduledThreadPoolExecutor Timer的多线程版本</p>
<h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><pre><code>Ninject
Castle
Autofac
Unity
Sprint.NET
StructureMap
反射实现，性能差
</code></pre>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><pre><code>NLog
Log4NET
</code></pre>
<h3 id="通讯"><a href="#通讯" class="headerlink" title="通讯"></a>通讯</h3><pre><code>Akka.net： 基于actor模型的高性能并发处理框架
Thrift：一种可伸缩的跨语言通讯框架
SuperSocket
Socket
FastSocket
DotNetty：Netty的.net实现
</code></pre>
<h3 id="消息队列-MQ"><a href="#消息队列-MQ" class="headerlink" title="消息队列 MQ"></a>消息队列 MQ</h3><p>业务消息队列是应用于业务的解耦和分离，应具备分布式，高可靠性，高性能，高实时性，高稳定性，高扩展性等特性。</p>
<pre><code>RabbitMQ：微秒级
Redis.List
MSMQ
RocketMQ：毫秒级；十万级吞吐量；可用性高，分布式；消息几乎零丢失
Kafka：毫秒级；吞吐量高，十万级；可用性高，消息几乎零丢失
ActiveMQ：毫秒级；吞吐量万级，可用性高，有较低概率丢失
中小型公司，技术挑战不高，RabbitMQ是不错的选择；大型公司，基础架构研发实力较强，RocketMQ是很好的选择；大数据领域的实时计算，日志采集等场景，用Kafka不错。
</code></pre>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><pre><code>Redis
MemCache
1 都是内存数据库，但是Redis有持久化
2 Redis支持更多的数据类型
</code></pre>
<h3 id="总线-ESB"><a href="#总线-ESB" class="headerlink" title="总线 ESB"></a>总线 ESB</h3><pre><code>NServiceBus：付费
MassTransit：开源
ESB.NET
Shuttle：开源
</code></pre>
<p>作者：百斧<br>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7e0eb4708a7c">https://www.jianshu.com/p/7e0eb4708a7c</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/13/Net%E9%AB%98%E7%BA%A7/13%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/13/Net%E9%AB%98%E7%BA%A7/13%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">13、数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-13 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-13T10:48:57+08:00">2022-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-04 14:25:27" itemprop="dateModified" datetime="2024-02-04T14:25:27+08:00">2024-02-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/13/Net%E9%AB%98%E7%BA%A7/13%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/13/Net%E9%AB%98%E7%BA%A7/13%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><blockquote>
<p> ArrayArrayList<br>List<br>LinkedList<br>Queue<br>Stack<br>HastSet<br>SortedSet<br>Hashtable<br>SortedList<br>Dictionary<br>SortedDictionary<br>IEnumerable<br>ICollection<br>IList<br>IQueryable </p>
</blockquote>
<h2 id="Array-数组"><a href="#Array-数组" class="headerlink" title="Array 数组"></a>Array 数组</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //Array：在内存上连续分配的，而且元素类型是一样的</span><br><span class="line">    //可以坐标访问  读取快--增删慢，长度不变</span><br><span class="line">    Console.WriteLine(&quot;***************Array******************&quot;);</span><br><span class="line">    int[] intArray = new int[3];</span><br><span class="line">    intArray[0] = 123;</span><br><span class="line">    string[] stringArray = new string[] &#123; &quot;123&quot;, &quot;234&quot; &#125;;//Array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //ArrayList  不定长的，连续分配的；</span><br><span class="line">    //元素没有类型限制，任何元素都是当成object处理，如果是值类型，会有装箱操作</span><br><span class="line">    //读取快--增删慢</span><br><span class="line">    Console.WriteLine(&quot;***************ArrayList******************&quot;);</span><br><span class="line">    ArrayList arrayList = new ArrayList();</span><br><span class="line">    arrayList.Add(&quot;MyProjectApi.Common&quot;);</span><br><span class="line">    arrayList.Add(&quot;Is&quot;);</span><br><span class="line">    arrayList.Add(32);//add增加长度</span><br><span class="line">    //arrayList[4] = 26;//索引复制，不会增加长度</span><br><span class="line">    //删除数据</span><br><span class="line">    //arrayList.RemoveAt(4);</span><br><span class="line">    var value = arrayList[2];</span><br><span class="line">    arrayList.RemoveAt(0);</span><br><span class="line">    arrayList.Remove(&quot;MyProjectApi.Common&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //List:也是Array，内存上都是连续摆放;不定长；泛型，保证类型安全，避免装箱拆箱</span><br><span class="line">    //读取快--增删慢</span><br><span class="line">    Console.WriteLine(&quot;***************List&lt;T&gt;******************&quot;);</span><br><span class="line">    List&lt;int&gt; intList = new List&lt;int&gt;() &#123; 1, 2, 3, 4 &#125;;</span><br><span class="line">    intList.Add(123);</span><br><span class="line">    intList.Add(123);</span><br><span class="line">    //intList.Add(&quot;123&quot;);</span><br><span class="line">    //intList[0] = 123;</span><br><span class="line">    List&lt;string&gt; stringList = new List&lt;string&gt;();</span><br><span class="line">    //stringList[0] = &quot;123&quot;;//异常的</span><br><span class="line">    foreach (var item in intList)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Queue-链表"><a href="#Queue-链表" class="headerlink" title="Queue 链表"></a>Queue 链表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //Queue 链表：先进先出；写日志：</span><br><span class="line">    Console.WriteLine(&quot;***************Queue&lt;T&gt;******************&quot;);</span><br><span class="line">    Queue&lt;string&gt; numbers = new Queue&lt;string&gt;();</span><br><span class="line">    numbers.Enqueue(&quot;one&quot;);</span><br><span class="line">    numbers.Enqueue(&quot;two&quot;);</span><br><span class="line">    numbers.Enqueue(&quot;three&quot;);</span><br><span class="line">    numbers.Enqueue(&quot;four&quot;);</span><br><span class="line">    numbers.Enqueue(&quot;four&quot;);</span><br><span class="line">    numbers.Enqueue(&quot;five&quot;);</span><br><span class="line"></span><br><span class="line">    foreach (string number in numbers)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Console.WriteLine($&quot;Dequeuing &#x27;&#123;numbers.Dequeue()&#125;&#x27;&quot;); //移除</span><br><span class="line">    Console.WriteLine($&quot;Peek at next item to dequeue: &#123; numbers.Peek()&#125;&quot;);</span><br><span class="line">    Console.WriteLine($&quot;Dequeuing &#x27;&#123;numbers.Dequeue()&#125;&#x27;&quot;);</span><br><span class="line"></span><br><span class="line">    Queue&lt;string&gt; queueCopy = new Queue&lt;string&gt;(numbers.ToArray());</span><br><span class="line">    foreach (string number in queueCopy)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Console.WriteLine($&quot;queueCopy.Contains(\&quot;four\&quot;) = &#123;queueCopy.Contains(&quot;four&quot;)&#125;&quot;);</span><br><span class="line">    queueCopy.Clear();</span><br><span class="line">    Console.WriteLine($&quot;queueCopy.Count = &#123;queueCopy.Count&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //Stack 就是链表  先进后出  解析表达式目录树的时候，先产生的数据后使用</span><br><span class="line">    //操作记录为命令，撤销的时候是倒序的</span><br><span class="line">    Console.WriteLine(&quot;***************Stack&lt;T&gt;******************&quot;);</span><br><span class="line">    Stack&lt;string&gt; numbers = new Stack&lt;string&gt;();</span><br><span class="line">    numbers.Push(&quot;one&quot;);</span><br><span class="line">    numbers.Push(&quot;two&quot;);</span><br><span class="line">    numbers.Push(&quot;three&quot;);</span><br><span class="line">    numbers.Push(&quot;four&quot;);</span><br><span class="line">    numbers.Push(&quot;five&quot;);//放进去</span><br><span class="line"></span><br><span class="line">    foreach (string number in numbers)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(number);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine($&quot;Pop &#x27;&#123;numbers.Pop()&#125;&#x27;&quot;);//获取并移除</span><br><span class="line">    Console.WriteLine($&quot;Peek at next item to dequeue: &#123; numbers.Peek()&#125;&quot;);//获取不移除</span><br><span class="line">    Console.WriteLine($&quot;Pop &#x27;&#123;numbers.Pop()&#125;&#x27;&quot;);</span><br><span class="line"></span><br><span class="line">    Stack&lt;string&gt; stackCopy = new Stack&lt;string&gt;(numbers.ToArray());</span><br><span class="line">    foreach (string number in stackCopy)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(number);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine($&quot;stackCopy.Contains(\&quot;four\&quot;) = &#123;stackCopy.Contains(&quot;four&quot;)&#125;&quot;);</span><br><span class="line">    stackCopy.Clear();</span><br><span class="line">    Console.WriteLine($&quot;stackCopy.Count = &#123;stackCopy.Count&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //HashSet:去掉重复：投票</span><br><span class="line">    Console.WriteLine(&quot;***************HashSet&lt;string&gt;******************&quot;);</span><br><span class="line">    HashSet&lt;string&gt; hashSet = new HashSet&lt;string&gt;();</span><br><span class="line">    hashSet.Add(&quot;123&quot;);</span><br><span class="line">    hashSet.Add(&quot;689&quot;);</span><br><span class="line">    hashSet.Add(&quot;456&quot;);</span><br><span class="line">    hashSet.Add(&quot;12435&quot;);</span><br><span class="line">    hashSet.Add(&quot;12435&quot;);</span><br><span class="line">    hashSet.Add(&quot;12435&quot;);</span><br><span class="line">    //hashSet[0];</span><br><span class="line">    foreach (var item in hashSet)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(item);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(hashSet.Count);</span><br><span class="line">    Console.WriteLine(hashSet.Contains(&quot;12345&quot;));</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        HashSet&lt;string&gt; hashSet1 = new HashSet&lt;string&gt;();</span><br><span class="line">        hashSet1.Add(&quot;123&quot;);</span><br><span class="line">        hashSet1.Add(&quot;689&quot;);</span><br><span class="line">        hashSet1.Add(&quot;789&quot;);</span><br><span class="line">        hashSet1.Add(&quot;12435&quot;);</span><br><span class="line">        hashSet1.Add(&quot;12435&quot;);</span><br><span class="line">        hashSet1.Add(&quot;12435&quot;);</span><br><span class="line">        hashSet1.SymmetricExceptWith(hashSet);//补</span><br><span class="line">        hashSet1.UnionWith(hashSet);//并</span><br><span class="line">        hashSet1.ExceptWith(hashSet);//差</span><br><span class="line">        hashSet1.IntersectWith(hashSet);//交 </span><br><span class="line">    &#125;</span><br><span class="line">    hashSet.ToList();</span><br><span class="line">    hashSet.Clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SortedSet"><a href="#SortedSet" class="headerlink" title="SortedSet"></a>SortedSet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //排序的集合：去重 （统计） 而且排序   排名 排行榜</span><br><span class="line">    //统计排名--每统计一个就丢进去集合</span><br><span class="line">    Console.WriteLine(&quot;***************SortedSet&lt;string&gt;******************&quot;);</span><br><span class="line">    SortedSet&lt;string&gt; sortedSet = new SortedSet&lt;string&gt;();</span><br><span class="line">    //IComparer&lt;T&gt; comparer  自定义对象要排序，就用这个指定</span><br><span class="line">    sortedSet.Add(&quot;123&quot;);</span><br><span class="line">    sortedSet.Add(&quot;689&quot;);</span><br><span class="line">    sortedSet.Add(&quot;456&quot;);</span><br><span class="line">    sortedSet.Add(&quot;12435&quot;);</span><br><span class="line">    sortedSet.Add(&quot;12435&quot;);</span><br><span class="line">    sortedSet.Add(&quot;12435&quot;);</span><br><span class="line">    foreach (var item in sortedSet)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(item);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(sortedSet.Count);</span><br><span class="line">    Console.WriteLine(sortedSet.Contains(&quot;12345&quot;));</span><br><span class="line">    &#123;</span><br><span class="line">        SortedSet&lt;string&gt; sortedSet1 = new SortedSet&lt;string&gt;();</span><br><span class="line">        sortedSet1.Add(&quot;123&quot;);</span><br><span class="line">        sortedSet1.Add(&quot;689&quot;);</span><br><span class="line">        sortedSet1.Add(&quot;456&quot;);</span><br><span class="line">        sortedSet1.Add(&quot;12435&quot;);</span><br><span class="line">        sortedSet1.Add(&quot;12435&quot;);</span><br><span class="line">        sortedSet1.Add(&quot;12435&quot;);</span><br><span class="line">        sortedSet1.SymmetricExceptWith(sortedSet);//补</span><br><span class="line">        sortedSet1.UnionWith(sortedSet);//并</span><br><span class="line">        sortedSet1.ExceptWith(sortedSet);//差</span><br><span class="line">        sortedSet1.IntersectWith(sortedSet);//交</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sortedSet.ToList();</span><br><span class="line">    sortedSet.Clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="key-value"><a href="#key-value" class="headerlink" title="key-value"></a>key-value</h1><p>读取快！删除新增也快！<br> key-value  一段连续空间存储Value,基于Key有个算法计算出一个索引，索引和Value是对应的；<br>如果有多个key计算出同一个Value的位置（散列冲突）  可以让第二个+1<br>多个Key 计算相同的结果频率过高是出现在大数据量的时候！<br>如果数据量过大，也会出现性能的持续降低！<br>三万左右数据量时候，就会有明显的性能降低！</p>
<h2 id="Hashtable"><a href="#Hashtable" class="headerlink" title="Hashtable"></a>Hashtable</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;***************Hashtable******************&quot;);</span><br><span class="line">    Hashtable table = new Hashtable();</span><br><span class="line">    table.Add(&quot;123&quot;, &quot;456&quot;);</span><br><span class="line">    table[234] = 456;</span><br><span class="line">    table[234] = 567;</span><br><span class="line">    table[32] = 4562;</span><br><span class="line">    table[1] = 456;</span><br><span class="line">    table[&quot;MyProjectApi.Common&quot;] = 456;</span><br><span class="line">    foreach (DictionaryEntry objDE in table)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(objDE.Key.ToString());</span><br><span class="line">        Console.WriteLine(objDE.Value.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">    //线程安全</span><br><span class="line">    Hashtable.Synchronized(table);//只有一个线程写  多个线程读</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //字典：泛型；key - value，增删查改 都很快；有序的</span><br><span class="line">    //  字典不是线程安全 ConcurrentDictionary</span><br><span class="line">    Console.WriteLine(&quot;***************Dictionary******************&quot;);</span><br><span class="line">    Dictionary&lt;int, string&gt; dic = new Dictionary&lt;int, string&gt;();</span><br><span class="line">    dic.Add(1, &quot;HaHa&quot;);</span><br><span class="line">    dic.Add(5, &quot;HoHo&quot;);</span><br><span class="line">    dic.Add(3, &quot;HeHe&quot;);</span><br><span class="line">    dic.Add(2, &quot;HiHi&quot;);</span><br><span class="line">    dic.Add(4, &quot;HuHu1&quot;);</span><br><span class="line">    dic[4] = &quot;HuHu&quot;;</span><br><span class="line">    dic.Add(4, &quot;HuHu&quot;);</span><br><span class="line">    foreach (var item in dic)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine($&quot;Key:&#123;item.Key&#125;, Value:&#123;item.Value&#125;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SortedDictionary"><a href="#SortedDictionary" class="headerlink" title="SortedDictionary"></a>SortedDictionary</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;***************SortedDictionary******************&quot;);</span><br><span class="line">    SortedDictionary&lt;int, string&gt; dic = new SortedDictionary&lt;int, string&gt;();</span><br><span class="line">    dic.Add(1, &quot;HaHa&quot;);</span><br><span class="line">    dic.Add(5, &quot;HoHo&quot;);</span><br><span class="line">    dic.Add(3, &quot;HeHe&quot;);</span><br><span class="line">    dic.Add(2, &quot;HiHi&quot;);</span><br><span class="line">    dic.Add(4, &quot;HuHu1&quot;);</span><br><span class="line">    dic[4] = &quot;HuHu&quot;;</span><br><span class="line">    dic.Add(4, &quot;HuHu&quot;);</span><br><span class="line">    foreach (var item in dic)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine($&quot;Key:&#123;item.Key&#125;, Value:&#123;item.Value&#125;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SortedList"><a href="#SortedList" class="headerlink" title="SortedList"></a>SortedList</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;a&quot;.GetHashCode();</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(&quot;***************SortedList******************&quot;);</span><br><span class="line">    SortedList sortedList = new SortedList();//IComparer</span><br><span class="line">    sortedList.Add(&quot;First&quot;, &quot;Hello&quot;);</span><br><span class="line">    sortedList.Add(&quot;Second&quot;, &quot;World&quot;);</span><br><span class="line">    sortedList.Add(&quot;Third&quot;, &quot;!&quot;);</span><br><span class="line"></span><br><span class="line">    sortedList[&quot;Third&quot;] = &quot;~~&quot;;//</span><br><span class="line">    sortedList.Add(&quot;Fourth&quot;, &quot;!&quot;);</span><br><span class="line">    sortedList.Add(&quot;Fourth&quot;, &quot;!&quot;);//重复的Key Add会错</span><br><span class="line">    sortedList[&quot;Fourth&quot;] = &quot;!!!&quot;;</span><br><span class="line">    var keyList = sortedList.GetKeyList();</span><br><span class="line">    var valueList = sortedList.GetValueList();</span><br><span class="line"></span><br><span class="line">    sortedList.TrimToSize();//用于最小化集合的内存开销</span><br><span class="line"></span><br><span class="line">    sortedList.Remove(&quot;Third&quot;);</span><br><span class="line">    sortedList.RemoveAt(0);</span><br><span class="line">    sortedList.Clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    //ConcurrentQueue 线程安全版本的Queue</span><br><span class="line">    //ConcurrentStack线程安全版本的Stack</span><br><span class="line">    //ConcurrentBag线程安全的对象集合</span><br><span class="line">    //ConcurrentDictionary线程安全的Dictionary</span><br><span class="line">    //BlockingCollection</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//只有实现了IEnumerable 才能进行遍历</span><br><span class="line">&#123;</span><br><span class="line">    List&lt;string&gt; fruits =</span><br><span class="line">    new List&lt;string&gt; &#123; &quot;apple&quot;, &quot;passionfruit&quot;, &quot;banana&quot;, &quot;mango&quot;,</span><br><span class="line">        &quot;orange&quot;, &quot;blueberry&quot;, &quot;grape&quot;, &quot;strawberry&quot; &#125;; </span><br><span class="line">    IEnumerable&lt;string&gt; query = fruits.Where(fruit =&gt; fruit.Length &lt; 6);</span><br><span class="line">    foreach (var item in query)//遍历才会去查询比较   迭代器 yield</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">    IQueryable&lt;string&gt; queryable = fruits.AsQueryable&lt;string&gt;().Where(s =&gt; s.Length &gt; 5);</span><br><span class="line">    foreach (var item in queryable)//表达式目录树的解析，延迟到遍历的时候才去执行  EF的延迟查询</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/11%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%B8%B8%E6%A0%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/11%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%B8%B8%E6%A0%87/" class="post-title-link" itemprop="url">11、数据库-游标</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-11 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-11T10:48:57+08:00">2022-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-08 22:03:24" itemprop="dateModified" datetime="2024-02-08T22:03:24+08:00">2024-02-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/11%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%B8%B8%E6%A0%87/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/11%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%B8%B8%E6%A0%87/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h1><p>游标可以对一个select的结果集进行处理，或是不需要全部处理，就会返回一个对记录集进行处理之后的结果。
     </p>
<h3 id="1、游标实际上是一种能从多条数据记录的结果集中每次提取一条记录的机制。游标可以完成："><a href="#1、游标实际上是一种能从多条数据记录的结果集中每次提取一条记录的机制。游标可以完成：" class="headerlink" title="1、游标实际上是一种能从多条数据记录的结果集中每次提取一条记录的机制。游标可以完成："></a>1、游标实际上是一种能从多条数据记录的结果集中每次提取一条记录的机制。游标可以完成：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">允许定位到结果集中的特定行</span><br><span class="line">从结果集的当前位置检索一行或多行数据</span><br><span class="line">支持对结果集中当前位置的进行修改</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于游标是将记录集进行一条条的操作，所以这样给服务器增加负担，一般在操作复杂的结果集的情况下，才使用游标。SQL Server 2005有三种游标：T-SQL游标、API游标、客户端游标。
 </p>
</blockquote>
<h3 id="2、游标的基本操作"><a href="#2、游标的基本操作" class="headerlink" title="2、游标的基本操作"></a>2、游标的基本操作</h3><p> 游标的基本操作有定义游标、打开游标、循环读取游标、关闭游标、删除游标。</p>
<ul>
<li>A、 定义游标  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare cursor_name    --游标名称</span><br><span class="line">cursor [local | global]    --全局、局部</span><br><span class="line">[forward only | scroll]    --游标滚动方式</span><br><span class="line">[read_only | scroll_locks | optimistic]    --读取方式</span><br><span class="line">for select_statements                    --查询语句</span><br><span class="line">[for update | of column_name ...]        --修改字段</span><br></pre></td></tr></table></figure>

  参数：<ul>
<li>forward only | scroll：前一个参数，游标只能向后移动；后一个参数，游标可以随意移动</li>
<li>read_only：只读游标</li>
<li>scroll_locks：游标锁定，游标在读取时，数据库会将该记录锁定，以便游标完成对记录的操作</li>
<li>optimistic：该参数不会锁定游标；此时，如果记录被读入游标后，对游标进行更新或删除不会超过</li>
</ul>
</li>
<li>B、 打开游标<br>          open cursor_name;<br>          游标打开后，可以使用全局变量@@cursor_rows显示读取记录条数</li>
<li>C、 检索游标<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">          fetch cursor_name;</span><br><span class="line">          检索方式如下：</span><br><span class="line">             fetch first; 读取第一行</span><br><span class="line">             fetch next; 读取下一行</span><br><span class="line">             fetch prior; 读取上一行</span><br><span class="line">             fetch last; 读取最后一行</span><br><span class="line">             fetch absolute n; 读取某一行</span><br><span class="line">                如果n为正整数，则读取第n条记录</span><br><span class="line">                如果n为负数，则倒数提取第n条记录</span><br><span class="line">                如果n为，则不读取任何记录</span><br><span class="line">             fetch pelative n</span><br><span class="line">                如果n为正整数，则读取上次读取记录之后第n条记录</span><br><span class="line">                如果n为负数，则读取上次读取记录之前第n条记录</span><br><span class="line">                如果n为，则读取上次读取的记录</span><br></pre></td></tr></table></figure></li>
<li>D、 关闭游标<br>          close cursor_name;</li>
<li>E、 删除游标<br>          deallocate cursor_name;</li>
</ul>
<p> </p>
<h3 id="3、游标操作示例"><a href="#3、游标操作示例" class="headerlink" title="3、游标操作示例"></a>3、游标操作示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">--创建一个游标</span><br><span class="line">declare cursor_stu cursor scroll for</span><br><span class="line">    select id, name, age from student;</span><br><span class="line">--打开游标</span><br><span class="line">open cursor_stu;</span><br><span class="line">--存储读取的值</span><br><span class="line">declare @id int,</span><br><span class="line">        @name nvarchar(20),</span><br><span class="line">        @age varchar(20);</span><br><span class="line">--读取第一条记录</span><br><span class="line">fetch first from cursor_stu into @id, @name, @age;</span><br><span class="line">--循环读取游标记录</span><br><span class="line">print &#x27;读取的数据如下：&#x27;;</span><br><span class="line">--全局变量</span><br><span class="line">while (@@fetch_status = 0)</span><br><span class="line">begin</span><br><span class="line">    print &#x27;编号：&#x27; + convert(char(5), @id) + &#x27;, 名称：&#x27; + @name + &#x27;, 类型：&#x27; + @age;</span><br><span class="line">    --继续读取下一条记录</span><br><span class="line">    fetch next from cursor_stu into @id, @name, @age;</span><br><span class="line">end</span><br><span class="line">--关闭游标</span><br><span class="line">close area_cursor;</span><br><span class="line"></span><br><span class="line">--删除游标</span><br><span class="line">--deallocate area_cursor;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/12%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/12%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">12、数据库-自定义函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-11 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-11T10:48:57+08:00">2022-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-08 22:03:24" itemprop="dateModified" datetime="2024-02-08T22:03:24+08:00">2024-02-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/12%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/11/Net%E9%AB%98%E7%BA%A7/12%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="用户自定义函数"><a href="#用户自定义函数" class="headerlink" title="用户自定义函数"></a>用户自定义函数</h1><h3 id="查看当前数据库所有函数"><a href="#查看当前数据库所有函数" class="headerlink" title="查看当前数据库所有函数"></a>查看当前数据库所有函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--查询所有已创建函数</span><br><span class="line">select definition,* from sys.sql_modules m join sys.objects o on m.object_id = o.object_id</span><br><span class="line">and type in(&#x27;fn&#x27;, &#x27;if&#x27;, &#x27;tf&#x27;);</span><br></pre></td></tr></table></figure>
<h3 id="创建函数"><a href="#创建函数" class="headerlink" title="创建函数"></a>创建函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">if (object_id(&#x27;fun_add&#x27;, &#x27;fn&#x27;) is not null)</span><br><span class="line">    drop function fun_add</span><br><span class="line">go</span><br><span class="line">create function fun_add(@num1 int, @num2 int)</span><br><span class="line">    returns int</span><br><span class="line">with execute as caller</span><br><span class="line">as</span><br><span class="line">    begin</span><br><span class="line">        declare @result int;</span><br><span class="line">        if (@num1 is null)</span><br><span class="line">            set @num1 = 0;</span><br><span class="line">        if (@num2 is null)</span><br><span class="line">            set @num2 = 0;</span><br><span class="line">        set @result = @num1 + @num2;</span><br><span class="line">        return @result;</span><br><span class="line">    end</span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select dbo.fun_add(id, age) from student;</span><br><span class="line">-- 自定义函数，字符串连接</span><br><span class="line">if (object_id(&#x27;fun_append&#x27;, &#x27;fn&#x27;) is not null)</span><br><span class="line">    drop function fun_append</span><br><span class="line">go</span><br><span class="line">create function fun_append(@args nvarchar(1024), @args2 nvarchar(1024))</span><br><span class="line">    returns nvarchar(2048)</span><br><span class="line">as</span><br><span class="line">    begin</span><br><span class="line">        return @args + @args2;</span><br><span class="line">    end</span><br><span class="line">go</span><br><span class="line"> </span><br><span class="line">select dbo.fun_append(name, &#x27;abc&#x27;) from student;</span><br></pre></td></tr></table></figure>
<h3 id="修改函数"><a href="#修改函数" class="headerlink" title="修改函数"></a>修改函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">alter function fun_append(@args nvarchar(1024), @args2 nvarchar(1024))</span><br><span class="line">    returns nvarchar(1024)</span><br><span class="line">as</span><br><span class="line">    begin</span><br><span class="line">        declare @result varchar(1024);    </span><br><span class="line">        --coalesce返回第一个不为null的值    </span><br><span class="line">        set @args = coalesce(@args, &#x27;&#x27;);</span><br><span class="line">        set @args2 = coalesce(@args2, &#x27;&#x27;);;</span><br><span class="line">        set @result = @args + @args2;</span><br><span class="line">        return @result;</span><br><span class="line">    end</span><br><span class="line">go</span><br><span class="line"> </span><br><span class="line">select dbo.fun_append(name, &#x27;#abc&#x27;) from student;</span><br></pre></td></tr></table></figure>

<h3 id="返回table类型函数"><a href="#返回table类型函数" class="headerlink" title="返回table类型函数"></a>返回table类型函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--返回table对象函数</span><br><span class="line">select name, object_id, type from sys.objects where type in (&#x27;fn&#x27;, &#x27;if&#x27;, &#x27;tf&#x27;) or type like &#x27;%f%&#x27;;</span><br><span class="line"> </span><br><span class="line">if (exists (select * from sys.objects where type in (&#x27;fn&#x27;, &#x27;if&#x27;, &#x27;tf&#x27;) and name = &#x27;fun_find_stuRecord&#x27;))</span><br><span class="line">    drop function fun_find_stuRecord</span><br><span class="line">go</span><br><span class="line">create function fun_find_stuRecord(@id int)</span><br><span class="line">    returns table</span><br><span class="line">as</span><br><span class="line">    return (select * from student where id = @id);</span><br><span class="line">go</span><br><span class="line"> </span><br><span class="line">select * from dbo.fun_find_stuRecord(2);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/10/Net%E9%AB%98%E7%BA%A7/10%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%A7%86%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/10/Net%E9%AB%98%E7%BA%A7/10%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%A7%86%E5%9B%BE/" class="post-title-link" itemprop="url">10、数据库-事务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-10 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-10T10:48:57+08:00">2022-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-02 23:24:24" itemprop="dateModified" datetime="2024-02-02T23:24:24+08:00">2024-02-02</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/10/Net%E9%AB%98%E7%BA%A7/10%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%A7%86%E5%9B%BE/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/10/Net%E9%AB%98%E7%BA%A7/10%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%A7%86%E5%9B%BE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h3 id="1、-什么是视图"><a href="#1、-什么是视图" class="headerlink" title="1、 什么是视图"></a>1、 什么是视图</h3><p>        视图就是一个虚拟的数据表，该数据表中的数据记录是有一条查询语句的查询结果得到的。
 </p>
<h3 id="2、-创建视图准则"><a href="#2、-创建视图准则" class="headerlink" title="2、 创建视图准则"></a>2、 创建视图准则</h3><ul>
<li>创建视图需要考虑一下准则：
  <ul>
<li>视图名称必须遵循标识符的规则，该名称不得与该架构的如何表的名称相同</li>
<li>你可以对其他视图创建视图。允许嵌套视图，但嵌套不得超过32层。视图最多可以有1024个字段</li>
<li>不能将规则和default定义于视图相关联</li>
<li>视图的查询不能包含compute子句、compute by子句或into关键字</li>
<li>定义视图的查询不能包含order by子句，除非在select 语句的选择列表中还有top子句</li>
</ul>
<p> </p>
</li>
<li>下列情况必须指定视图中每列的名称：<ul>
<li>视图中的如何列都是从算术表达式、内置函数或常量派生而来</li>
<li>视图中有两列或多列具有相同名称（通常由于视图定义包含联接，因此来自两个或多个不同的列具有相同的名称）</li>
<li>希望视图中的列指定一个与其原列不同的名称（也可以在视图中重命名列）。无论是否重命名，视图列都回继承原列的数据类型</li>
</ul>
</li>
</ul>
<p> </p>
<h3 id="3、-创建视图"><a href="#3、-创建视图" class="headerlink" title="3、 创建视图"></a>3、 创建视图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--创建视图</span><br><span class="line">if (exists (select * from sys.objects where name = &#x27;v_stu&#x27;))</span><br><span class="line">    drop view v_stu</span><br><span class="line">go</span><br><span class="line">create view v_stu</span><br><span class="line">as</span><br><span class="line">select id, name, age, sex from student;</span><br></pre></td></tr></table></figure>

<h3 id="4、-修改视图"><a href="#4、-修改视图" class="headerlink" title="4、 修改视图"></a>4、 修改视图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">alter view v_stu</span><br><span class="line">as</span><br><span class="line">select id, name, sex from student;</span><br><span class="line"> </span><br><span class="line">alter view v_stu(编号, 名称, 性别)</span><br><span class="line">as</span><br><span class="line">    select id, name, sex from student</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select * from v_stu;</span><br><span class="line"> </span><br><span class="line">select * from information_schema.views;</span><br></pre></td></tr></table></figure>
<h3 id="5、-加密视图"><a href="#5、-加密视图" class="headerlink" title="5、 加密视图"></a>5、 加密视图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">--加密视图</span><br><span class="line">if (exists (select * from sys.objects where name = &#x27;v_student_info&#x27;))</span><br><span class="line">    drop view v_student_info</span><br><span class="line">go</span><br><span class="line">create view v_student_info</span><br><span class="line">with encryption --加密</span><br><span class="line">as</span><br><span class="line">    select id, name, age from student</span><br><span class="line">go</span><br><span class="line">--view_definition is null</span><br><span class="line">select * from information_schema.views </span><br><span class="line">where table_name like &#x27;v_stu&#x27;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/09/Net%E9%AB%98%E7%BA%A7/9%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/09/Net%E9%AB%98%E7%BA%A7/9%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">9、数据库-事务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-09 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-09T10:48:57+08:00">2022-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-02 23:17:49" itemprop="dateModified" datetime="2024-02-02T23:17:49+08:00">2024-02-02</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/09/Net%E9%AB%98%E7%BA%A7/9%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%BA%8B%E5%8A%A1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/09/Net%E9%AB%98%E7%BA%A7/9%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%BA%8B%E5%8A%A1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><blockquote>
<p>在数据库中有时候需要把多个步骤的指令当作一个整体来运行，这个整体要么全部成功，要么全部失败，这就需要用到事务。</p>
</blockquote>
<ul>
<li><p>1、 事务的特点<br>        事务有若干条T-SQL指令组成，并且所有的指令昨晚一个整体提交给数据库系统，执行时，这组指令要么全部执行完成，要么全部取消。因此，事务是一个不可分割的逻辑单元。</p>
<blockquote>
<p>事务有4个属性：<br>      原子性（Atomicity）、<br>      一致性（Consistency）、<br>      隔离性（Isolation）<br>      持久性（Durability）
   </p>
</blockquote>
<ul>
<li>原子性：事务内的所有工作要么全部完成，要么全部不完成，不存在只有一部分完成的情况。</li>
<li>一致性：事务内的然后操作都不能违反数据库的然后约束或规则，事务完成时有内部数据结构都必须是正确的。</li>
<li>隔离性：事务直接是相互隔离的，如果有两个事务对同一个数据库进行操作，比如读取表数据。任何一个事务看到的所有内容要么是其他事务完成之前的状态，要么是其他事务完成之后的状态。一个事务不可能遇到另一个事务的中间状态。</li>
<li>持久性：事务完成之后，它对数据库系统的影响是持久的，即使是系统错误，重新启动系统后，该事务的结果依然存在。</li>
</ul>
</li>
<li><p>2、 事务的模式</p>
<ul>
<li>a、 显示事务<blockquote>
<p>显示事务就是用户使用T-SQL明确的定义事务的开始（begin transaction）和提交（commit transaction）或回滚事务（rollback transaction）</p>
</blockquote>
</li>
<li>b、 自动提交事务<blockquote>
<p>自动提交事务是一种能够自动执行并能自动回滚事务，这种方式是T-SQL的默认事务方式。例如在删除一个表记录的时候，如果这条记录有主外键关系的时候，删除就会受主外键约束的影响，那么这个删除就会取消。<br>    可以设置事务进入隐式方式：set implicit_transaction on;</p>
</blockquote>
</li>
<li>c、 隐式事务<blockquote>
<p>隐式事务是指当事务提交或回滚后，SQL Server自动开始事务。因此，隐式事务不需要使用begin transaction显示开始，只需直接失业提交事务或回滚事务的T-SQL语句即可。<br>  使用时，需要设置set implicit_transaction on语句，将隐式事务模式打开，下一个语句会启动一个新的事物，再下一个语句又将启动一个新事务。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>3、 事务处理<br>        常用T-SQL事务语句：</p>
<ul>
<li>a、 begin transaction语句<blockquote>
<p>开始事务，而@@trancount全局变量用来记录事务的数目值加1，可以用@@error全局变量记录执行过程中的错误信息，如果没有错误可以直接提交事务，有错误可以回滚。</p>
</blockquote>
</li>
<li>b、 commit transaction语句<blockquote>
<p>回滚事务，表示一个隐式或显示的事务的结束，对数据库所做的修改正式生效。并将@@trancount的值减1；</p>
</blockquote>
</li>
<li>c、 rollback transaction语句<blockquote>
<p>回滚事务，执行rollback tran语句后，数据会回滚到begin tran的时候的状态</p>
</blockquote>
</li>
</ul>
</li>
<li><p>4、 事务的示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">--开始事务</span><br><span class="line">begin transaction tran_bank;</span><br><span class="line">declare @tran_error int;</span><br><span class="line">    set @tran_error = 0;</span><br><span class="line">    begin try</span><br><span class="line">        update bank set totalMoney = totalMoney - 10000 where userName = &#x27;jack&#x27;;        </span><br><span class="line">        set @tran_error = @tran_error + @@error;</span><br><span class="line">        update bank set totalMoney = totalMoney + 10000 where userName = &#x27;jason&#x27;;</span><br><span class="line">        set @tran_error = @tran_error + @@error;</span><br><span class="line">    end try</span><br><span class="line">    begin catch        </span><br><span class="line">        print &#x27;出现异常，错误编号：&#x27; + convert(varchar, error_number()) + &#x27;， 错误消息：&#x27; + error_message(); </span><br><span class="line">        set @tran_error = @tran_error + 1;</span><br><span class="line">    end catch</span><br><span class="line">if (@tran_error &gt; 0)</span><br><span class="line">    begin</span><br><span class="line">        --执行出错，回滚事务</span><br><span class="line">        rollback tran;</span><br><span class="line">        print &#x27;转账失败，取消交易&#x27;;</span><br><span class="line">    end</span><br><span class="line">else</span><br><span class="line">    begin</span><br><span class="line">        --没有异常，提交事务</span><br><span class="line">        commit tran;</span><br><span class="line">        print &#x27;转账成功&#x27;;</span><br><span class="line">    end</span><br><span class="line">go</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/08/Net%E9%AB%98%E7%BA%A7/8%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/08/Net%E9%AB%98%E7%BA%A7/8%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">8、数据库-查询</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-08 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-08T10:48:57+08:00">2022-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-02 22:59:32" itemprop="dateModified" datetime="2024-02-02T22:59:32+08:00">2024-02-02</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/08/Net%E9%AB%98%E7%BA%A7/8%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%9F%A5%E8%AF%A2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/08/Net%E9%AB%98%E7%BA%A7/8%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%9F%A5%E8%AF%A2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本常用查询"><a href="#基本常用查询" class="headerlink" title="基本常用查询"></a>基本常用查询</h1><p>###select<br>select * from student;<br> <br>###all 查询所有<br>select all sex from student;<br> <br>###distinct 过滤重复<br>select distinct sex from student;<br> <br>###count 统计<br>select count(<em>) from student;<br>select count(sex) from student;<br>select count(distinct sex) from student;<br> <br>###top 取前N条记录<br>select top 3 * from student;<br> <br>###alias column name 列重命名<br>select id as 编号, name ‘名称’, sex 性别 from student;<br> <br>###alias table name 表重命名<br>select id, name, s.id, s.name from student s;<br> <br>###column 列运算<br>select (age + id) col from student;<br>select s.name + ‘-‘ + c.name from classes c, student s where s.cid &#x3D; c.id;<br> <br>###where 条件<br>select * from student where id &#x3D; 2;<br>select * from student where id &gt; 7;<br>select * from student where id &lt; 3;<br>select * from student where id &lt;&gt; 3;<br>select * from student where id &gt;&#x3D; 3;<br>select * from student where id &lt;&#x3D; 5;<br>select * from student where id !&gt; 3;<br>select * from student where id !&lt; 5;<br> <br>###and 并且<br>select * from student where id &gt; 2 and sex &#x3D; 1;<br> <br>###or 或者<br>select * from student where id &#x3D; 2 or sex &#x3D; 1;<br> <br>###between … and … 相当于并且<br>select * from student where id between 2 and 5;<br>select * from student where id not between 2 and 5;<br> <br>###like 模糊查询<br>select * from student where name like  ‘%a%’;<br>select * from student where name like  ‘%[a][o]%’;<br>select * from student where name not like  ‘%a%’;<br>select * from student where name like ‘ja%’;<br>select * from student where name not like ‘%[j,n]%’;<br>select * from student where name like ‘%[j,n,a]%’;<br>select * from student where name like ‘%[^ja,as,on]%’;<br>select * from student where name like ‘%[ja_on]%’;<br> <br>###in 子查询<br>select * from student where id in (1, 2);<br> <br>###not in 不在其中<br>select * from student where id not in (1, 2);<br> <br>###is null 是空<br>select * from student where age is null;<br> <br>###is not null 不为空<br>select * from student where age is not null;<br> <br>###order by 排序<br>select * from student order by name;<br>select * from student order by name desc;<br>select * from student order by name asc;<br> <br>###group by 分组<br>按照年龄进行分组统计<br>select count(age), age from student group by age;<br>按照性别进行分组统计<br>select count(</em>), sex from student group by sex;<br>按照年龄和性别组合分组统计，并排序<br>select count(<em>), sex from student group by sex, age order by age;<br>按照性别分组，并且是id大于2的记录最后按照性别排序<br>select count(</em>), sex from student where id &gt; 2 group by sex order by sex;<br>查询id大于2的数据，并完成运算后的结果进行分组和排序<br>select count(<em>), (sex * id) new from student where id &gt; 2 group by sex * id order by sex * id;<br> <br>###group by all 所有分组<br>按照年龄分组，是所有的年龄<br>select count(</em>), age from student group by all age;<br> <br>###having 分组过滤条件<br>按照年龄分组，过滤年龄为空的数据，并且统计分组的条数和现实年龄信息<br>select count(<em>), age from student group by age having age is not null;<br> <br>按照年龄和cid组合分组，过滤条件是cid大于1的记录<br>select count(</em>), cid, sex from student group by cid, sex having cid &gt; 1;<br> <br>按照年龄分组，过滤条件是分组后的记录条数大于等于2<br>select count(<em>), age from student group by age having count(age) &gt;&#x3D; 2;<br> <br>按照cid和性别组合分组，过滤条件是cid大于1，cid的最大值大于2<br>select count(</em>), cid, sex from student group by cid, sex having cid &gt; 1 and max(cid) &gt; 2;<br>Ø 嵌套子查询<br>    子查询是一个嵌套在select、insert、update或delete语句或其他子查询中的查询。任何允许使用表达式的地方都可以使用子查询。子查询也称为内部查询或内部选择，而包含子查询的语句也成为外部查询或外部选择。
 </p>
<h1 id="from-select-…-table-示例"><a href="#from-select-…-table-示例" class="headerlink" title="from (select … table)示例"></a>from (select … table)示例</h1><p>将一个table的查询结果当做一个新表进行查询<br>select * from (<br>    select id, name from student where sex &#x3D; 1<br>) t where t.id &gt; 2;<br>上面括号中的语句，就是子查询语句（内部查询）。在外面的是外部查询，其中外部查询可以包含以下语句：<br>     1、 包含常规选择列表组件的常规select查询<br>     2、 包含一个或多个表或视图名称的常规from语句<br>     3、 可选的where子句<br>     4、 可选的group by子句<br>     5、 可选的having子句
 </p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>查询班级信息，统计班级学生人生<br>select <em>, (select count(</em>) from student where cid &#x3D; classes.id) as num<br>from classes order by num;
 </p>
<h1 id="in-not-in子句查询示例"><a href="#in-not-in子句查询示例" class="headerlink" title="in, not in子句查询示例"></a>in, not in子句查询示例</h1><p>查询班级id大于小于的这些班级的学生信息<br>select * from student where cid in (<br>    select id from classes where id &gt; 2 and id &lt; 4<br>);<br> <br>查询不是2班的学生信息<br>select * from student where cid not in (<br>    select id from classes where name &#x3D; ‘2班’<br>)<br>in、not in 后面的子句返回的结果必须是一列，这一列的结果将会作为查询条件对应前面的条件。如cid对应子句的id；
 </p>
<h1 id="exists和not-exists子句查询示例"><a href="#exists和not-exists子句查询示例" class="headerlink" title="exists和not exists子句查询示例"></a>exists和not exists子句查询示例</h1><p>查询存在班级id为3的学生信息<br>select * from student where exists (<br>    select * from classes where id &#x3D; student.cid and id &#x3D; 3<br>);<br> <br>查询没有分配班级的学生信息<br>select * from student where not exists (<br>    select * from classes where id &#x3D; student.cid<br>);<br>exists和not exists查询需要内部查询和外部查询进行一个关联的条件，如果没有这个条件将是查询到的所有信息。如：id等于student.id；
 </p>
<h1 id="some、any、all子句查询示例"><a href="#some、any、all子句查询示例" class="headerlink" title="some、any、all子句查询示例"></a>some、any、all子句查询示例</h1><p>查询班级的学生年龄大于班级的学生的年龄的信息<br>select * from student where cid &#x3D; 5 and age &gt; all (<br>    select age from student where cid &#x3D; 3<br>);<br> <br>select * from student where cid &#x3D; 5 and age &gt; any (<br>    select age from student where cid &#x3D; 3<br>);<br> <br>select * from student where cid &#x3D; 5 and age &gt; some (<br>    select age from student where cid &#x3D; 3<br>);
 </p>
<h2 id="O-聚合查询"><a href="#O-聚合查询" class="headerlink" title="Ø 聚合查询"></a>Ø 聚合查询</h2><p>1、 distinct去掉重复数据<br>select distinct sex from student;<br>select count(sex), count(distinct sex) from student;<br> <br>2、 compute和compute by汇总查询</p>
<table>
<thead>
<tr>
<th>customer_name</th>
<th>total_amount</th>
<th>…</th>
<th>SUM(order_amount)</th>
</tr>
</thead>
<tbody><tr>
<td>John</td>
<td>100</td>
<td>…</td>
<td></td>
</tr>
<tr>
<td>Jane</td>
<td>150</td>
<td>…</td>
<td></td>
</tr>
<tr>
<td>…</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td></td>
<td></td>
<td>1000</td>
</tr>
</tbody></table>
<p>对年龄大于20的进行汇总<br>select age from student<br>where age &gt; 20 order by age compute sum(age) by age;<br> <br>对年龄大于的按照性别进行分组汇总年龄信息<br>select id, sex, age from student<br>where age &gt; 20 order by sex, age compute sum(age) by sex;<br> <br>按照年龄分组汇总<br>select age from student<br>where age &gt; 20 order by age, id compute sum(age);<br> <br>按照年龄分组，年龄汇总，id找最大值<br>select id, age from student<br>where age &gt; 20 order by age compute sum(age), max(id);<br>compute进行汇总前面是查询的结果，后面一条结果集就是汇总的信息。compute子句中可以添加多个汇总表达式，可以添加的信息如下：<br>     a、 可选by关键字。它是每一列计算指定的行聚合<br>     b、 行聚合函数名称。包括sum、avg、min、max、count等<br>     c、 要对其执行聚合函数的列<br>     compute by适合做先分组后汇总的业务。compute by后面的列一定要是order by中出现的列。<br> <br>3、 cube汇总<br>cube汇总和compute效果类似，但语法较简洁，而且返回的是一个结果集。<br>select count(<em>), sex from student group by sex with cube;<br>select count(</em>), age, sum(age) from student where age is not null group by age with cube;<br>cube要结合group by语句完成分组汇总
 </p>
<h2 id="排序函数"><a href="#排序函数" class="headerlink" title="排序函数"></a>排序函数</h2><p>   排序在很多地方需要用到，需要对查询结果进行排序并且给出序号。比如：<br>   1、 对某张表进行排序，序号需要递增不重复的<br>   2、 对学生的成绩进行排序，得出名次，名次可以并列，但名次的序号是连续递增的<br>   3、 在某些排序的情况下，需要跳空序号，虽然是并列<br>基本语法<br>排序函数 over([分组语句] 排序子句[desc][asc])<br>排序子句 order by 列名, 列名<br>分组子句 partition by 分组列, 分组列
 </p>
<h1 id="row-number函数"><a href="#row-number函数" class="headerlink" title="row_number函数"></a>row_number函数</h1><p>根据排序子句给出递增连续序号<br>按照名称排序的顺序递增<br>select s.id, s.name, cid, c.name, row_number() over(order by c.name) as number<br>from student s, classes c where cid &#x3D; c.id;</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>cid</th>
<th>name</th>
<th>number</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Alice</td>
<td>1</td>
<td>Math</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>2</td>
<td>English</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>Charlie</td>
<td>3</td>
<td>Science</td>
<td>3</td>
</tr>
</tbody></table>
<p>使用row_number() over(order by c.name)函数，我们按照课程名称的顺序为每个学生分配了一个行号（number）。</p>
<p> </p>
<h1 id="rank函数函数"><a href="#rank函数函数" class="headerlink" title="rank函数函数"></a>rank函数函数</h1><p>根据排序子句给出递增的序号，但是存在并列并且跳空<br>顺序递增<br>select id, name, rank() over(order by cid) as rank from student;</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>rank</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Alice</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>David</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>Charlie</td>
<td>4</td>
</tr>
</tbody></table>
<p> <br>跳过相同递增<br>select s.id, s.name, cid, c.name, rank() over(order by c.name) as rank<br>from student s, classes c where cid &#x3D; c.id;
 </p>
<h1 id="dense-rank函数"><a href="#dense-rank函数" class="headerlink" title="dense_rank函数"></a>dense_rank函数</h1><p>根据排序子句给出递增的序号，但是存在并列不跳空<br>不跳过，直接递增<br>select s.id, s.name, cid, c.name, dense_rank() over(order by c.name) as dense<br>from student s, classes c where cid &#x3D; c.id;
 </p>
<h1 id="partition-by分组子句"><a href="#partition-by分组子句" class="headerlink" title="partition by分组子句"></a>partition by分组子句</h1><p>可以完成对分组的数据进行增加排序，partition by可以与以上三个函数联合使用。<br>利用partition by按照班级名称分组，学生id排序<br>select s.id, s.name, cid, c.name, row_number() over(partition by c.name order by s.id) as rank<br>from student s, classes c where cid &#x3D; c.id;<br> <br>select s.id, s.name, cid, c.name, rank() over(partition by c.name order by s.id) as rank<br>from student s, classes c where cid &#x3D; c.id;<br> <br>select s.id, s.name, cid, c.name, dense_rank() over(partition by c.name order by s.id) as rank<br>from student s, classes c where cid &#x3D; c.id;
 </p>
<h1 id="ntile平均排序函数"><a href="#ntile平均排序函数" class="headerlink" title="ntile平均排序函数"></a>ntile平均排序函数</h1><p>将要排序的数据进行平分，然后按照等分排序。ntile中的参数代表分成多少等分。<br>select s.id, s.name, cid, c.name,<br>ntile(5) over(order by c.name) as ntile<br>from student s, classes c where cid &#x3D; c.id;<br> <br>Ø 集合运算<br>操作两组查询结果，进行交集、并集、减集运算<br>1、 union和union all进行并集运算<br>###union 并集、不重复<br>select id, name from student where name like ‘ja%’<br>union<br>select id, name from student where id &#x3D; 4;<br> <br>###并集、重复<br>select * from student where name like ‘ja%’<br>union all<br>select * from student;<br> <br>2、 intersect进行交集运算<br>###交集（相同部分）<br>select * from student where name like ‘ja%’<br>intersect<br>select * from student;<br> <br>3、 except进行减集运算<br>###减集（除相同部分）<br>select * from student where name like ‘ja%’<br>except<br>select * from student where name like ‘jas%’;<br> <br>Ø 公式表表达式<br>查询表的时候，有时候中间表需要重复使用，这些子查询被重复查询调用，不但效率低，而且可读性低，不利于理解。那么公式表表达式可以解决这个问题。<br>我们可以将公式表表达式（CET）视为临时结果集，在select、insert、update、delete或是create view语句的执行范围内进行定义。<br>###表达式<br>with statNum(id, num) as<br>(<br>    select cid, count(<em>)<br>    from student<br>    where id &gt; 0<br>    group by cid<br>)<br>select id, num from statNum order by id;<br> <br>with statNum(id, num) as<br>(<br>    select cid, count(</em>)<br>    from student<br>    where id &gt; 0<br>    group by cid<br>)<br>select max(id), avg(num) from statNum;<br> <br>Ø 连接查询<br>1、 简化连接查询<br>###简化联接查询<br>select s.id, s.name, c.id, c.name from student s, classes c where s.cid &#x3D; c.id;<br> <br>2、 left join左连接<br>###左连接<br>select s.id, s.name, c.id, c.name from student s left join classes c on s.cid &#x3D; c.id;<br> <br>3、 right join右连接<br>###右连接<br>select s.id, s.name, c.id, c.name from student s right join classes c on s.cid &#x3D; c.id;<br> <br>4、 inner join内连接<br>###内连接<br>select s.id, s.name, c.id, c.name from student s inner join classes c on s.cid &#x3D; c.id;<br> <br>###inner可以省略<br>select s.id, s.name, c.id, c.name from student s join classes c on s.cid &#x3D; c.id;<br> <br>5、 cross join交叉连接<br>###交叉联接查询，结果是一个笛卡儿乘积<br>select s.id, s.name, c.id, c.name from student s cross join classes c<br>###where s.cid &#x3D; c.id;<br> <br>6、 自连接（同一张表进行连接查询）<br>###自连接<br>select distinct s.* from student s, student s1 where s.id &lt;&gt; s1.id and s.sex &#x3D; s1.sex;<br> <br>Ø 函数<br>1、 聚合函数<br>max最大值、min最小值、count统计、avg平均值、sum求和、var求方差<br>select<br>    max(age) max_age,<br>    min(age) min_age,<br>    count(age) count_age,<br>    avg(age) avg_age,<br>    sum(age) sum_age,<br>    var(age) var_age<br>from student;<br> <br>2、 日期时间函数<br>select dateAdd(day, 3, getDate());###加天<br>select dateAdd(year, 3, getDate());###加年<br>select dateAdd(hour, 3, getDate());###加小时<br>###返回跨两个指定日期的日期边界数和时间边界数<br>select dateDiff(day, ‘2011-06-20’, getDate());<br>###相差秒数<br>select dateDiff(second, ‘2011-06-22 11:00:00’, getDate());<br>###相差小时数<br>select dateDiff(hour, ‘2011-06-22 10:00:00’, getDate());<br>select dateName(month, getDate());###当前月份<br>select dateName(minute, getDate());###当前分钟<br>select dateName(weekday, getDate());###当前星期<br>select datePart(month, getDate());###当前月份<br>select datePart(weekday, getDate());###当前星期<br>select datePart(second, getDate());###当前秒数<br>select day(getDate());###返回当前日期天数<br>select day(‘2011-06-30’);###返回当前日期天数<br>select month(getDate());###返回当前日期月份<br>select month(‘2011-11-10’);<br>select year(getDate());###返回当前日期年份<br>select year(‘2010-11-10’);<br>select getDate();###当前系统日期<br>select getUTCDate();###utc日期<br> <br>3、 数学函数<br>select pi();###PI函数<br>select rand(100), rand(50), rand(), rand();###随机数<br>select round(rand(), 3), round(rand(100), 5);###精确小数位<br>###精确位数，负数表示小数点前<br>select round(123.456, 2), round(254.124, -2);<br>select round(123.4567, 1, 2);<br> <br>4、 元数据<br>select col_name(object_id(‘student’), 1);###返回列名<br>select col_name(object_id(‘student’), 2);<br>###该列数据类型长度<br>select col_length(‘student’, col_name(object_id(‘student’), 2));<br>###该列数据类型长度<br>select col_length(‘student’, col_name(object_id(‘student’), 1));<br>###返回类型名称、类型id<br>select type_name(type_id(‘varchar’)), type_id(‘varchar’);<br>###返回列类型长度<br>select columnProperty(object_id(‘student’), ‘name’, ‘PRECISION’);<br>###返回列所在索引位置<br>select columnProperty(object_id(‘student’), ‘sex’, ‘ColumnId’);</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/07/Net%E9%AB%98%E7%BA%A7/7%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%BB%E4%BB%8E%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/07/Net%E9%AB%98%E7%BA%A7/7%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%BB%E4%BB%8E%E5%BA%93/" class="post-title-link" itemprop="url">7、数据库-主从库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-07 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-07T10:48:57+08:00">2022-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-02 21:53:59" itemprop="dateModified" datetime="2024-02-02T21:53:59+08:00">2024-02-02</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/07/Net%E9%AB%98%E7%BA%A7/7%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%BB%E4%BB%8E%E5%BA%93/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/07/Net%E9%AB%98%E7%BA%A7/7%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%BB%E4%BB%8E%E5%BA%93/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySql-主从库配置"><a href="#MySql-主从库配置" class="headerlink" title="MySql 主从库配置"></a>MySql 主从库配置</h1><p>利用MySQL主从配置，实现读写分离，减轻数据库压力。</p>
<blockquote>
<p>大型网站为了软解大量的并发访问，除了在网站实现分布式负载均衡，远远不够。到了数据业务层、数据访问层，如果还是传统的数据结构，或者只是单单靠一台服务器扛，如此多的数据库连接操作，数据库必然会崩溃，数据丢失的话，后果更是 不堪设想。这时候，我们会考虑如何减少数据库的联接，一方面采用优秀的代码框架，进行代码的优化，采用优秀的数据缓存技术如：memcached,如果资金丰厚的话，必然会想到假设服务器群，来分担主数据库的压力。</p>
</blockquote>
<h2 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h2><p>搭设一台Master服务器（win8.1系统，Ip：192.168.0.104）<br>搭设两台Slave服务器（虚拟机一台Ubuntu，一台 Windows Server 2003）</p>
<h2 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h2><p>主服务器（Master）负责网站NonQuery操作，从服务器负责Query操作，用户可以根据网站功能模特性块固定访问Slave服务器，或者自己写个池或队列，自由为请求分配从服务器连接。主从服务器利用MySQL的二进制日志文件，实现数据同步。二进制日志由主服务器产生，从服务器响应获取同步数据库。</p>
<h2 id="具体实现："><a href="#具体实现：" class="headerlink" title="具体实现："></a>具体实现：</h2><ul>
<li><p>1、在主从服务器上都装上MySQL数据库</p>
<pre><code>  windows系统安装的是mysql_5.5.25.msi版本
  Ubuntu安装的是mysql-5.6.22-linux-glibc2.5-i686.tar
</code></pre>
<blockquote>
<p>windows安装mysql就不谈了，一般地球人都应该会。鄙人稍微说一下Ubuntu的MySQL安装，我建议不要在线下载安装，还是离线安装的好。大家可以参考  <a target="_blank" rel="noopener" href="http://www.linuxidc.com/Linux/2013-01/78716.htm">http://www.linuxidc.com/Linux/2013-01/78716.htm</a> 这位不知道大哥还是姐妹，写的挺好按照这个就能装上。在安装的时候可能会出现几种现象，大家可以参考解决一下：</p>
</blockquote>
<ul>
<li>（1）如果您不是使用root用户登录，建议 su - root 切换到Root用户安装，那就不用老是 sudo 了。</li>
<li>（2）存放解压的mysql 文件夹，文件夹名字最好改成mysql</li>
<li>（3）在.&#x2F;support-files&#x2F;mysql.server start 启动MySQL的时候，可能会出现一个警告，中文意思是启动服务运行读文件时，忽略了my.cnf文件，那是因为my.cnf的文件权限有问题，mysql会认为该文件有危险不会执行。但是mysql还会启动成功，但如果下面配置从服务器参数修改my.cnf文件的时候，你会发现文件改过了，但是重启服务时，修改过后的配置没有执行，而且您 list一下mysql的文件夹下会发现很多.my.cnf.swp等中间文件。这都是因为MySQL启动时没有读取my.cnf的原因。<blockquote>
<p>这时只要将my.cnf的文件权限改成my_new.cnf的权限一样就Ok，输入以下命令：<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 644 my.cnf</span><br></pre></td></tr></table></figure><br>  <img src="/BlogPro/image-6.png" alt="Alt text"></p>
</blockquote>
</li>
<li>（4）Ubuntu中修改文档内容没有Vim，最好把Vim 装上，apt-get install vim,不然估计会抓狂。</li>
</ul>
</li>
<li><p>2、配置Master主服务器</p>
<ul>
<li>（1）在Master MySQL上创建一个用户‘repl’，并允许其他Slave服务器可以通过远程访问Master，通过该用户读取二进制日志，实现数据同步。</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create user repl;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;&#x2F;创建新用户2 &#x2F;&#x2F;repl用户必须具有REPLICATION SLAVE权限，除此之外没有必要添加不必要的权限，密码为mysql。说明一下192.168.0.%，这个配置是指明repl用户所在服务器，这里%是通配符，表示192.168.0.0-192.168.0.255的Server都可以以repl用户登陆主服务器。当然你也可以指定固定Ip。</p>
</blockquote>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#x27;repl&#x27;@&#x27;192.168.0.%&#x27; IDENTIFIED BY &#x27;mysql&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>（2）找到MySQL安装文件夹修改my.Ini文件。mysql中有好几种日志方式，这不是今天的重点。我们只要启动二进制日志log-bin就ok。</li>
</ul>
<p>  在[mysqld]下面增加下面几行代码</p>
<blockquote>
<p>给数据库服务的唯一标识，一般为大家设置服务器Ip的末尾号<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line">log-bin=master-bin</span><br><span class="line"></span><br><span class="line">log-bin-index=master-bin.index</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>（3）查看日志<br>  mysql&gt; SHOW MASTER STATUS;<br>  +——————-+———-+————–+——————+<br>  | File | Position | Binlog_Do_DB | Binlog_Ignore_DB |<br>  +——————-+———-+————–+——————+<br>  | master-bin.000001 | 1285 | | |<br>  +——————-+———-+————–+——————+<br>  1 row in set (0.00 sec)<br>  重启MySQL服务</li>
</ul>
</li>
<li><p>3、配置Slave从服务器（windows）</p>
<ul>
<li><p>（1）找到MySQL安装文件夹修改my.ini文件，在[mysqld]下面增加下面几行代码</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> [mysqld]</span><br><span class="line"> server-id=2</span><br><span class="line">relay-log-index=slave-relay-bin.index</span><br><span class="line">relay-log=slave-relay-bin </span><br></pre></td></tr></table></figure>
<p>  重启MySQL服务</p>
</li>
<li><p>（2）连接Master<br>  change master to master_host&#x3D;’192.168.0.104’, &#x2F;&#x2F;Master 服务器Ip<br>  master_port&#x3D;3306,<br>  master_user&#x3D;’repl’,<br>  master_password&#x3D;’mysql’, <br>  master_log_file&#x3D;’master-bin.000001’,&#x2F;&#x2F;Master服务器产生的日志<br>  master_log_pos&#x3D;0;</p>
</li>
<li><p>（3）启动Slave</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>4、Slave从服务器（Ubuntu）</p>
<ul>
<li>（1）找到MySQL安装文件夹修改my.cnf文件,vim my.cnf<br>  <img src="/BlogPro/image-7.png" alt="Alt text"></li>
<li>（2） .&#x2F;support-files&#x2F;myql.server restart 重启MySQL服务  ,  .&#x2F;bin&#x2F;mysql 进入MySQL命令窗口 </li>
<li>（3）连接Master<br>  change master to master_host&#x3D;’192.168.0.104’, &#x2F;&#x2F;Master 服务器Ip<br>  master_port&#x3D;3306,<br>  master_user&#x3D;’repl’,<br>  master_password&#x3D;’mysql’, <br>  master_log_file&#x3D;’master-bin.000001’,&#x2F;&#x2F;Master服务器产生的日志<br>  master_log_pos&#x3D;0;</li>
<li>（4）启动Slave  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<blockquote>
<p>OK所有配置都完成了，这时候大家可以在Master Mysql 中进行测试了，因为我们监视的时Master mysql  所有操作日志，所以，你的任何改变主服务器数据库的操作，都会同步到从服务器上。创建个数据库，表试试吧。。。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://smdegz.github.io/BlogPro/2022/04/06/Net%E9%AB%98%E7%BA%A7/6%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/BlogPro/images/Wx.jpg">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="这里是何锦祥的博客，记录生活点滴，分享思考与感悟。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何锦祥 博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/BlogPro/2022/04/06/Net%E9%AB%98%E7%BA%A7/6%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">6、数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-06 10:48:57" itemprop="dateCreated datePublished" datetime="2022-04-06T10:48:57+08:00">2022-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-04 13:42:12" itemprop="dateModified" datetime="2024-02-04T13:42:12+08:00">2024-02-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BlogPro/2022/04/06/Net%E9%AB%98%E7%BA%A7/6%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BlogPro/2022/04/06/Net%E9%AB%98%E7%BA%A7/6%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="主键-Primary-Key"><a href="#主键-Primary-Key" class="headerlink" title="主键 (Primary Key)"></a>主键 (Primary Key)</h2><ul>
<li>定义：数据库表中的特殊列，其值能唯一地标识表中的每一行&#x2F;记录。主键的值不允许重复，且不能为null。</li>
<li>特点：<ul>
<li>唯一标识：确保表中的每一行都可以通过主键被唯一确定。</li>
<li>对用户无意义：通常，主键的值对用户来说没有直接的业务意义，它们主要是为了数据管理的目的而存在的。</li>
<li>单例与查询效率：单一的主键（而非复合主键）通常能提供更好的查询性能。</li>
<li>不应更新：主键的值一旦设定，就不应该更改。</li>
<li>生成方式：可以由数据库系统自动生成，如自增ID或GUID。</li>
</ul>
</li>
</ul>
<h2 id="自增ID-Auto-increment-ID"><a href="#自增ID-Auto-increment-ID" class="headerlink" title="自增ID (Auto-increment ID)"></a>自增ID (Auto-increment ID)</h2><ul>
<li>定义：一种主键生成策略，其中数据库系统自动为新记录分配一个唯一的、递增的数字作为主键值。</li>
<li>优点：确保唯一性，简化应用程序逻辑（不需要应用程序自己生成主键值）。</li>
</ul>
<h2 id="GUID-Globally-Unique-Identifier"><a href="#GUID-Globally-Unique-Identifier" class="headerlink" title="GUID (Globally Unique Identifier)"></a>GUID (Globally Unique Identifier)</h2><ul>
<li>定义：全局唯一标识符，是一种由算法生成的、全球唯一的字符串。在数据库中，它可以作为主键使用。</li>
<li>特点：全球唯一，但通常比自增ID更长且不易读。</li>
</ul>
<h2 id="外键-Foreign-Key"><a href="#外键-Foreign-Key" class="headerlink" title="外键 (Foreign Key)"></a>外键 (Foreign Key)</h2><ul>
<li>定义：一个表中的列或列组合，其值依赖于在另一个表中的主键。用于建立和加强两个表数据之间的链接。</li>
<li>作用：保持数据的一致性和完整性。</li>
</ul>
<h2 id="数据库事务-Database-Transaction"><a href="#数据库事务-Database-Transaction" class="headerlink" title="数据库事务 (Database Transaction)"></a>数据库事务 (Database Transaction)</h2><ul>
<li>定义：作为单个逻辑单位执行的一系列数据库操作，要么完全地执行，要么完全不执行。</li>
<li>特点：提供ACID属性（原子性、一致性、隔离性、持久性）。</li>
</ul>
<h2 id="存储过程-Stored-Procedure"><a href="#存储过程-Stored-Procedure" class="headerlink" title="存储过程 (Stored Procedure)"></a>存储过程 (Stored Procedure)</h2><ul>
<li>定义：预编译的SQL语句集合，存储在数据库中，可以由应用程序调用执行。</li>
<li>优点：减少网络流量，提高性能，增强安全性（因为逻辑在数据库服务器上执行）。</li>
</ul>
<h2 id="触发器-Trigger"><a href="#触发器-Trigger" class="headerlink" title="触发器 (Trigger)"></a>触发器 (Trigger)</h2><ul>
<li>定义：一种特殊的存储过程，当满足某个特定事件（如INSERT、UPDATE或DELETE）时自动执行。</li>
<li>用途：自动执行数据验证、维护数据完整性等。</li>
</ul>
<h2 id="游标-Cursor"><a href="#游标-Cursor" class="headerlink" title="游标 (Cursor)"></a>游标 (Cursor)</h2><ul>
<li>定义：数据库查询的一种控制结构，允许程序逐行处理SQL查询的结果集。</li>
<li>注意：过度使用游标可能导致性能问题，因为它们通常比集合操作更慢。</li>
</ul>
<h2 id="视图-View"><a href="#视图-View" class="headerlink" title="视图 (View)"></a>视图 (View)</h2><ul>
<li>定义：基于SQL查询的虚拟表，可以像处理实际表一样处理视图。</li>
<li>用途：简化复杂的SQL查询，提供额外的数据安全性（通过限制对基础数据的访问）。</li>
</ul>
<h2 id="函数-Function"><a href="#函数-Function" class="headerlink" title="函数 (Function)"></a>函数 (Function)</h2><ul>
<li>定义：在数据库层面上执行特定任务的预定义代码块，可以返回一个值。</li>
<li>用途：处理数据，返回计算结果等。</li>
</ul>
<h2 id="字段类型-Field-Types"><a href="#字段类型-Field-Types" class="headerlink" title="字段类型 (Field Types)"></a>字段类型 (Field Types)</h2><ul>
<li>定义：数据库中表的列可以存储的数据类型，如整数、字符串、日期等。</li>
<li>重要性：正确的字段类型可以确保数据的完整性和性能。</li>
</ul>
<h2 id="字段可空-Nullable-Fields"><a href="#字段可空-Nullable-Fields" class="headerlink" title="字段可空 (Nullable Fields)"></a>字段可空 (Nullable Fields)</h2><ul>
<li>定义：表示数据库表中的某个字段是否可以不包含值（即为NULL）。</li>
<li>设计考虑：应根据业务需求和数据完整性要求来决定哪些字段应该是可空的。</li>
</ul>
<h2 id="统计字段-Statistical-Fields"><a href="#统计字段-Statistical-Fields" class="headerlink" title="统计字段 (Statistical Fields)"></a>统计字段 (Statistical Fields)</h2><ul>
<li>定义：通常用于存储计算结果或汇总信息的字段，如总数、平均值等。</li>
<li>用途：提高查询性能，减少实时计算的需求。</li>
</ul>
<h2 id="软删除-Soft-Delete"><a href="#软删除-Soft-Delete" class="headerlink" title="软删除 (Soft Delete)"></a>软删除 (Soft Delete)</h2><ul>
<li>定义：不实际从数据库中删除记录，而是通过标记（如设置“已删除”字段）来表示记录已被删除。</li>
<li>优点：保留历史数据，便于恢复误删除的记录。</li>
</ul>
<h1 id="字段详解"><a href="#字段详解" class="headerlink" title="字段详解"></a>字段详解</h1><h3 id="bit-整型"><a href="#bit-整型" class="headerlink" title="bit    整型"></a>bit    整型</h3><p>bit数据类型是整型，其值只能是0、1或空值。这种数据类型用于存储只有两种可能值的数据，如Yes 或No、True 或False 、On 或Off.   <br>注意：很省空间的一种数据类型，如果能够满足需求应该尽量多用。
 </p>
<h3 id="tinyint-整型"><a href="#tinyint-整型" class="headerlink" title="tinyint   整型"></a>tinyint   整型</h3><p>tinyint 数据类型能存储从0到255 之间的整数。它在你只打算存储有限数目的数值时很有用。这种数据类型在数据库中占用1 个字节. <br>注意：如果bit类型太单调不能满足您的需求，您可以考虑用tinyint类型，因为这个类型相对也是比较安全的，不接受恶意脚本内容的嵌入。
 </p>
<h3 id="smallint-整型"><a href="#smallint-整型" class="headerlink" title="smallint     整型"></a>smallint     整型</h3><p>smallint 数据类型可以存储从- 2的15次幂(-32768)到2的15次幂(32767)之间的整数。这种数据类型对存储一些常限定在特定范围内的数值型数据非常有用。这种数据类型在数据库里占用2 字节空间. <br>注意：如果tinyint类型太单调不能满足您的需求，您可以考虑用smallint类型，因为这个类型相对也是比较安全的，不接受恶意脚本内容的嵌入。 
 </p>
<h3 id="int-整型"><a href="#int-整型" class="headerlink" title="int    整型"></a>int    整型</h3><p>int 数据类型可以存储从- 2的31次幂(-2147483648)到2的31次幂 (2147483 647)之间的整数。存储到数据库的几乎所有数值型的数据都可以用这种数据类型。这种数据类型在数据库里占用4个字节. <br>注意：如果smallint也不能够满足您的需求，您可以考虑用长度更大的int类型。</p>
<h3 id="decimal-精确数值型"><a href="#decimal-精确数值型" class="headerlink" title="decimal   精确数值型"></a>decimal   精确数值型</h3><p>decimal 数据类型能用来存储从-10的38次幂-1到10的38次幂-1的固定精度和范围的数值型数据。使用这种数据类型时，必须指定范围和精度。 范围是小数点左右所能存储的数字的总位数。精度是小数点右边存储的数字的位数</p>
<h3 id="numeric-精确数值型"><a href="#numeric-精确数值型" class="headerlink" title="numeric   精确数值型"></a>numeric   精确数值型</h3><p>numeric数据类型与decimal 相似。</p>
<h3 id="smallmoney-货币型"><a href="#smallmoney-货币型" class="headerlink" title="smallmoney    货币型"></a>smallmoney    货币型</h3><p>smallmoney 数据类型用来表示钱和货币值。这种数据类型能存储从-214748.3648 到214748.3647 之间的数据，精确到货币单位的万分之一</p>
<h3 id="money-货币型"><a href="#money-货币型" class="headerlink" title="money   货币型"></a>money   货币型</h3><p>money数据类型用来表示钱和货币值。这种数据类型能存储从-9220亿到9220 亿之间的数据，精确到货币单位的万分之一  </p>
<h3 id="float-近似数值型"><a href="#float-近似数值型" class="headerlink" title="float    近似数值型"></a>float    近似数值型</h3><p>float 数据类型是一种近似数值类型，供浮点数使用。说浮点数是近似的，是因为在其范围内不是所有的数都能精确表示。浮点数可以是从-1.79E+308到1.79E+308 之间的任意数 </p>
<h3 id="real-近似数值型"><a href="#real-近似数值型" class="headerlink" title="real     近似数值型"></a>real     近似数值型</h3><p>real 数据类型像浮点数一样，是近似数值类型。它可以表示数值在-3.40E+38到3.40E+38之间的浮点数</p>
<h3 id="Smalldatetime-日期时间型"><a href="#Smalldatetime-日期时间型" class="headerlink" title="Smalldatetime   日期时间型"></a>Smalldatetime   日期时间型</h3><p>smalldatetime 数据类型用来表示从1900年1月1日到2079年6月6日间的日期和时间，精确到一分钟  </p>
<h3 id="datetime-日期时间型"><a href="#datetime-日期时间型" class="headerlink" title="datetime   日期时间型"></a>datetime   日期时间型</h3><p>datetime数据类型用来表示日期和时间。这种数据类型存储从1753年1月1日到9999年12月31日间所有的日期和时间数据， 精确到三百分之一秒或3.33毫秒 . </p>
<h3 id="cursor-特殊数据型"><a href="#cursor-特殊数据型" class="headerlink" title="cursor    特殊数据型"></a>cursor    特殊数据型</h3><p>cursor 数据类型是一种特殊的数据类型，它包含一个对游标的引用。这种数据类型用在存储过程中，而且创建表时不能用 </p>
<h3 id="timestamp-特殊数据型"><a href="#timestamp-特殊数据型" class="headerlink" title="timestamp   特殊数据型"></a>timestamp   特殊数据型</h3><p>timestamp 数据类型是一种特殊的数据类型，用来创建一个数据库范围内的唯一数码。 一个表中只能有一个timestamp列。每次插入或修改一行时，timestamp列的值都会改变。尽管它的名字中有“time”， 但timestamp列不是人们可识别的日期。在一个数据库里，timestamp值是唯一的  </p>
<h3 id="Uniqueidentifier-特殊数据型"><a href="#Uniqueidentifier-特殊数据型" class="headerlink" title="Uniqueidentifier    特殊数据型"></a>Uniqueidentifier    特殊数据型</h3><p>Uniqueidentifier数据类型用来存储一个全局唯一标识符，即GUID。GUID确实是全局唯一的。这个数几乎没有机会在另一个系统中被重建。可以使用NEWID 函数或转换一个字符串为唯一<br>标识符来初始化具有唯一标识符的列 .</p>
<h3 id="char-字符型"><a href="#char-字符型" class="headerlink" title="char    字符型"></a>char    字符型</h3><p>char数据类型用来存储指定长度的定长非统一编码型的数据。当定义一列为此类型时，你必须指定列长。当你总能知道要存储的数据的长度时，此数据类型很有用。例如，当你按邮政编码加4个字符格式来存储数据时，你知道总要用到10个字符。此数据类型的列宽最大为8000 个字符.</p>
<h3 id="varchar-字符型"><a href="#varchar-字符型" class="headerlink" title="varchar   字符型"></a>varchar   字符型</h3><p>varchar数据类型，同char类型一样，用来存储非统一编码型字符数据。与char 型不一样，此数据类型为变长。当定义一列为该数据类型时，你要指定该列的最大长度。 它与char数据类型最大的区别是，存储的长度不是列长，而是数据的长度   .</p>
<h3 id="text-字符型"><a href="#text-字符型" class="headerlink" title="text    字符型"></a>text    字符型</h3><p>text 数据类型用来存储大量的非统一编码型字符数据。这种数据类型最多可以有231-1或20亿个字符.</p>
<h3 id="nchar-统一编码字符型"><a href="#nchar-统一编码字符型" class="headerlink" title="nchar    统一编码字符型"></a>nchar    统一编码字符型</h3><p>nchar 数据类型用来存储定长统一编码字符型数据。统一编码用双字节结构来存储每个字符，而不是用单字节(普通文本中的情况)。它允许大量的扩展字符。此数据类型能存储4000种字符，使用的字节空间上增加了一倍.</p>
<h3 id="nvarchar-统一编码字符型"><a href="#nvarchar-统一编码字符型" class="headerlink" title="nvarchar    统一编码字符型"></a>nvarchar    统一编码字符型</h3><p>nvarchar 数据类型用作变长的统一编码字符型数据。此数据类型能存储4000种字符，使用的字节空间增加了一倍.</p>
<h3 id="ntext-统一编码字符型"><a href="#ntext-统一编码字符型" class="headerlink" title="ntext    统一编码字符型"></a>ntext    统一编码字符型</h3><p>ntext 数据类型用来存储大量的统一编码字符型数据。这种数据类型能存储230 -1或将近10亿个字符，且使用的字节空间增加了一倍</p>
<h3 id="binary-二进制数据类型"><a href="#binary-二进制数据类型" class="headerlink" title="binary    二进制数据类型"></a>binary    二进制数据类型</h3><p>binary数据类型用来存储可达8000 字节长的定长的二进制数据。当输入表的内容接近相同的长度时，你应该使用这种数据类型.</p>
<h3 id="varbinary-二进制数据类型"><a href="#varbinary-二进制数据类型" class="headerlink" title="varbinary     二进制数据类型"></a>varbinary     二进制数据类型</h3><p>varbinary 数据类型用来存储可达8000 字节长的变长的二进制数据。当输入表的内容大小可变时，你应该使用这种数据类型  </p>
<h3 id="image-二进制数据类型"><a href="#image-二进制数据类型" class="headerlink" title="image    二进制数据类型"></a>image    二进制数据类型</h3><p>image 数据类型用来存储变长的二进制数据，最大可达231-1或大约20亿字节  </p>
<h1 id="系统自带类型"><a href="#系统自带类型" class="headerlink" title="系统自带类型"></a>系统自带类型</h1><hr>
<h3 id="1-二进制数据类型"><a href="#1-二进制数据类型" class="headerlink" title="(1)二进制数据类型"></a>(1)二进制数据类型</h3><p>　　二进制数据包括 Binary、Varbinary 和 Image<br>　　Binary 数据类型既可以是固定长度的(Binary),也可以是变长度的。<br>　　Binary[(n)] 是 n 位固定的二进制数据。其中，n 的取值范围是从 1 到 8000。其存储窨的大小是 n + 4 个字节。<br>　　Varbinary[(n)] 是 n 位变长度的二进制数据。其中，n 的取值范围是从 1 到 8000。其存储窨的大小是 n + 4个字节，不是n 个字节。<br>　　在 Image 数据类型中存储的数据是以位字符串存储的，不是由 SQL Server 解释的，必须由应用程序来解释。例如，应用程序可以使用BMP、TIEF、GIF 和 JPEG 格式把数据存储在 Image 数据类型中。 </p>
<h3 id="2-字符数据类型"><a href="#2-字符数据类型" class="headerlink" title="(2)字符数据类型"></a>(2)字符数据类型</h3><p>　　字符数据的类型包括 Char，Varchar 和 Text<br>　　字符数据是由任何字母、符号和数字任意组合而成的数据。<br>　　Varchar 是变长字符数据，其长度不超过 8KB。Char 是定长字符数据，其长度最多为 8KB。超过 8KB 的ASCII 数据可以使用Text数据类型存储。例如，因为 Html 文档全部都是 ASCII 字符，并且在一般情况下长度超过 8KB，所以这些文档可以 Text 数据类型存储在SQL Server 中。 </p>
<h3 id="3-Unicode-数据类型"><a href="#3-Unicode-数据类型" class="headerlink" title="(3)Unicode 数据类型"></a>(3)Unicode 数据类型</h3><p>　　Unicode 数据类型包括 Nchar,Nvarchar 和Ntext<br>　　在 Microsoft SQL Server 中，传统的非 Unicode 数据类型允许使用由特定字符集定义的字符。在 SQL Server安装过程中，允许选择一种字符集。使用 Unicode 数据类型，列中可以存储任何由Unicode 标准定义的字符。在 Unicode 标准中，包括了以各种字符集定义的全部字符。使用Unicode数据类型，所战胜的窨是使用非 Unicode 数据类型所占用的窨大小的两倍。 <br>　　在 SQL Server 中，Unicode 数据以 Nchar、Nvarchar 和 Ntext 数据类型存储。使用这种字符类型存储的列可以存储多个字符集中的字符。当列的长度变化时，应该使用Nvarchar 字符类型，这时最多可以存储 4000 个字符。当列的长度固定不变时，应该使用 Nchar 字符类型，同样，这时最多可以存储4000 个字符。当使用 Ntext 数据类型时，该列可以存储多于 4000 个字符。 </p>
<h3 id="4-日期和时间数据类型"><a href="#4-日期和时间数据类型" class="headerlink" title="(4)日期和时间数据类型"></a>(4)日期和时间数据类型</h3><p>　　日期和时间数据类型包括 Datetime 和 Smalldatetime两种类型<br>　　日期和时间数据类型由有效的日期和时间组成。例如，有效的日期和时间数据包括“4&#x2F;01&#x2F;98 12:15:00:00:00 PM”和“1:28:29:15:01AM 8&#x2F;17&#x2F;98”。前一个数据类型是日期在前，时间在后一个数据类型是霎时间在前，日期在后。在 Microsoft SQL Server中，日期和时间数据类型包括Datetime 和 Smalldatetime 两种类型时，所存储的日期范围是从 1753 年 1 月 1 日开始，到9999 年12 月 31 日结束(每一个值要求 8 个存储字节)。使用 Smalldatetime 数据类型时，所存储的日期范围是 1900年 1 月 1日 开始，到 2079 年 12 月 31 日结束(每一个值要求 4 个存储字节)。<br>　　日期的格式可以设定。设置日期格式的命令如下：<br>　　Set DateFormat {format | @format _var|<br>　　其中，format | @format_var 是日期的顺序。有效的参数包括 MDY、DMY、YMD、YDM、MYD 和 DYM。在默认情况下，日期格式为MDY。<br>　　例如，当执行 Set DateFormat YMD 之后，日期的格式为年 月 日 形式；当执行 Set DateFormat DMY 之后，日期的格式为日 月有年 形式 </p>
<h3 id="（5）数字数据类型"><a href="#（5）数字数据类型" class="headerlink" title="（5）数字数据类型"></a>（5）数字数据类型</h3><p>　　数字数据只包含数字。数字数据类型包括正数和负数、小数（浮点数）和整数<br>　　整数由正整数和负整数组成，例如 39、25、0-2 和 33967。在 Micrsoft SQL Server 中，整数存储的数据类型是 　　 Int，Smallint和 Tinyint。Int 数据类型存储数据的范围大于 Smallint 数据类型存储数据的范围，而 Smallint 据类型存储数据的范围大于Tinyint 数据类型存储数据的范围。使用 Int 数据狗昔存储数据的范围是从 -2 147 483 648 到 2 147 483 647（每一个值要求4个字节存储空间）。使用 Smallint 数据类型时，存储数据的范围从 -32 768 到 32 767（每一个值要求2个字节存储空间）。使用Tinyint 数据类型时，存储数据的范围是从0 到255（每一个值要求1个字节存储空间）。<br>　　精确小娄数据在 SQL Server 中的数据类型是 Decimal 和 Numeric。这种数据所占的存储空间根据该数据的位数后的位数来确定。<br>　　在SQL Server 中，近似小数数据的数据类型是 Float 和 Real。例如，三分之一这个分数记作。3333333，当使用近似数据类型时能准确表示。因此，从系统中检索到的数据可能与存储在该列中数据不完全一样。 </p>
<h3 id="（6）货币数据表示正的或者负的货币数量-。"><a href="#（6）货币数据表示正的或者负的货币数量-。" class="headerlink" title="（6）货币数据表示正的或者负的货币数量 。"></a>（6）货币数据表示正的或者负的货币数量 。</h3><p>　　在 Microsoft SQL Server 中，货币数据的数据类型是Money 和 Smallmoney <br>　　Money数据类型要求 8 个存储字节，Smallmoney 数据类型要求 4 个存储字节。 </p>
<h3 id="（7）特殊数据类型"><a href="#（7）特殊数据类型" class="headerlink" title="（7）特殊数据类型"></a>（7）特殊数据类型</h3><p>　　特殊数据类型包括前面没有提过的数据类型。特殊的数据类型有3种，即 　　 Timestamp、Bit 和 Uniqueidentifier。<br>　　Timestamp 用于表示SQL Server 活动的先后顺序，以二进投影的格式表示。Timestamp 数据与插入数据或者日期和时间没有关系。<br>　　Bit 由 1 或者 0 组成。当表示真或者假、ON 或者 OFF 时，使用 Bit 数据类型。例如，询问是否是每一次访问的客户机请求可以存储在这种数据类型的列中。<br>　　Uniqueidentifier 由 16 字节的十六进制数字组成，表示一个全局唯一的。当表的记录行要求唯一时，GUID是非常有用。例如，在客户标识号列使用这种数据类型可以区别不同的客户。 </p>
<p>#2.用户定义的数据类型 </p>
<p>　　用户定义的数据类型基于在 Microsoft SQL Server 中提供的数据类型。当几个表中必须存储同一种数据类型时，并且为保证这些列有相同的数据类型、长度和可空性时，可以使用用户定义的数据类型。例如，可定义一种称为 　　postal_code 的数据类型，它基于 Char 数据类型。<br>　　当创建用户定义的数据类型时，必须提供三个数：数据类型的名称、所基于的系统数据类型和数据类型的可空性。 </p>
<h3 id="（1）创建用户定义的数据类型"><a href="#（1）创建用户定义的数据类型" class="headerlink" title="（1）创建用户定义的数据类型"></a>（1）创建用户定义的数据类型</h3><p>　　创建用户定义的数据类型可以使用 Transact-SQL 语句。系统存储过程 sp_addtype 可以来创建用户定义的数据类型。其语法形式如下：<br>　　sp_addtype {type},[,system_data_bype][,’null_type’]<br>　　其中，type 是用户定义的数据类型的名称。system_data_type 是系统提供的数据类型，例如 Decimal、Int、Char 　　等等。 null_type 表示该数据类型是如何处理空值的，必须使用单引号引起来，例如’NULL’、’NOT NULL’或者’NONULL’。<br>　　例子：<br>　　Use cust<br>　　Exec sp_addtype ssn,’Varchar(11)’,”Not Null’<br>　　创建一个用户定义的数据类型 ssn，其基于的系统数据类型是变长为11 的字符，不允许空。<br>　　例子：<br>　　Use cust<br>　　Exec sp_addtype birthday,datetime,’Null’<br>　　创建一个用户定义的数据类型 birthday，其基于的系统数据类型是 DateTime，允许空。<br>　　例子：<br>　　Use master<br>　　Exec sp_addtype telephone,’varchar(24),’Not Null’<br>　　Eexc sp_addtype fax,’varchar(24)’,’Null’<br>　　创建两个数据类型，即 telephone 和 fax </p>
<h3 id="（2）删除用户定义的数据类型"><a href="#（2）删除用户定义的数据类型" class="headerlink" title="（2）删除用户定义的数据类型"></a>（2）删除用户定义的数据类型</h3><p>　　当用户定义的数据类型不需要时，可删除。删除用户定义的数据类型的命令是 sp_droptype {‘type’}。<br>　　例子：<br>　　Use master<br>　　Exec sp_droptype ‘ssn’<br>　　注意：当表中的列还正在使用用户定义的数据类型时，或者在其上面还绑定有默认或者规则时，这种用户定义的数据类型不能删除。 </p>
<p>SQL SERVER的字段类型说明 </p>
<p>　　以下为SQL SERVER7.0以上版本的字段类型说明。SQL SERVER6.5的字段类型说明请参考SQL SERVER提供的说明。</p>
<p>字段类型 描述 <br>bit   0或1的整型数字 <br>int   从-2^31(-2,147,483,648)到2^31(2,147,483,647)的整型数字 <br>smallint   从-2^15(-32,768)到2^15(32,767)的整型数字 <br>tinyint   从0到255的整型数字 <br>    <br>decimal   从-10^38到10^38-1的定精度与有效位数的数字 <br>numeric   decimal的同义词 <br>    <br>money   从-2^63(-922,337,203,685,477.5808)到2^63-1(922,337,203,685,477.5807)的货币数据，最小货币单位千分之十 <br>smallmoney   从-214,748.3648到214,748.3647的货币数据，最小货币单位千分之十 <br>    <br>float   从-1.79E+308到1.79E+308可变精度的数字 <br>real   从-3.04E+38到3.04E+38可变精度的数字 <br>    <br>datetime   从1753年1月1日到9999年12日31的日期和时间数据，最小时间单位为百分之三秒或3.33毫秒 <br>smalldatetime   从1900年1月1日到2079年6月6日的日期和时间数据，最小时间单位为分钟 <br>    <br>timestamp   时间戳，一个数据库宽度的唯一数字 <br>uniqueidentifier   全球唯一标识符GUID <br>    <br>char   定长非Unicode的字符型数据，最大长度为8000 <br>varchar   变长非Unicode的字符型数据，最大长度为8000 <br>text   变长非Unicode的字符型数据，最大长度为2^31-1(2G) <br>    <br>nchar   定长Unicode的字符型数据，最大长度为8000 <br>nvarchar   变长Unicode的字符型数据，最大长度为8000 <br>ntext   变长Unicode的字符型数据，最大长度为2^31-1(2G) <br>    <br>binary   定长二进制数据，最大长度为8000 <br>varbinary   变长二进制数据，最大长度为8000 <br>image   变长二进制数据，最大长度为2^31-1(2G) </p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/andy_tigger/archive/2011/08/21/2147745.html">http://www.cnblogs.com/andy_tigger/archive/2011/08/21/2147745.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/BlogPro/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/BlogPro/">1</a><span class="space">&hellip;</span><a class="page-number" href="/BlogPro/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/BlogPro/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/BlogPro/page/13/">13</a><a class="extend next" rel="next" href="/BlogPro/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="John Doe"
      src="/BlogPro/images/Wx.jpg">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description">这里是何锦祥的博客，记录生活点滴，分享思考与感悟。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/BlogPro/archives/">
        
          <span class="site-state-item-count">122</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/BlogPro/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/SMDegz" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SMDegz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/BlogPro/1522107010@qq.com" title="E-Mail → 1522107010@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/%E4%B8%8D%E4%BC%9A%E7%BC%96%E7%A8%8B%E7%9A%84%E7%8C%AB" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;不会编程的猫" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://smdegz.github.io/BlogPro/" title="https:&#x2F;&#x2F;smdegz.github.io&#x2F;BlogPro&#x2F;">smdegz Blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/BlogPro/lib/anime.min.js"></script>
  <script src="/BlogPro/lib/velocity/velocity.min.js"></script>
  <script src="/BlogPro/lib/velocity/velocity.ui.min.js"></script>

<script src="/BlogPro/js/utils.js"></script>

<script src="/BlogPro/js/motion.js"></script>


<script src="/BlogPro/js/schemes/pisces.js"></script>


<script src="/BlogPro/js/next-boot.js"></script>


  <script defer src="/BlogPro/lib/three/three.min.js"></script>
    <script defer src="/BlogPro/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/BlogPro/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'i6ML4c6D9phSdR4vRG7tjH8M-gzGzoHsz',
      appKey     : 'BfRJ9pJSV3u0CAuvm1xEwNL8',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
